쿠버네티스 클러스터를 완전히 제거하고 시스템을 초기 상태로 되돌리는 과정은 단순히 패키지를 삭제하는 것보다 더 복잡합니다. 네트워크 설정(CNI), 프로세스, 잔류 파일들을 모두 정리해야 재설치 시 충돌을 방지할 수 있습니다.

---

## 쿠버네티스 구성 요소 완벽 삭제 가이드

이 가이드는 `kubeadm`으로 설치된 환경을 기준으로 하며, 시스템에 남아있는 모든 흔적을 제거하는 것을 목표로 합니다.

### 1. 클러스터 초기화 및 프로세스 중단

가장 먼저 `kubeadm` 도구를 사용하여 노드의 설정을 초기화하고 관련 프로세스를 중단합니다.

```bash
# 클러스터 설정 초기화 (가장 중요)
sudo kubeadm reset -f

# 실행 중인 모든 컨테이너 중지 및 삭제 (Docker 또는 containerd)
# Docker 사용 시
sudo docker rm -f $(sudo docker ps -a -q)
# containerd(crictl) 사용 시
sudo crictl ps -a -q | xargs -r sudo crictl stop
sudo crictl ps -a -q | xargs -r sudo crictl rm

```

### 2. 쿠버네티스 패키지 및 서비스 삭제

시스템에 설치된 바이너리와 서비스 설정 파일을 제거합니다.

```bash
# 패키지 삭제 (Ubuntu/Debian 기준)
sudo apt-get purge -y kubeadm kubectl kubelet kubernetes-cni 'kube*' 

# 불필요한 의존성 패키지 삭제
sudo apt-get autoremove -y

```

### 3. 잔류 파일 및 디렉토리 강제 삭제

설정 파일과 데이터가 남아있으면 재설치 시 이전 데이터와 동기화 오류가 발생할 수 있습니다.

```bash
# 설정 및 데이터 디렉토리 제거
sudo rm -rf ~/.kube
sudo rm -rf /etc/kubernetes/
sudo rm -rf /var/lib/kubelet/
sudo rm -rf /var/lib/etcd/
sudo rm -rf /etc/cni/
sudo rm -rf /opt/cni/bin
sudo rm -rf /var/lib/cni/

```

### 4. 네트워크 설정 초기화 (CNI 정리)

Flannel, Calico 등 CNI가 생성한 가상 네트워크 인터페이스와 라우팅 테이블을 정리해야 합니다.

```bash
# 네트워크 인터페이스 삭제 (CNI 종류에 따라 다름)
sudo ip link delete cni0
sudo ip link delete flannel.1
sudo ip link delete cali... # Calico 사용 시

# IP 테이블(iptables) 초기화
sudo iptables -F && sudo iptables -t nat -F && sudo iptables -t mangle -F && sudo iptables -X

```

---

### 5. 실전 팁: 완벽한 정리를 위한 체크리스트

* **마운트 해제:** 간혹 `/var/lib/kubelet/pods/...` 경로에 파일 시스템이 마운트되어 삭제되지 않는 경우가 있습니다. 이럴 땐 `mount | grep kubelet`으로 확인 후 `umount`를 먼저 수행하세요.
* **재부팅 권장:** 모든 삭제 작업이 끝난 후 시스템을 재부팅(sudo reboot)하면 메모리에 남아있던 가상 브리지 정보나 라우팅 규칙이 완전히 초기화됩니다.
* **강사 전용 팁:** 수강생들이 재실습을 할 때 가장 많이 발생하는 에러는 `/etc/kubernetes/` 내의 인증서가 남아있어 발생하는 `Unauthorized` 에러입니다. 이 디렉토리가 비어있는지 꼭 확인하게 하세요.

---

> [!NOTE]
> **과금 및 유료 서비스 안내**
> * **온프레미스/VM:** 직접 구축한 환경에서 위 명령어를 수행하는 것은 비용이 발생하지 않습니다.
> * **AWS EKS:** EKS 클러스터를 삭제하려면 위 명령어 대신 `eksctl delete cluster` 명령어나 AWS 콘솔을 사용해야 합니다. 클러스터 제어부(Control Plane) 비용은 삭제 즉시 중단되지만, 함께 생성된 **EBS 볼륨, Elastic IP, NAT Gateway** 등은 수동으로 삭제하지 않으면 계속 과금될 수 있으니 반드시 확인이 필요합니다.
> 
> 

Next Step: **Kubernetes Installation (kubeadm)**
