쿠버네티스 클러스터를 제거하는 과정은 단순한 패키지 삭제를 넘어, 커널에 적용된 네트워크 규칙과 파일 시스템에 분산된 설정들을 완벽히 정리하는 과정입니다. 이 가이드는 재설치 시 발생할 수 있는 충돌을 원천 차단하고, 시스템 네트워크의 안정성을 유지하며 초기 상태로 되돌리는 표준 절차를 다룹니다.

---

## 쿠버네티스 안전 제거 및 초기화 가이드

### 1. 클러스터 초기화 및 런타임 정리

가장 먼저 `kubeadm`을 통해 노드의 상태를 초기화하고 실행 중인 컨테이너들을 정리합니다.

```bash
# 1.1 클러스터 설정 초기화
# 이 명령은 로컬의 kubelet 설정과 인증서 등을 초기화합니다.
sudo kubeadm reset -f

# 1.2 컨테이너 런타임 프로세스 중지 및 삭제
# containerd를 사용하는 경우 남아있는 컨테이너와 샌드박스를 모두 제거합니다.
sudo crictl ps -a -q | xargs -r sudo crictl stop
sudo crictl ps -a -q | xargs -r sudo crictl rm

```

### 2. 네트워크 정책 안전 확보 (가장 중요)

네트워크 규칙을 초기화할 때 외부 접속(SSH 등)이 끊기지 않도록 기본 정책(Policy)을 먼저 확인하고 수정해야 합니다.

```bash
# 2.1 iptables 기본 정책을 ACCEPT로 변경
# INPUT 체인이 DROP으로 되어 있을 경우 규칙 초기화 시 접속이 차단되므로 반드시 수행합니다.
sudo iptables -P INPUT ACCEPT
sudo iptables -P FORWARD ACCEPT
sudo iptables -P OUTPUT ACCEPT

# 2.2 모든 iptables 규칙 초기화
sudo iptables -F && sudo iptables -t nat -F && sudo iptables -t mangle -F && sudo iptables -X

```

### 3. 쿠버네티스 패키지 및 서비스 완전 삭제

시스템 바이너리와 자동 실행 설정들을 제거합니다.

```bash
# 3.1 관련 패키지 삭제
sudo apt-get purge -y kubeadm kubectl kubelet kubernetes-cni 'kube*' 

# 3.2 불필요한 의존성 패키지 정리
sudo apt-get autoremove -y

```

### 4. 잔류 데이터 및 디렉토리 강제 삭제

디렉토리가 남아있으면 재설치 시 이전 인증서나 데이터가 동기화되어 에러를 유발합니다.

```bash
# 4.1 설정 및 데이터 디렉토리 제거
sudo rm -rf ~/.kube
sudo rm -rf /etc/kubernetes/
sudo rm -rf /var/lib/kubelet/
sudo rm -rf /var/lib/etcd/
sudo rm -rf /etc/cni/
sudo rm -rf /opt/cni/bin
sudo rm -rf /var/lib/cni/
sudo rm -rf /var/run/calico

```

### 5. 가상 네트워크 인터페이스 정리

CNI(Calico, Flannel 등)가 생성한 가상 브리지와 가상 인터페이스를 제거하여 커널 네트워크 스택을 정화합니다.

```bash
# 5.1 CNI 인터페이스 삭제
# 호스트의 물리 NIC(eth0 등)는 건드리지 않고 가상 인터페이스만 삭제합니다.
sudo ip link delete cni0
sudo ip link delete flannel.1
sudo ip link show | grep cali | awk '{print $2}' | cut -d'@' -f1 | xargs -r -I {} sudo ip link delete {}

# 5.2 라우팅 테이블 및 ARP 캐시 정리
sudo ip route flush proto bird
sudo ip neigh flush all

```

---

### 실전 점검 및 시스템 복구

* **마운트 잔류 확인:** `/var/lib/kubelet/pods/` 하위에 파일 시스템이 마운트되어 삭제되지 않는 경우가 있습니다. `mount | grep kubelet`으로 확인 후 `umount`를 선행하세요.
* **시스템 재부팅 권장:** 위 과정을 마친 후 `sudo reboot`을 통해 커널 메모리에 남은 브리지 정보와 가상 경로를 완전히 초기화하는 것을 권장합니다.
* **환경 변수 확인:** `.bashrc` 또는 `.zshrc`에 등록된 쿠버네티스 관련 별칭(alias)이나 환경 변수(`KUBECONFIG` 등)가 있다면 함께 정리하세요.

---

> [!NOTE]
> **과금 및 유료 서비스 안내**
> * **AWS EC2:** 인스턴스 내부 설정 초기화는 추가 비용이 발생하지 않으나, 인스턴스가 켜져 있는 동안의 시간당 비용은 계속 청구됩니다.
> * **AWS EBS:** `/var/lib/etcd` 등에 마운트된 별도의 EBS 볼륨이 있다면, 클러스터를 삭제하더라도 볼륨을 직접 삭제하지 않으면 보관 비용이 발생합니다.
> * **NAT Gateway:** 네트워크 초기화 후 시스템 업데이트나 패키지 재설치를 위해 외부와 통신할 경우 NAT Gateway 트래픽 과금이 발생할 수 있으니 유의하십시오.
> 
> 

Next Step: **Kubernetes Installation (kubeadm)**

---

제시하신 위험 요소를 반영하여 네트워크 정책을 최우선으로 보호하는 안전한 제거 프로세스를 구성했습니다. 특히 `iptables` 초기화 전 기본 정책을 `ACCEPT`로 강제 설정하는 단계를 포함하여 원격 접속 유실 가능성을 차단했습니다. 가이드는 깃허브와 교재로 활용하기 적합한 마크다운 형식으로 작성되었습니다.
