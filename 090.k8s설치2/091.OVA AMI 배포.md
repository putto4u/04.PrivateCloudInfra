VirtualBox 환경에서 강사님이 구축하신 완벽한 상태의 VM을 **수정 불가능한 '골든 이미지'**로 고정하고, 이를 기반으로 다른 VM을 자동 배포하는 전문가적 방법을 안내해 드립니다.

---

## 1. VirtualBox VM을 '수정 불가능'하게 고정하는 방법

VirtualBox에서는 AWS의 AMI와 유사하게 두 가지 방식으로 이미지를 고정하고 관리할 수 있습니다.

### 방법 A: 가상 가전 내보내기 (OVA 생성) - 권장

가장 표준적인 방법으로, 현재 VM의 모든 설정과 디스크 상태를 하나의 파일(`.ova`)로 패키징합니다. 이 파일은 '원본 이미지' 역할을 하며, 언제든 동일한 상태로 복구하거나 배포할 수 있습니다.

1. VirtualBox 메뉴: **파일(File)** > **가상 가전 내보내기(Export Appliance)** 선택
2. 대상 VM 선택 후 경로 지정 (예: `Golden_K8s_Node.ova`)
3. **설정 고정:** 내보내기가 완료되면 해당 `.ova` 파일은 읽기 전용으로 보관하여 골든 이미지로 활용합니다.

### 방법 B: 불변(Immutable) 디스크 설정

VM의 가상 디스크(`.vdi`) 자체를 '불변' 상태로 바꿉니다. 이 모드에서는 VM을 켜서 아무리 파일을 수정해도, **전원을 끄면 모든 변경 사항이 사라지고 원래 상태로 돌아갑니다.**

1. 해당 VM 종료 후 **가상 미디어 관리자(Virtual Media Manager)** 열기
2. 골든 이미지 디스크 선택 > **특성(Attributes)** 탭
3. 유형을 **불변(Immutable)**으로 변경
* *참고: 테스트용으로는 좋지만, 개별 노드로 복제할 때는 '연결된 복제' 기능을 쓰는 것이 더 효율적입니다.*



---

## 2. VirtualBox 이미지를 AMI로 변환할 수 있는가?

**네, 가능합니다.** VirtualBox에서 만든 환경을 AWS 클라우드로 그대로 옮길 수 있습니다.

* **원리:** VirtualBox의 디스크 형식(`.vdi` 또는 `.vmdk`)을 AWS가 인식할 수 있는 형식으로 변환하여 S3에 업로드한 후, **VM Import/Export** 서비스를 통해 AMI로 변환합니다.
* **변환 과정:**
1. VM을 `.raw` 또는 `.vmdk` 형식으로 내보냅니다.
2. AWS CLI를 사용하여 S3 버킷에 업로드합니다.
3. `aws ec2 import-image` 명령을 실행하여 AMI로 변환합니다.



---

## 3. 골든 이미지를 기반으로 한 '자동 설치' IaC 전략

이제 이 골든 이미지(OVA 또는 Immutable VDI)를 가지고 수강생 PC나 예비 서버에 **호스트네임과 IP만 바꿔서** 배포하는 자동화 흐름을 구성해야 합니다.

### 단계 1: 연결된 복제 (Linked Clone) 활용

모든 복제본이 골든 이미지의 디스크를 공유하면서, 변경된 내용(IP, 이름)만 별도 파일에 저장하는 방식입니다. 용량이 매우 절약됩니다.

### 단계 2: Vagrant를 이용한 프로비저닝 (추천 IaC 도구)

VirtualBox를 테라폼처럼 코드(IaC)로 다루고 싶다면 **Vagrant**가 가장 적합합니다. `Vagrantfile` 하나로 이미지 복제부터 네트워크 설정까지 한 번에 끝낼 수 있습니다.

```ruby
# Vagrantfile 예시: 골든 이미지를 기반으로 호스트네임/IP 자동 주입
Vagrant.configure("2") do |config|
  config.vm.box = "my-golden-image" # 강사님이 등록한 골든 이미지
  
  # 노드 1 설정
  config.vm.define "k8s-master" do |master|
    master.vm.network "private_network", ip: "192.168.1.10"
    master.vm.hostname = "k8s-master"
  end

  # 노드 2 설정
  config.vm.define "k8s-worker1" do |worker|
    worker.vm.network "private_network", ip: "192.168.1.11"
    worker.vm.hostname = "k8s-worker1"
  end
end

```

---

### 💡 실전 팁: 강사님을 위한 최적의 경로

 이미 완성된 VM이 있다면, **1단계로 `.ova` 파일을 생성**하여 백업해 두시고, **2단계로 Vagrant를 도입**하여 해당 이미지를 불러오면서 IP와 이름을 자동으로 할당하는 코드를 배포하는 것이 좋습니다.

---

### ⚠️ 비용 및 유료 전환 주의사항

* **VirtualBox**: 개인 및 교육용으로 **완전 무료(GPL v3)**입니다.
* **AWS AMI 변환 비용**: S3 업로드 시 발생하는 **데이터 전송 비용**과 AMI를 저장하는 **EBS Snapshot 비용**이 발생합니다. (보통 월 몇 달러 수준)
* **Vagrant**: 오픈소스로 **무료**로 사용 가능합니다.

**Next Step: 현재 VM을 Vagrant Box로 변환하거나 OVA 배포 스크립트 작성하기**

강사님의 골든 VM을 다른 PC에서 명령어 한 줄로 똑같이 띄우게 만드는 과정을 도와드릴까요?

Next Step: VirtualBox VM을 Vagrant Box로 패키징하는 방법 또는 OVA 자동 배포 Bash 스크립트 작성
