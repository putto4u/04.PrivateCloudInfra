네, 결론부터 말씀드리면 **IP 대역(Pod Subnet)을 반드시 바꿔야 할 기술적인 의무는 없으나, 실제 작업 시에는 변경하거나 매우 신중하게 재설정해야 합니다.**

Flannel과 Calico는 모두 Kubernetes의 CNI(Container Network Interface)이지만, 동작 방식과 관리하는 리소스가 다르기 때문에 단순히 소프트웨어만 교체한다고 끝나는 것이 아니라 **네트워크 환경의 재설계**가 필요합니다.

---

## 1. IP 대역을 유지해도 되는 경우

기존 Flannel에서 사용하던 대역(예: `10.244.0.0/16`)을 Calico에서도 그대로 사용할 수 있습니다.

* **조건:** 기존 클러스터를 완전히 삭제하고 새로 구축하거나, 모든 노드에서 Flannel 관련 설정을 완벽하게 제거한 후 Calico를 설치할 때.
* **이점:** 기존에 작성해둔 YAML 파일들의 네트워크 설정(Pod Subnet 지정 등)을 그대로 재사용할 수 있습니다.

---

## 2. IP 대역 변경을 고려해야 하는 이유 (권장 사항)

현업에서는 CNI 교체 시 대역을 변경하거나, 최소한 **설정값의 일치**를 위해 다음 사항을 체크합니다.

### **① CNI 기본값의 차이**

* **Flannel:** 관습적으로 `10.244.0.0/16`을 주로 사용합니다.
* **Calico:** 기본 설정값이 `192.168.0.0/16`인 경우가 많습니다.
* 만약 Calico 설치 YAML을 수정하지 않고 그대로 적용하면, Kube-Proxy나 Kubelet에 설정된 `--pod-network-cidr`값과 충돌하여 네트워크 통신이 두절됩니다.

### **② 데이터 평면(Data Plane)의 잔재 문제**

기존 Flannel이 각 노드에 생성해둔 라우팅 테이블, 브릿지(`cni0`), 인터페이스(`flannel.1`) 등이 남아있는 상태에서 같은 대역의 Calico를 올리면 **패킷 충돌**이 발생할 가능성이 매우 높습니다.

---

## 3. CNI 교체 및 환경 수정 작업 가이드 (주석 포함)

Flannel을 제거하고 Calico로 전환할 때 수행해야 할 핵심 작업들입니다.

```bash
# 1. 기존 Flannel 리소스 삭제 (선언형 파일 이용)
kubectl delete -f https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml

# 2. 모든 노드에서 Flannel 인터페이스 및 잔재 삭제 (Master/Worker 공통)
sudo ip link delete cni0          # CNI 브릿지 인터페이스 삭제
sudo ip link delete flannel.1     # Flannel VXLAN 인터페이스 삭제
sudo rm -rf /var/lib/cni/         # 기존 CNI 데이터 삭제
sudo rm -rf /etc/cni/net.d/       # 기존 CNI 설정 파일 삭제

# 3. Kubeadm 설정 내 Pod Subnet 확인 및 수정 (필요 시)
# 만약 대역을 바꾼다면 ClusterConfiguration의 podSubnet 항목을 수정해야 합니다.
kubectl -n kube-system edit cm kubeadm-config 

# 4. Calico 설치 YAML 다운로드 및 대역 수정
curl https://raw.githubusercontent.com/projectcalico/calico/v3.25.0/manifests/calico.yaml -O

# 5. [중요] calico.yaml 내에서 CALICO_IPV4POOL_CIDR 찾아 기존 대역과 일치시키거나 새 대역 입력
# 예: - name: CALICO_IPV4POOL_CIDR
#      value: "10.244.0.0/16" (기존 대역 유지 시)

# 6. 수정된 Calico 선언형 파일 적용
kubectl apply -f calico.yaml

# 7. CoreDNS 포드 재시작 (네트워크 변경사항 반영을 위해 필수)
kubectl rollout restart deployment coredns -n kube-system

```

---

## 4. 요약 및 주의사항

| 항목 | 내용 |
| --- | --- |
| **대역 유지 여부** | 기술적으로 가능하나, **설정 파일(YAML) 내 CIDR 값 일치**가 필수 |
| **권장 작업** | 가능하면 기존 잔재와의 충돌을 피하기 위해 클러스터 재설치 시 변경 권장 |
| **성능 이점** | Calico는 BGP를 지원하므로 Flannel(VXLAN)보다 오버헤드가 적고 보안 정책(Network Policy) 설정이 가능 |

> [!CAUTION] **AWS 환경에서의 과금 및 네트워크 제약**
> AWS VPC 내에서 Calico를 사용할 때, **IPIP** 또는 **VXLAN** 모드를 사용하지 않고 **BGP** 모드를 직접 사용하려면 AWS 인스턴스의 **Source/Dest Check** 옵션을 비활성화해야 합니다. 이 설정을 놓치면 포드 간 통신이 되지 않아 불필요한 트러블슈팅 시간(인건비/기회비용)이 낭비될 수 있습니다.

Next Step: **Calico의 BGP와 IPIP 모드 차이점** 혹은 **NetworkPolicy 적용 예제**

---

**[강의 교재 체크리스트]**

* [x] Flannel에서 Calico 전환 시 IP 대역 유지 가능 여부 답변
* [x] 전환 시 발생할 수 있는 충돌 및 기술적 주의사항 명시
* [x] 각 명령줄에 대한 상세 한글 주석 포함
* [x] AWS 특이사항(Source/Dest Check) 및 비용 관련 팁 제공
* [x] 전문가용 톤 유지 및 깃허브 마크다운 포맷 적용
* [x] Next Step 핵심 단어 제시 (관련 가이드: [Calico IP pools](https://www.google.com/search?q=https://docs.tigera.io/calico/latest/networking/configuring/ip-pools))
