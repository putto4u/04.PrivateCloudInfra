기존 마스터의 설정 YAML과 인증서들을 확보하고 있다면, 이를 일종의 **'클러스터 설계 도면(Blueprint)'**으로 삼아 완전히 새로운 클러스터를 구축하거나 복제하는 데 활용할 수 있습니다.

다만, 새로운 클러스터를 만들 때는 기존 클러스터의 특정 정보(호스트 이름, IP 주소 등)를 새 환경에 맞게 **'수정'**하는 과정이 반드시 포함되어야 합니다. 아래는 확보한 자원을 활용해 새 클러스터를 설치하고 환경을 수정하는 전체 공정입니다.

---

## 1. 인프라 공통 환경 준비 (모든 노드)

YAML을 적용하기 전, OS 레벨에서 컨테이너 런타임과 네트워크 환경이 준비되어야 합니다.

```bash
# 1. 커널 모듈 로드 (네트워크 브릿지 및 트래픽 제어용)
sudo modprobe overlay && sudo modprobe br_netfilter 

# 2. 시스템 파라미터 설정 (포워딩 활성화 및 브릿지 트래픽 허용)
cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
EOF

# 3. 설정된 파라미터 즉시 적용
sudo sysctl --system 

# 4. containerd 및 nerdctl 설치 (컨테이너 실행 엔진)
sudo apt-get update && sudo apt-get install -y containerd nerdctl

```

---

## 2. 새 클러스터용 설정 YAML 수정

기존 마스터에서 가져온 `kubeadm-config.yaml`을 새 환경에 맞게 편집합니다.

```yaml
# kubeadm-config.yaml 수정 예시
apiVersion: kubeadm.k8s.io/v1beta3
kind: ClusterConfiguration
kubernetesVersion: v1.28.0             # 기존 클러스터와 동일한 버전 권장
controlPlaneEndpoint: "192.168.1.100:6443" # [수정] 새 클러스터의 마스터 VIP 또는 대표 IP
networking:
  podSubnet: "10.244.0.0/16"           # CNI(Flannel, Calico 등) 대역 설정
apiServer:
  certSANs:                            # [수정] 접속 허용할 새 서버의 IP 및 도메인 추가
    - "192.168.1.100"
    - "NEW-MASTER-01"

```

---

## 3. 선언형 기반 새 마스터 설치 (Master 01)

수정된 YAML과 기존 인증서를 기반으로 새 클러스터를 초기화합니다.

```bash
# 5. 기존 pki 인증서를 새 서버의 동일 경로에 복사 (ca.key, ca.crt 등)
sudo cp -r ./backup/pki /etc/kubernetes/

# 6. 수정된 선언형 설정을 기반으로 클러스터 초기화 실행
sudo kubeadm init --config kubeadm-config.yaml --upload-certs

# 7. 관리자 권한 설정 (kubectl 사용 환경 구성)
mkdir -p $HOME/.kube && sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config

# 8. CNI(네트워크 플러그인) 설치 (선언형 YAML 적용)
kubectl apply -f https://raw.githubusercontent.com/flannel-io/flannel/master/Documentation/kube-flannel.yml

```

---

## 4. nerdctl을 이용한 상태 검증

```bash
# 9. k8s.io 네임스페이스 내 핵심 컴포넌트 구동 확인
sudo nerdctl -n k8s.io ps

# 10. 노드 상태가 Ready인지 최종 확인
kubectl get nodes

```

---

## 💡 실무 전문가 팁 (기존 자산 활용 시 주의사항)

* **인증서 만료 확인:** 기존 클러스터에서 가져온 인증서의 유효 기간을 확인하세요. 만료된 경우 `kubeadm certs renew`를 통해 갱신해야 합니다.
* **고유 식별자 충돌:** 기존 YAML에 `nodeName` 등이 하드코딩되어 있다면 반드시 제거하거나 수정해야 새 노드에서 충돌이 발생하지 않습니다.
* **데이터 정제:** `kubectl get -o yaml`로 뽑아낸 파일에는 `uid`, `resourceVersion`, `creationTimestamp` 등 시스템이 생성한 고유값이 포함되어 있습니다. 새 클러스터에 적용할 때는 이 항목들을 삭제하고 적용해야 에러가 발생하지 않습니다.

> [!CAUTION] **AWS 환경 전환 시 과금 주의**
> 이 설정을 그대로 AWS EC2에 옮길 경우, `controlPlaneEndpoint`를 **NLB(Network Load Balancer)** DNS 주소로 설정하게 됩니다. 이때 NLB 운용 비용(시간당 요금 + LCU 사용량 요금)이 발생하며, 온프레미스 대비 고정 지출이 늘어나므로 테스트 완료 후에는 반드시 리소스를 정리해야 합니다.

Next Step: **YAML 파일 내 시스템 생성 고유값(UID 등) 일괄 제거 방법** 혹은 **Helm을 이용한 서비스 패키징**

---

**[강의 교재 체크리스트]**

* [x] 기존 자산을 활용한 신규 구축 절차 체계화
* [x] 각 명령줄에 대한 상세 한글 주석 포함
* [x] 선언형 방식의 핵심인 YAML 수정 포인트(IP, SANs 등) 명시
* [x] AWS 비용 발생 지점(NLB) 재강조
* [x] 전문가용 톤앤매너 및 깃허브 친화적 포맷 유지
* [x] Next Step 핵심 단어 제시 (관련 문서: [kubeadm cluster init](https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-init/))
