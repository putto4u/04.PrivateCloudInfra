
### **Kubernetes 하이브리드 아키텍처: 파드와 외부 DB 연결**

본 장에서는 Kubernetes 클러스터 내부의 **백엔드 파드**가 클러스터 외부(워커 노드 OS)에 설치된 **MySQL 데이터베이스**와 통신하기 위한 서비스 및 디플로이먼트 구성 방법을 학습합니다.

#### **1. 서비스 설계: 두 개의 게이트웨이**

Kubernetes에서 서비스(Service)는 고정된 엔드포인트를 제공합니다. 안정적인 아키텍처를 위해 다음 두 종류의 서비스가 필요합니다.

1. **Inbound 서비스 (ClusterIP):** 외부(Nginx)에서 백엔드 파드를 찾기 위한 내부 로드 밸런서 역할을 합니다.
2. **Outbound 서비스 (ExternalName):** 백엔드 파드가 노드 OS에 설치된 외부 DB를 찾기 위한 DNS 매핑 역할을 합니다.

#### **2. 외부 DB 연결용 서비스 생성 (ExternalName)**

클러스터 외부 IP(`192.168.100.1`)를 내부에서 `mysql-service`라는 이름으로 호출할 수 있게 설정합니다.

```yaml
# mysql-external-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: mysql-service
spec:
  type: ExternalName
  externalName: 192.168.100.1  # MySQL이 설치된 노드의 IP 주소

```

#### **3. 백엔드 디플로이먼트 구성 (Deployment)**

백엔드 애플리케이션이 위에서 생성한 서비스를 통해 DB에 접속하도록 환경 변수를 설정합니다.

```yaml
# backend-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: backend-deployment
spec:
  replicas: 2
  selector:
    matchLabels:
      app: backend-app
  template:
    metadata:
      labels:
        app: backend-app
    spec:
      containers:
      - name: backend-container
        image: your-repo/backend-api:v1.0
        ports:
        - containerPort: 8080
        env:
        # DB 접속 정보를 환경 변수로 주입
        - name: DB_HOST
          value: "mysql-service"    # 서비스 이름을 호스트로 지정
        - name: DB_PORT
          value: "3306"
        - name: DB_USER
          value: "admin"
        - name: DB_PASSWORD
          value: "putto4us"
        - name: DB_NAME
          value: "my_database"

```

#### **4. 백엔드 파드용 서비스 생성 (ClusterIP)**

Nginx 파드가 백엔드를 찾을 수 있도록 연결 통로를 생성합니다.

```yaml
# backend-internal-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: backend-service
spec:
  selector:
    app: backend-app
  ports:
  - protocol: TCP
    port: 80           # 서비스 노출 포트
    targetPort: 8080   # 파드 내부 앱 포트
  type: ClusterIP

```

---

### **실전 팁 (Tips & Best Practices)**

* **유연성:** IP 주소를 코드에 하드코딩하지 않고 `ExternalName` 서비스를 사용하면, 추후 DB를 AWS RDS로 이전하더라도 서비스 파일의 `externalName` 값만 변경하면 되므로 애플리케이션 수정이 필요 없습니다.
* **보안:** 현재 예제에서는 비밀번호를 직접 노출했으나, 운영 환경에서는 **Kubernetes Secret** 객체를 사용하여 암호화된 데이터를 참조하는 것이 필수적입니다.
* **비용 안내:** * 해당 구성은 사설 네트워크(VPC 내) 통신이므로 AWS 상에서 추가적인 **데이터 전송 비용은 발생하지 않습니다.**
* 단, DB 통신량이 매우 방대할 경우 인스턴스의 네트워크 대역폭 한도를 체크해야 합니다.



---

Next Step: Secret 객체 생성 및 Deployment 적용 방법
