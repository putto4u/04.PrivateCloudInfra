
## 여러 노드를 클러스터로 구축하기

예) 마스터노드 192.168.115.251    vm 1번을 할당 받은 마스터의 예

##  1단계
1. 192.168.115.1  - vm15-01         4개 워커노드와 Xshell로 ssh 키교환, 연결 확인
2. 192.168.116.1  - vm16-01         
3. 192.168.117.1  - vm17-01
4. 192.168.118.1  - vm18-01

## 2단계  
1. 마스터에서 4개 워커노드와 ssh 키교환, 연결확인,  최초 핑거프린트 1번, 이후 비번넣기 없어야 함
2. 워커노드에서도 마스터로 ssh 연결가능토록 키 전송 및 테스트 

## 3단계
1. 워커노드 k8s 1~3단계 설치(해당 PC만)   **확인방법   $ kubectl get pod 했을때 명령어가 없는경우
2. 마스터에서 토근 생성하고 메모장에 복사하기
3. 교재에따라 각 워커노드 터미널에서
4. 워커노드에서 master@vm1:~$ sudo kubeadm join 192.168.100.251:6443 --token +토큰+ --cri-socket /run/containerd/containerd.sock 실행하기
5. 마스터에서 $ kubectl get nodes
6. 2,3,4번 워커노드도 마스터 연결

## 4단계   -   각 워커노드에서 kubectl 명령어를 사용하려면 마스터의 환경파일을 전송해야 합니다. 
1. 워커노드에서 ~홈 $ mkdir .kube  디렉토리 생성 확인
3. 마스터에서 scp  -r $HOME/.kube/config     master@192.168.pc번호,vm번호:$HOME/.kube/config
4. 워커노드   sudo chown master:master $HOME/.kube/config
5. 워커노드에서 $ kubectl get pop 명령어로 테스트

## 5단계 마스터 노드에서 확인
1. $ k  get  node 에서 4개의 노드가 모두 보이면 성공
2. $ mkdir ~/k8s/multinode/
3. $ multi-ngin-dp.yml  작성 (엔진엑스 디플로이먼트 2개, 간단한 인덱스화면 추가, servie type = Nodeport )
4. $ multi-pyweb-dp.yml  작성 (파이썬3웹서버 디플로이먼트 2개, 간단한 인덱스화면 추가, servie type = Nodeport )

## 6단계 서비스 확인
1. $ k get pod, deploy, svc  -o wide 
2. 브라우저, curl 로 웹서비스 두개 화면 확인하기  http://192.168.115~118.1:30005
3. 
   
 




