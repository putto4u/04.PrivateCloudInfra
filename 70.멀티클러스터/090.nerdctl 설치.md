# nerdctl 설치 및 설정 가이드

`nerdctl`은 `containerd`의 하위 프로젝트로, Docker CLI와 호환되는 명령어 인터페이스를 제공하는 도구입니다. `containerd`를 설치하더라도 `nerdctl`은 기본적으로 포함되어 있지 않으므로 별도의 바이너리 설치가 필요합니다.

Kubernetes(k8s) 환경에서 `containerd`를 런타임으로 사용할 때, Docker CLI 대신 컨테이너를 디버깅하거나 이미지를 관리하기 위해 필수적으로 사용됩니다.

## 1. nerdctl 개요

* **정의**: Docker-compatible CLI for containerd
* **특징**:
* `docker` 명령어와 거의 동일한 문법 사용 (`docker run` → `nerdctl run`)
* Docker 데몬 없이 `containerd`와 직접 통신
* Kubernetes 네임스페이스(`k8s.io`) 지원
* Lazy-pulling(eStargz) 등 containerd의 최신 기능 활용 가능



## 2. 설치 방법 (Linux amd64 기준)

최신 버전은 [nerdctl GitHub Releases](https://github.com/containerd/nerdctl/releases) 페이지에서 확인할 수 있습니다.

### 2.1. 바이너리 다운로드 및 압축 해제

`nerdctl`의 "Full" 버전은 CNI 플러그인(네트워크 관련)을 포함하지만, Kubernetes 환경이 이미 구축되어 있다면 "Minimal" 버전만으로도 충분합니다. 아래는 Minimal 버전 설치 예시입니다.

```bash
# 버전 변수 설정 (최신 버전 확인 권장)
NERDCTL_VERSION="1.7.6"

# 다운로드
wget https://github.com/containerd/nerdctl/releases/download/v${NERDCTL_VERSION}/nerdctl-${NERDCTL_VERSION}-linux-amd64.tar.gz

# 압축 해제 및 바이너리 이동 (/usr/local/bin)
sudo tar Cxzf /usr/local/bin nerdctl-${NERDCTL_VERSION}-linux-amd64.tar.gz

# 설치 확인
nerdctl version

```

### 2.2. 자동 완성 설정 (선택 사항)

쉘 사용 편의성을 위해 자동 완성을 활성화합니다.

```bash
# bash 사용자
source <(nerdctl completion bash)
echo "source <(nerdctl completion bash)" >> ~/.bashrc

```

## 3. Kubernetes 환경에서의 주요 사용법

Kubernetes는 `containerd`를 사용할 때 기본적으로 `k8s.io`라는 별도의 **네임스페이스(Namespace)**를 사용합니다. 단순히 `nerdctl ps`를 입력하면 기본 네임스페이스(`default`)를 조회하므로 Kubernetes 포드(Pod)들이 보이지 않을 수 있습니다.

### 3.1. Kubernetes 네임스페이스 조회

Kubernetes에서 실행 중인 컨테이너를 확인하려면 `-n k8s.io` 옵션을 사용해야 합니다.

```bash
# Kubernetes 컨테이너 목록 확인
nerdctl --namespace k8s.io ps -a

```

### 3.2. 별칭(Alias) 설정을 통한 편의성 증대

매번 네임스페이스 옵션을 입력하는 번거로움을 줄이기 위해 alias를 설정하는 것이 효율적입니다.

```bash
# .bashrc 또는 .zshrc에 추가
alias kctl='nerdctl -n k8s.io'

```

이제 `kctl ps`, `kctl images` 명령어로 Kubernetes 상의 컨테이너와 이미지를 Docker처럼 관리할 수 있습니다.

---

**[실전 Tip] Docker와 nerdctl의 차이점**
`docker` 명령어는 Docker Daemon(`dockerd`)을 거쳐 `containerd`를 호출하지만, `nerdctl`은 `containerd` 소켓을 직접 바라봅니다. 따라서 k8s 노드에서 "Docker로는 안 보이는데 프로세스는 떠 있는" 컨테이너를 추적할 때 `nerdctl`이나 `crictl`이 필수적입니다.

---

### Next Step:

nerdctl을 활용한 이미지 빌드 및 k8s 네임스페이스 관리 심화

-----------
# nerdctl 설치 파일 다운로드 실패 원인 및 해결

공식 GitHub Releases 페이지의 URL 구조와 사용자가 입력한 명령어의 변수 처리 방식에서 불일치가 발생하여 다운로드가 실패한 것입니다. 정확한 원인과 수정된 명령어를 제시합니다.

## 1. 실패 원인 분석 (404 Not Found)

`wget` 명령어가 실패하는 주된 이유는 환경 변수 `${NERDCTL_VERSION}`이 선언되지 않았거나, 버전 표기 방식(v 포함 여부)이 잘못되었기 때문입니다.

1. **변수 미설정**: `${NERDCTL_VERSION}`이 빈 값일 경우, URL이 `.../download/v/nerdctl--linux...`로 완성되어 파일이 존재하지 않습니다.
2. **`v` 중복**: 변수에 `v2.0.0`처럼 `v`를 포함할 경우, URL이 `.../download/vv2.0.0/...`이 되어 경로 오류가 발생합니다.
3. **파일명 규칙 위반**: nerdctl의 릴리스 파일명은 버전에 `v` 접두사가 붙지 않습니다. (예: `nerdctl-2.0.0-linux-amd64.tar.gz`)

---

## 2. 해결 방법: 올바른 변수 설정 및 다운로드

공식 릴리스 페이지(`https://github.com/containerd/nerdctl/releases`)의 규칙에 따라 변수에는 **숫자만** 입력해야 합니다.

### 올바른 명령어 (Minimal 버전)

```bash
# 1. 버전 변수 설정 (v 제외하고 숫자만 입력, 예: 2.0.0)
export NERDCTL_VERSION=2.0.0

# 2. wget 다운로드 실행
wget "https://github.com/containerd/nerdctl/releases/download/v${NERDCTL_VERSION}/nerdctl-${NERDCTL_VERSION}-linux-amd64.tar.gz"

```

### 참고: Full 버전 다운로드 시

앞선 질의에서 언급한 의존성 도구(CNI, BuildKit 등)가 포함된 버전을 받으려면 파일명에 `full`을 추가해야 합니다.

```bash
wget "https://github.com/containerd/nerdctl/releases/download/v${NERDCTL_VERSION}/nerdctl-full-${NERDCTL_VERSION}-linux-amd64.tar.gz"

```

---

## 3. 다운로드 파일 검증

다운로드 후 파일이 정상적인지 확인합니다.

```bash
# 파일 목록 및 용량 확인
ls -lh nerdctl-*.tar.gz

# (선택) 체크섬 검증 파일 다운로드
wget "https://github.com/containerd/nerdctl/releases/download/v${NERDCTL_VERSION}/SHA256SUMS"
sha256sum -c SHA256SUMS --ignore-missing

```

### Next Step:

다운로드한 nerdctl 바이너리 설치 및 경로 설정(`/usr/local/bin`)

