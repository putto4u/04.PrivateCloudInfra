쿠버네티스(Kubernetes) 운영의 기초를 다지기 위한 실습 30단계를 구성했습니다. 이 내용은 깃허브(GitHub) 등에 바로 업로드하여 교재로 활용하실 수 있도록 마크다운 포맷으로 작성되었습니다.

---

# 쿠버네티스(k8s) 기초 실습 30단계

### 실습 준비 사항

* 모든 실습은 `kubectl` 명령어를 기반으로 합니다.
* 가상 예시 데이터(ID, IP 등)를 포함하고 있습니다.

---

### [Part 1: 파드(Pod) 및 기본 운영]

**1. Nginx 파드 생성**

* **설명:** 가장 기본적인 단위인 파드를 생성합니다.
* **명령어:**
```bash
kubectl run nginx-pod --image=nginx # nginx 이미지를 사용하여 nginx-pod 생성

```


* **결과 확인:** `pod/nginx-pod created`
* **로그 확인:** `kubectl logs nginx-pod` (Nginx 시작 로그 출력)
* **에러 예시:** `ImagePullBackOff` (이미지 이름 오타 시)
* **해결 방법:** `kubectl edit pod nginx-pod`로 이미지 이름 수정 또는 삭제 후 재생성.

**2. 실행 중인 파드 상세 정보 확인**

* **설명:** 파드의 IP와 할당된 노드를 확인합니다.
* **명령어:**
```bash
kubectl get pods -o wide # 파드의 IP와 노드 정보를 포함하여 출력

```


* **결과 예시:** `NAME: nginx-pod, IP: 10.244.1.5, NODE: worker-node1`
* **로그/에러:** 정보 조회 명령이므로 에러 발생 적음.

**3. 파드 내부에서 명령어 실행 (커널 버전 확인)**

* **설명:** `exec`를 이용해 파드 내부 컨테이너에 접근합니다.
* **명령어:**
```bash
kubectl exec nginx-pod -- uname -a # 파드 내부의 OS 커널 정보 출력

```


* **결과 예시:** `Linux nginx-pod 5.15.0-generic ...`
* **에러 예시:** `Error from server (NotFound): pods "nginx-pod" not found`
* **해결 방법:** 파드가 `Running` 상태인지 확인 후 이름 재확인.

**4. 파드 서비스 포트 포워딩**

* **설명:** 로컬 포트를 파드 포트로 연결하여 접속 테스트를 합니다.
* **명령어:**
```bash
kubectl port-forward nginx-pod 8080:80 # 로컬 8080을 파드 80으로 연결

```


* **결과 확인:** `Forwarding from 127.0.0.1:8080 -> 80`
* **로그:** 접속 시 `GET / HTTP/1.1 200` 로그 발생.
* **에러 예시:** `error: unable to listen on any of the requested ports: [{8080 0}]`
* **해결 방법:** 로컬에서 8080 포트를 이미 사용 중인지 확인 (`lsof -i :8080`).

**5. 파드 라벨(Label) 추가**

* **설명:** 관리 편의를 위해 파드에 라벨을 붙입니다.
* **명령어:**
```bash
kubectl label pods nginx-pod tier=frontend # 파드에 tier=frontend 라벨 부여

```


* **결과 확인:** `kubectl get pods --show-labels`
* **에러 예시:** `error: 'tier' already has a value`
* **해결 방법:** `--overwrite` 옵션을 추가하여 덮어쓰기 실행.

---

### [Part 2: 디플로이먼트(Deployment) 관리]

**6. Deployment 생성 (복제본 3개)**

* **설명:** 여러 개의 파드를 유지하는 디플로이먼트를 생성합니다.
* **명령어:**
```bash
kubectl create deployment web-deploy --image=nginx --replicas=3 # 3개의 복제본 생성

```


* **결과 예시:** `deployment.apps/web-deploy created`
* **에러 예시:** `CrashLoopBackOff` (컨테이너 내부 로직 오류 시)
* **해결 방법:** `kubectl logs`로 애플리케이션 에러 메시지 분석.

**7. 리소스 스케일링 (확장)**

* **설명:** 파드 개수를 5개로 늘립니다.
* **명령어:**
```bash
kubectl scale deployment web-deploy --replicas=5 # 복제본을 5개로 변경

```


* **결과 확인:** `kubectl get rs` (ReplicaSet의 DESIRED가 5로 변경됨)

**8. 이미지 업데이트 (Rolling Update)**

* **설명:** 운영 중인 컨테이너 이미지를 새 버전으로 변경합니다.
* **명령어:**
```bash
kubectl set image deployment/web-deploy nginx=nginx:1.21 # nginx 버전을 1.21로 업데이트

```


* **결과 확인:** `kubectl rollout status deployment/web-deploy`
* **에러 예시:** `ErrImagePull` (존재하지 않는 버전 태그 입력 시)
* **해결 방법:** 정확한 태그로 다시 `set image` 실행.

**9. 업데이트 이력 확인**

* **설명:** 변경 기록을 확인합니다.
* **명령어:**
```bash
kubectl rollout history deployment/web-deploy # 변경 이력 리스트 출력

```


* **결과 예시:** `REVISION 1, REVISION 2`

**10. 롤백 (Rollback)**

* **설명:** 이전 버전으로 되돌립니다.
* **명령어:**
```bash
kubectl rollout undo deployment/web-deploy # 직전 단계로 복구

```


* **결과 확인:** `deployment.apps/web-deploy rolled back`

---

### [Part 3: 서비스(Service) 및 네트워크]

**11. ClusterIP 서비스 생성**

* **설명:** 클러스터 내부에서만 통신 가능한 IP를 생성합니다.
* **명령어:**
```bash
kubectl expose deployment web-deploy --port=80 --target-port=80 # 내부 서비스 노출

```


* **결과 확인:** `kubectl get svc web-deploy` -> `CLUSTER-IP: 10.96.x.x`

**12. NodePort 서비스 생성**

* **설명:** 외부에서 노드 IP와 특정 포트로 접근할 수 있게 합니다.
* **명령어:**
```bash
kubectl expose deployment web-deploy --type=NodePort --port=80 # 외부 노출용 서비스

```


* **결과 확인:** `PORT(S): 80:3xxxx/TCP` (30000~32767 사이 포트 확인)
* **에러 예시:** `Connection refused` (노드 IP를 틀렸거나 방화벽이 막힌 경우)
* **해결 방법:** VirtualBox 설정에서 해당 포트 포워딩 또는 `ufw allow` 확인.

**13. 서비스 엔드포인트(Endpoints) 확인**

* **설명:** 서비스가 실제 어떤 파드 IP와 연결되었는지 확인합니다.
* **명령어:**
```bash
kubectl get endpoints web-deploy # 서비스와 연결된 실제 파드 IP 목록 확인

```


* **결과 예시:** `ENDPOINTS: 10.244.1.5:80, 10.244.2.3:80...`

**14. 임시 파드에서 서비스 호출 테스트**

* **설명:** 클러스터 내부 DNS가 작동하는지 확인합니다.
* **명령어:**
```bash
kubectl run busybox --image=busybox -it --restart=Never -- wget -O- web-deploy # 서비스 이름으로 호출

```


* **결과 예시:** `HTML 소스 코드 출력`
* **에러 예시:** `wget: bad address 'web-deploy'`
* **해결 방법:** `CoreDNS` 파드가 정상 작동 중인지 확인 (`kubectl get pods -n kube-system`).

**15. 라벨 셀렉터(Selector) 수정**

* **설명:** 서비스가 바라보는 파드 그룹을 변경합니다.
* **명령어:**
```bash
kubectl edit svc web-deploy # selector 부분의 라벨 수정

```



---

### [Part 4: 설정 및 스토리지 (Config/Storage)]

**16. 컨피그맵(ConfigMap) 생성**

* **설명:** 애플리케이션 설정값을 저장합니다.
* **명령어:**
```bash
kubectl create configmap app-config --from-literal=DB_URL=localhost # 리터럴로 생성

```



**17. 시크릿(Secret) 생성**

* **설명:** 비밀번호 등 민감 정보를 저장합니다.
* **명령어:**
```bash
kubectl create secret generic app-secret --from-literal=PASSWORD=p@ssword # 비밀 정보 생성

```



**18. 파드에 환경변수 주입**

* **설명:** 위에서 만든 설정을 파드에 적용합니다. (YAML 수정 필요)
* **에러 예시:** `CreateContainerConfigError`
* **해결 방법:** ConfigMap 이름이 YAML에 정의된 이름과 일치하는지 확인.

**19. 리소스 제한(Limit) 설정**

* **설명:** 파드가 사용할 CPU/메모리 최대치를 설정합니다.
* **에러 예시:** `OOMKilled` (메모리 제한을 너무 낮게 잡은 경우)
* **해결 방법:** `resources.limits.memory` 값을 증설.

**20. 네임스페이스(Namespace) 생성**

* **설명:** 논리적인 격리 공간을 만듭니다.
* **명령어:**
```bash
kubectl create namespace dev-team # dev-team 네임스페이스 생성

```



---

### [Part 5: 고급 관리 및 트러블슈팅]

**21. 모든 네임스페이스 파드 조회**

* **명령어:** `kubectl get pods -A`
**22. 노드 자원 상태 확인:** `kubectl top nodes` (Metrics Server 설치 시 가능)
**23. 파드 이벤트 확인:** `kubectl get events --sort-by='.lastTimestamp'`
**24. 파드 YAML 파일 추출:** `kubectl get pod nginx-pod -o yaml > nginx.yaml`
**25. 리소스 강제 삭제:** `kubectl delete pod nginx-pod --force`
**26. 노드 스케줄링 중단:** `kubectl cordon worker-node1` (점검 시 사용)
**27. 노드 파드 비우기:** `kubectl drain worker-node1 --ignore-daemonsets`
**28. API 서버 버전 확인:** `kubectl version --short`
**29. 클러스터 정보 요약:** `kubectl cluster-info`
**30. 리소스 설명 보기:** `kubectl explain pod.spec` (필드 정의 확인 시 유용)

---

**Next Step: 쿠버네티스 YAML 매니페스트 작성법 및 Helm 차트 기본**

* **참고:** `kubectl top` 명령어 사용을 위해서는 Metrics Server 설치가 필요하며, 이 과정에서 `kubelet-insecure-tls` 설정 에러가 자주 발생하므로 별도의 추가 실습이 권장됩니다. 해당 실습들은 별도의 **유료 클라우드 비용 없이** VirtualBox 내 Ubuntu 환경에서 모두 수행 가능합니다.
