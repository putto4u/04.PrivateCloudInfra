## k8s 명령어 자동완성


```
** bash-completion 패키지 설치 (Ubuntu 기준)
sudo apt-get install bash-completion -y

** 쉘 설정 파일(~/.bashrc)에 자동 완성 스크립트 추가
echo 'source <(kubectl completion bash)' >> ~/.bashrc

** 현재 세션에 즉시 적용
source ~/.bashrc
```

2. 별칭(Alias) 설정
```
Bash
# k 별칭 추가 및 자동 완성 연결
echo 'alias k="kubectl"' >> ~/.bashrc
echo 'complete -o default -F __start_kubectl k' >> ~/.bashrc

# 변경 사항 적용
source ~/.bashrc
```



# k8s 컨트롤 플레인 상태 확인
```
$ kubectl cluster-info

$ sudo -i 
# kubelet --version
:
# kubelet version --output=yaml

$ kubectl get nodes -o wide

$ kubectl get pods -o wide

### 마스터노드에 pod 추가
kubectl describe node mymaster01 | grep Taints

kybectl taint nodes --all node-role.kubernetes.io/controlplane-node/mymaster01  untainted
안되면 **kybectl taint nodes --all node-role.kubernetes.io/control-plane-**


kubectl dlete pood helloo-world

kubectl get pod





```

# watch kybectl get pods -n calico-system

$ kubectl get nodes  # 노드상태 확인

$ kubectl cluster-info


kubectl get pods -n kube-system


kubectl get componentstatuses   # 컴포넌트 헬스 체크
또는 kubectl get cs


curl -k https://localhost:6443/livez  # API 서버 통신 테스트
ok








-------------------------------------------------------------------
##### 마스터 노드 설정 다른 방법(Calico 등)
$ kubeadm  certs  check-expiration # 쿠버네 인증서 확인

$ kubeadm config images list  # 사용할 이미지 리스트 확인

$ sudo i 
```
# kubeadm config images pull 쿠버네티스 마스터노드 이미지 다운로드
:error : CRI 여러개...

# kubeadm config images pull --cri-socket   /run/containderd/containerd.sock  # CRI 를 containerd로 설정해서 이미지 pull

# kubeadm  init --apiserver-advertise-address=10.0.2.4  \     # 마스터노드 ip 설정 
  --pod-network-cidr=192.168.0.0/16    \  Calicl 일때, flannel : 10.244.0.0/16 
  --cri-socket /run/containderd/containerd.sock 

  : 토큰값 메모장 메모 또는 .ssh에 저장

# kubeadm cert check-expiration
: 정상

#exit
```

#### 2. 유저(root가 아닌)도 kubectl을 사용할 수 있도록 환경 변수 설정
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config


## Calico 설치 및 설정

$ kubectl create -f https://raw.githubusercontent.com/proectcalico/calico/v3.26.3/manifests/tigera-operator.yaml
:
$ curl https://raw.githubusercontent.com/projectcalico/calico/v3.26.3/manifests/custom-resources.yaml -0

$ ls
  custom-resources.yaml   /work

$ kubectl create -f custom-resources.yaml  # 야믈 실행 Calico 설치
:


$ watch kubectl get pods -n calico-system  # 설치 및 실행 확인, 시간 소요 약 2분
: ....... running

$ kubectl get node -o wide  # 클러스터 노드 확인
:   1개만 있음, 

```
#마스터 노드에 파드 추가하고 싶은 경우
$ kubectl get node
:
$ kubectl describe node myserver01 |grep Taints
Taints : ...
$ kubectl taint nodes --all node-role.kubernetes.io/controlplane-node/myserver01  untainted # 과거 규칙
에러시 $ kubectl taint nodes --all node-role.kubernetes.io/controlplane-
```
마스터 노드 설정 끝

### 워커노드 설정
```
$ mkdir -p $HOME/.kube
$ scp -p   계정@10.0.2.4:~/.kube/config ~/.kube/config    # 마스터노드환경 복사해 오기 , scp : secure copy  안되면 $ scp -P 2222 -p 계정@....
passwd: 

$ cd .kube/
$ ls
config
$ chmod 600 ~./kube/config

$ kubectl get nodes  # 마스터에게 요청 확인
안될경우 마스터에서 일반계정 rw  권한 변뎡
master $ sudo cp /etc/kubernetes/admin.conf  ~/config_temp
sudo chown  계정:계정  ~/config_temp

워커노드에서
scp 계정@ 10.0.2.4:~/config_temp ~/.kube/config
```
```
$ sudo i
root# kubeadmin join 10.0.2.1:6443 --token "....."   --cri-socket  /run/containerd/containerd.sock
```

마스터에서 노드 추가 확인
$ kubectl get node
:
:

워쿼노드 계속 추가...


## Hello World!
```
kubectl run hello-world   --image=hello-world  --restart=Never pod/hello-world created
pod/hello-world created

kubectl get pod
:
kubectl logs hello-world
:
```








