## Kubernetes 기초 실습 가이드: 상세 분석 및 검증

이 가이드는 Kubernetes의 핵심 오브젝트 10가지를 실습할 때, 각 구성 요소가 의도대로 동작하는지 확인하는 구체적인 방법과 예상 결과를 포함합니다. 모든 코드는 `kubectl` CLI를 통해 검증 가능하도록 설계되었습니다.

---

### 1. Pod (포드): 최소 배포 단위 실습

**모범 답안: `pod.yaml**`

```yaml
apiVersion: v1              # Kubernetes API 버전
kind: Pod                   # 리소스 타입
metadata:
  name: web-server          # Pod의 고유 이름
  labels:
    env: training           # 관리용 라벨링
spec:
  containers:
  - name: nginx-container   # 컨테이너 이름
    image: nginx:1.25       # 사용할 도커 이미지
    ports:
    - containerPort: 80     # 컨테이너가 사용하는 포트

```

**검증 및 확인**

```bash
# 1. 생성 및 상태 확인
kubectl apply -f pod.yaml
kubectl get pod web-server

```

> **확인 결과 예시**
> ```text
> NAME         READY   STATUS    RESTARTS   AGE
> web-server   1/1     Running   0          15s
> 
> ```
> 
> 
> * **STATUS:** `Running`은 컨테이너가 정상 실행 중임을 의미합니다.
> * **READY:** `1/1`은 Pod 내의 1개 컨테이너 중 1개가 준비 완료되었음을 뜻합니다.
> 
> 

---

### 2. Deployment (디플로이먼트): 상태 유지 및 스케일링

**모범 답안: `deployment.yaml**`

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-deploy
spec:
  replicas: 3               # 유지하고자 하는 Pod의 개수
  selector:
    matchLabels:
      app: web              # 이 라벨을 가진 Pod들을 관리함
  template:                 # 생성될 Pod의 템플릿
    metadata:
      labels:
        app: web            # Pod에 부여될 라벨
    spec:
      containers:
      - name: nginx
        image: nginx:1.25

```

**검증 및 확인**

```bash
# 1. 배포 상태 및 복제본 수 확인
kubectl get deployment web-deploy

```

> **확인 결과 예시**
> ```text
> NAME         READY   UP-TO-DATE   AVAILABLE   AGE
> web-deploy   3/3     3            3           40s
> 
> ```
> 
> 
> * **READY 3/3:** 사용자가 요청한 3개의 복제본이 모두 정상 동작 중입니다.
> * **UP-TO-DATE:** 최신 설정이 적용된 Pod의 수입니다.
> 
> 

---

### 3. Service - ClusterIP: 내부 로드밸런싱

**모범 답안: `svc-clusterip.yaml**`

```yaml
apiVersion: v1
kind: Service
metadata:
  name: internal-svc
spec:
  selector:
    app: web                # Deployment에서 설정한 라벨과 일치해야 함
  ports:
    - protocol: TCP
      port: 80              # 서비스의 포트
      targetPort: 80        # Pod의 포트
  type: ClusterIP           # 내부 통신용 (기본값)

```

**검증 및 확인**

```bash
# 1. 서비스 IP 확인
kubectl get svc internal-svc

```

> **확인 결과 예시**
> ```text
> NAME           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
> internal-svc   ClusterIP   10.96.100.15    <none>        80/TCP    10s
> 
> ```
> 
> 
> * **CLUSTER-IP:** 클러스터 내부에서만 유효한 고정 VIP입니다.
> * **EXTERNAL-IP:** `none`으로 표시되며 외부 접근은 차단됩니다.
> 
> 

---

### 4. Service - NodePort: 외부 접속 허용

**모범 답안: `svc-nodeport.yaml**`

```yaml
apiVersion: v1
kind: Service
metadata:
  name: public-svc
spec:
  type: NodePort            # 외부 노출을 위해 설정
  selector:
    app: web
  ports:
    - port: 80
      targetPort: 80
      nodePort: 30080       # 노드 IP의 30080 포트로 접속 가능

```

**검증 및 확인**

```bash
# 1. 할당된 포트 확인
kubectl get svc public-svc

```

> **확인 결과 예시**
> ```text
> NAME         TYPE       CLUSTER-IP      PORT(S)        AGE
> public-svc   NodePort   10.96.200.50    80:30080/TCP   5s
> 
> ```
> 
> 
> * **PORT(S):** `80:30080`은 클러스터 외부에서 노드 IP와 `30080` 포트를 결합해 접속 가능하다는 뜻입니다.
> 
> 

---

### 5. ConfigMap (컨피그맵): 비민감 설정 관리

**모범 답안: `config.yaml**`

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
data:
  LOG_LEVEL: "INFO"         # 설정 키와 값
  VERSION: "1.0.0"

```

**검증 및 확인**

```bash
# 1. 생성된 데이터 내용 상세 확인
kubectl describe configmap app-config

```

> **확인 결과 예시**
> ```text
> Data
> ====
> LOG_LEVEL:
> ----
> INFO
> VERSION:
> ----
> 1.0.0
> 
> ```
> 
> 

---

### 6. Secret (시크릿): 보안 데이터 관리

**모범 답안: `secret.yaml**`

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: db-auth
type: Opaque
data:
  username: YWRtaW4=        # 'admin'을 base64로 인코딩한 값
  password: cGFzc3dvcmQ=    # 'password'를 base64로 인코딩한 값

```

**검증 및 확인**

```bash
# 1. 시크릿 복호화 확인 (사용자 검증용)
kubectl get secret db-auth -o jsonpath='{.data.username}' | base64 --decode

```

> **확인 결과 예시**
> ```text
> admin
> 
> ```
> 
> 
> * 실제 데이터가 Base64로 안전하게(?) 인코딩되어 저장되었는지 확인합니다.
> 
> 

---

### 7. Liveness Probe: 자가 치유 확인

**모범 답안: `liveness.yaml` (Pod spec 일부)**

```yaml
livenessProbe:
  httpGet:                  # HTTP 요청으로 상태 확인
    path: /healthz
    port: 8080
  initialDelaySeconds: 5    # 컨테이너 시작 후 5초 대기
  periodSeconds: 5          # 5초 간격으로 반복 검사

```

**검증 및 확인**

```bash
# 1. 재시작 횟수 모니터링
kubectl get pod <pod-name> -w

```

> **확인 결과 예시**
> ```text
> NAME            READY   STATUS    RESTARTS   AGE
> liveness-test   1/1     Running   3          5m
> 
> ```
> 
> 
> * **RESTARTS:** 애플리케이션에 문제가 생겨 Probe가 실패하면 이 숫자가 올라갑니다.
> 
> 

---

### 8. Namespace (네임스페이스): 환경 격리

**모범 답안: `ns.yaml**`

```yaml
apiVersion: v1
kind: Namespace
metadata:
  name: education           # 교육용 논리적 그룹 생성

```

**검증 및 확인**

```bash
# 1. 전체 네임스페이스 목록 조회
kubectl get ns

```

> **확인 결과 예시**
> ```text
> NAME          STATUS   AGE
> default       Active   2d
> education     Active   10s
> kube-system   Active   2d
> 
> ```
> 
> 

---

### 9. PersistentVolumeClaim (PVC): 동적 스토리지 요청

**모범 답안: `pvc.yaml**`

```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: data-pvc
spec:
  accessModes:
    - ReadWriteOnce         # 하나의 노드에서 읽기/쓰기 가능
  resources:
    requests:
      storage: 1Gi          # 1기가바이트 요청

```

**검증 및 확인**

```bash
# 1. 바인딩 상태 확인
kubectl get pvc data-pvc

```

> **확인 결과 예시**
> ```text
> NAME       STATUS   VOLUME                                     CAPACITY   ACCESS MODES   AGE
> data-pvc   Bound    pvc-1234abcd-5678-efgh                     1Gi        RWO            30s
> 
> ```
> 
> 
> * **STATUS - Bound:** 실제 저장 공간(PV)이 성공적으로 할당되었음을 나타냅니다. (**AWS 등 클라우드 환경 시 과금 주의**)
> 
> 

---

### 10. Label & Selector: 연관 관계 확인

**검증 및 확인 (CLI 실습)**

```bash
# 1. 특정 라벨을 가진 Pod만 필터링 조회
kubectl get pods -l env=training

```

> **확인 결과 예시**
> ```text
> NAME         READY   STATUS    RESTARTS   AGE
> web-server   1/1     Running   0          20m
> 
> ```
> 
> 
> * 설정한 라벨(`env: training`)이 일치하는 리소스만 선택되어 출력됩니다.
> 
> 

---

**Next Step: Kubernetes Troubleshooting (로그 분석 및 트러블슈팅)**

실습 과정에서 `kubectl describe` 명령어는 리소스의 상세 상태와 에러 메시지를 확인하는 데 가장 중요한 도구입니다. 각 단계의 확인 결과를 통해 Kubernetes의 선언적 동작 방식을 이해하셨기를 바랍니다.
