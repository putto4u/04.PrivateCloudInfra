쿠버네티스 클러스터 전체를 대표하는 IP는 **어떤 관점에서 보느냐**에 따라 세 가지로 나뉩니다. 

---

## 클러스터를 대표하는 3가지 IP

### 1. 외부 사용자 관점: [External IP] (또는 LoadBalancer IP)

일반 사용자가 인터넷이나 사내 망에서 서비스에 접속할 때 사용하는 **"진짜 대표 IP"**입니다.

* **실사례**: `192.168.100.200` (MetalLB나 클라우드 로드밸런서가 할당한 주소)
* **특징**: 클러스터 내부에 수많은 서비스가 있어도, 외부에서는 오직 이 관문 IP(또는 인그레스 도메인)를 통해 들어옵니다.

### 2. 관리자/API 관점: [Control Plane IP] (Master Node IP)

`kubectl` 명령어를 날리거나 워커 노드들이 조인할 때 바라보는 **"제어 센터의 대표 IP"**입니다.

* **실사례**: `192.168.100.251` (Master Node의 실제 호스트 IP)
* **특징**: `kubeconfig` 파일 안에 적혀 있는 주소이며, 쿠버네티스 시스템 자체가 통신하는 기점입니다.

### 3. 내부 서비스 관점: [Kubernetes Service IP] (Default ClusterIP)

클러스터 내부에서 "나 쿠버네티스 서버랑 통신하고 싶어"라고 할 때 사용하는 **"논리적 대표 IP"**입니다.

* **실사례**: `10.96.0.1`
* **특징**: 모든 네임스페이스에서 `kubernetes`라는 이름의 서비스를 조회하면 나오는 IP로, API 서버로 연결되는 내부 고정 통로입니다.

---

## 대표 IP들의 흐름도

| 구분 | 주소 예시 | 대표성 | 용도 |
| --- | --- | --- | --- |
| **서비스 대표** | `192.168.100.200` | **외부 노출** | 고객이 웹사이트 접속할 때 쓰는 대문 주소 |
| **인프라 대표** | `192.168.100.251` | **시스템 제어** | `kubeadm join` 하거나 `kubectl` 쓸 때 쓰는 주소 |
| **내부망 대표** | `10.96.0.1` | **내부 표준** | 컨테이너들이 K8s API 서버 찾을 때 쓰는 주소 |

---


Kubernetes 클러스터를 설계할 때 가장 중요한 요소 중 하나는 **네트워크 대역 간의 충돌 방지**입니다. 노드(Host), 파드(Pod), 서비스(Cluster IP) 대역은 서로 겹치지 않도록 격리되어야 원활한 라우팅이 가능합니다.

---

## 1. 네트워크 대역 설계 예시

요청하신 조건에 따라 노드 대역이 `192.168.0.0/16`일 때, 나머지 대역을 `10.0.0.0` 대역 내에서 충돌 없이 구성한 예시입니다.

| 구분 | 할당 대역 (CIDR) | 가용 IP 범위 | 비고 |
| --- | --- | --- | --- |
| **Node IP** | `192.168.0.0/16` | `192.168.0.1` ~ `192.168.255.254` | 물리 서버 또는 VM의 IP |
| **Pod IP** | `10.244.0.0/16` | `10.244.0.1` ~ `10.244.255.254` | 클러스터 내 전체 파드용 대역 |
| **Service IP** | `10.96.0.0/12` | `10.96.0.1` ~ `10.111.255.254` | Cluster IP (가상 IP) 대역 |

### 구성 시 고려사항

* **Pod 대역 (`--pod-network-cidr`):** 보통 `/16`을 할당하여 노드당 `/24`씩 서브넷을 쪼개어 배분합니다. (CNI 플러그인 설정 시 사용)
* **Service 대역 (`--service-cluster-ip-range`):** API 서버 실행 옵션에서 설정하며, 외부 통신이 아닌 클러스터 내부 통신용 가상 IP입니다.

---

## 2. 서비스(Service) 7개 할당 예시

서비스 7개가 생성될 경우, 위에서 정의한 **Service IP 대역 (`10.96.0.0/12`)** 내에서 다음과 같이 IP가 자동으로 할당됩니다. (Kubernetes는 대역의 첫 번째 IP인 `10.96.0.1`을 보통 `kubernetes.default` 서비스용으로 예약합니다.)

| 서비스 명 (예시) | 할당된 Cluster IP | 포트 | 타입 |
| --- | --- | --- | --- |
| **API Gateway** | `10.96.0.10` | 80/443 | ClusterIP |
| **Auth Service** | `10.96.0.11` | 8080 | ClusterIP |
| **User DB** | `10.96.0.12` | 5432 | ClusterIP |
| **Order Service** | `10.96.0.13` | 8080 | ClusterIP |
| **Payment Service** | `10.96.0.14` | 8080 | ClusterIP |
| **Logging Service** | `10.96.0.15` | 9200 | ClusterIP |
| **Web Frontend** | `10.96.0.16` | 80 | ClusterIP |

---

## 💡 실전 전문가 팁 (Best Practice)

1. **대역 중첩 주의:** 만약 사내 망이나 VPN 대역이 `10.0.0.0/8` 전체를 사용 중이라면, 위 예시인 `10.244.x.x`와 충돌이 날 수 있습니다. 이 경우 `172.16.0.0/12` 대역을 대안으로 검토하십시오.
2. **IP 고갈 문제:** 파드 대역을 너무 작게 잡으면 노드가 늘어날 때 파드 생성이 불가능해집니다. 최소 `/16` 이상을 권장합니다.
3. **AWS 사용 시 주의:** AWS VPC CNI를 사용할 경우 파드 IP가 노드 IP와 같은 VPC 대역에서 할당됩니다. 이 경우 별도의 `10.x.x.x` 대역 설정 대신 VPC 보조 CIDR을 활용해야 할 수도 있습니다. (이 경우 VPC IP 비용은 없으나 인스턴스 타입별로 할당 가능한 IP 개수 제한이 있습니다.)

---

Next Step: CNI 플러그인(Calico, Flannel 등)별 네트워크 설정 방법

요청하신 대로 192.168 대역 노드 환경에서 10점대 파드/서비스 IP 설계 예시를 작성했습니다. 교재 구성에 맞춰 가독성을 높였습니다. 추가 수정이 필요하면 말씀해 주세요.
