## 도커 이미지 관리 전략 및 실무 실습

도커 이미지는 컨테이너 실행의 핵심 요소입니다. 전문가들은 단순히 이미지를 만드는 것에 그치지 않고, **용량 최적화, 보안, 버전 관리**라는 세 가지 축을 중심으로 이미지를 관리합니다.

---

### 1. 전문가의 도커 이미지 관리 원칙

실무 환경에서 이미지를 관리할 때 반드시 적용해야 할 핵심 전략입니다.

#### ① 멀티 스테이지 빌드 (Multi-stage Build)

빌드 과정에서 필요한 도구(컴파일러, 라이브러리 등)와 실제 실행에 필요한 파일만을 분리하여 이미지 용량을 최소화합니다.

#### ② 태그 관리 전략 (Semantic Versioning)

`latest` 태그는 버전 추적이 불가능하므로 실무에서 지양합니다.

* **Version:** `v1.0.1` (기능별 버전 관리)
* **Commit ID:** `app:8a3c1d` (Git 커밋과 연동하여 문제 발생 시 추적 용이)

#### ③ 보안 스캔 및 경량 OS 사용

* `Alpine Linux`나 `Distroless` 같은 최소화된 OS 이미지를 사용하여 보안 취약점을 줄입니다.
* 이미지 배포 전 `Trivy`나 `Snyk` 같은 도구로 보안 취약점을 상시 점검합니다.

---

### 2. [실습] 효율적인 이미지 관리 프로세스

실제 터미널에서 수행하는 이미지 관리 및 최적화 실습입니다.

#### [Step 1] 미사용 리소스 일괄 정리

실습을 시작하기 전, 공간 확보를 위해 사용하지 않는 이미지와 컨테이너를 정리합니다.

```bash
# 사용 중이지 않은 모든 이미지, 컨테이너, 네트워크 삭제
docker system prune -a

```

#### [Step 2] 이미지 생성 및 태그 부여

동일한 이미지에 버전 정보와 커밋 정보를 포함하는 태그를 부여합니다.

```bash
# 로컬 빌드 (예: nginx 기반 커스텀 이미지)
docker build -t my-app:v1.0 .

# 배포를 위한 태그 추가 (계정명/이미지명:버전)
docker tag my-app:v1.0 putto4u/my-app:v1.0
docker tag my-app:v1.0 putto4u/my-app:8a3c1d

```

#### [Step 3] 이미지 레이어 확인 및 용량 분석

이미지가 어떻게 구성되어 있는지 레이어 단위를 분석하여 최적화 포인트를 찾습니다.

```bash
# 이미지 레이어 이력 확인
docker history putto4u/my-app:v1.0

```

---

### 3. 이미지 관리 주요 명령어 요약

전문가들이 일상적으로 사용하는 핵심 명령어 리스트입니다.

| 상황 | 명령어 | 설명 |
| --- | --- | --- |
| **목록 상세 확인** | `docker images --format "{{.Repository}}: {{.Size}}"` | 이미지 이름과 용량만 필터링하여 출력 |
| **Dangling 이미지 삭제** | `docker image prune` | 이름이 없는(`<none>`) 불필요한 레이어만 삭제 |
| **이미지 세부 정보** | `docker inspect [Image_Name]` | 이미지의 환경변수, 포트 설정, 레이어 구조 확인 |
| **이미지 저장/복구** | `docker save -o app.tar [Image]` / `docker load -i app.tar` | 네트워크 연결 없이 파일 형태로 이미지 전달 |

---

### 4. 실무형 이미지 생명주기 (Lifecycle)

1. **Build:** `Dockerfile`을 통해 일관된 환경으로 빌드합니다.
2. **Scan:** 빌드 직후 보안 취약점을 검사합니다.
3. **Registry Push:** 검증된 이미지만 프라이빗 레지스트리(ECR, Harbor 등)에 업로드합니다.
4. **Retention:** 레지스트리 정책을 통해 너무 오래된 이미지는 자동으로 삭제합니다.

---

### ⚠️ 인프라 및 비용 체크

* **AWS ECR:** 저장되는 이미지 용량에 따라 비용이 발생합니다. 실습용 이미지는 용량이 작은 `alpine` 기반을 사용하세요.
* **Local Disk:** Docker Desktop이나 VM 내부에 이미지가 쌓이면 디스크 부족 오류가 발생하므로 정기적으로 `prune` 명령어를 수행하세요.

---

**Next Step:** Dockerfile 최적화 기법(레이어 최소화), 프라이빗 레지스트리 구축, Trivy를 이용한 보안 스캔 실습.

실습 과정 중 특정 단계(예: Dockerfile 작성법)에 대해 더 자세한 설명이 필요하시면 알려주세요. 요청하신 대로 교재 포맷에 맞춰 성실히 작성했습니다.
