## 실전 실습: MySQL 데이터베이스 서버와 영구 저장소 연결

이번 단계에서는 가장 널리 쓰이는 관계형 데이터베이스인 **MySQL** 이미지를 활용하여, 컨테이너가 삭제되어도 데이터가 안전하게 보존되는 **영구 저장소(Persistent Storage)** 환경을 구축해 보겠습니다.

---

### 1. 실습 목표

* 도커 허브(Docker Hub)에서 공식 MySQL 이미지를 내려받습니다.
* **도커 볼륨(Docker Volume)**을 생성하여 데이터베이스의 실제 데이터 파일과 연결합니다.
* 컨테이너를 삭제 후 재생성했을 때 데이터가 유지되는지 검증합니다.

---

### 2. 인프라 설계 (Architecture)

* **Image:** `mysql:8.0` (공식 이미지)
* **Port:** `3306` (MySQL 기본 포트)
* **Volume:** `mysql_data` (호스트의 영구 저장 공간)
* **Environment:** 패스워드 및 기본 DB 설정

---

### 3. Docker Compose 설정 (`docker-compose.yml`)

명령어로 하나씩 실행하는 대신, 관리와 재현이 쉬운 Docker Compose 포맷을 사용합니다.

```yaml
version: '3.8'

services:
  db-server:
    image: mysql:8.0
    container_name: mysql-container
    restart: always
    environment:
      # 초기 루트 비밀번호 설정
      MYSQL_ROOT_PASSWORD: mypassword123
      # 실습용 데이터베이스 자동 생성
      MYSQL_DATABASE: practice_db
    ports:
      - "3306:3306"
    volumes:
      # [호스트 볼륨 이름]:[컨테이너 내 데이터 저장 경로]
      - mysql_data:/var/lib/mysql

# 영구 저장소 정의
volumes:
  mysql_data:

```

---

### 4. 단계별 실습 가이드

#### **Step 1: 서비스 실행**

터미널에서 `docker-compose.yml` 파일이 있는 위치로 이동하여 서비스를 실행합니다.

```bash
docker-compose up -d

```

#### **Step 2: 데이터 입력 (검증용)**

실행 중인 컨테이너에 접속하여 테스트 데이터를 입력합니다.

```bash
# 컨테이너 내부 접속
docker exec -it mysql-container mysql -u root -p

# (비밀번호 입력: mypassword123)

# 데이터 입력
USE practice_db;
CREATE TABLE test_table (id INT, name VARCHAR(20));
INSERT INTO test_table VALUES (1, 'Docker-Storage-Test');
SELECT * FROM test_table;
EXIT;

```

#### **Step 3: 컨테이너 완전 삭제**

컨테이너를 삭제하여 '휘발성' 레이어를 제거합니다.

```bash
docker-compose down

```

#### **Step 4: 데이터 유지 확인**

서비스를 다시 실행하고 데이터가 남아있는지 확인합니다.

```bash
docker-compose up -d
docker exec -it mysql-container mysql -u root -p practice_db -e "SELECT * FROM test_table;"

```

---

### 💡 실전 팁

> **데이터 저장 경로의 중요성:** MySQL의 공식 이미지에서 데이터가 저장되는 기본 경로는 `/var/lib/mysql`입니다. 볼륨 마운트 시 이 경로를 정확히 지정해야만 데이터가 유실되지 않습니다.

---

### ⚠️ 주의사항 및 과금 안내 (AWS)

* **AWS 관련 유료 서비스 안내:** * **AWS EC2:** 인스턴스 사량(t3.micro 등)에 따라 시간당 비용이 발생합니다.
* **AWS EBS:** `mysql_data` 볼륨이 생성되면서 EBS 용량을 차지하게 되며, 이에 따른 월별 저장 비용이 청구됩니다.
* **Free Tier:** AWS 프리티어 계정인 경우, t2.micro/t3.micro 인스턴스와 30GB 이내의 EBS는 무료 범위 내에서 실습 가능합니다.



---

**Next Step: 백엔드 애플리케이션과 MySQL 컨테이너 연동**

MySQL | 데이터베이스 | 볼륨 마운트 | 영구 저장소 실습
