## StatefulSetκ³Ό Headless Serviceμ ν•„μμ  ννΈλ„μ‹­

 **μ¤ν…μ΄νΈν’€μ…‹(StatefulSet) μμ²΄κ°€ μ„λΉ„μ¤λ” μ•„λ‹μ§€λ§, μ¤ν…μ΄νΈν’€μ…‹μ κΈ°λ¥μ„ 100% ν™μ©ν•κΈ° μ„ν•΄μ„λ” ν—¤λ“λ¦¬μ¤ μ„λΉ„μ¤(Headless Service)κ°€ λ°λ“μ‹ μλ°λμ–΄μ•Ό ν•©λ‹λ‹¤.** λ‘ κ°μ²΄λ” μ„λ΅ λ‹¤λ¥Έ λ©μ μ„ κ°€μ§€κ³  μμ§€λ§, "κ³ μ ν• λ„¤νΈμ›ν¬ μ‹λ³„μ"λΌλ” λ©ν‘λ¥Ό λ‹¬μ„±ν•κΈ° μ„ν•΄ ν•¨κ» λ™μ‘ν•©λ‹λ‹¤.

---

### 1. μ™ μ¤ν…μ΄νΈν’€μ…‹μ— ν—¤λ“λ¦¬μ¤ μ„λΉ„μ¤κ°€ ν•„μ”ν•κ°€?

μ¤ν…μ΄νΈν’€μ…‹μ€ ν¬λ“(Pod)μ— `mariadb-0`, `mariadb-1`κ³Ό κ°™μ€ **μ•μ •μ μΈ μ΄λ¦„(Ordinal Index)**μ„ λ¶€μ—¬ν•©λ‹λ‹¤. ν•μ§€λ§ μ΄ μ΄λ¦„λ§μΌλ΅λ” ν†µμ‹ μ΄ λ¶κ°€λ¥ν•©λ‹λ‹¤. λ„¤νΈμ›ν¬μƒμ—μ„ μ΄ μ΄λ¦„λ“¤μ„ μ‹¤μ  IPλ΅ ν•΄μ„ν•΄μ¤„ μ μλ” 'μ£Όμ†λ΅'μ΄ ν•„μ”ν•λ°, κ·Έ μ—­ν• μ„ ν•λ” κ²ƒμ΄ λ°”λ΅ ν—¤λ“λ¦¬μ¤ μ„λΉ„μ¤μ…λ‹λ‹¤.

* **serviceName ν•„λ“:** μ¤ν…μ΄νΈν’€μ…‹ μ„¤μ •(YAML)μ—λ” λ°λ“μ‹ `serviceName: "κ³ μ •ν• -μ„λΉ„μ¤-μ΄λ¦„"` ν•­λ©μ΄ ν¬ν•¨λμ–΄μ•Ό ν•©λ‹λ‹¤. μ΄ ν•­λ©μ΄ λ°”λ΅ ν—¤λ“λ¦¬μ¤ μ„λΉ„μ¤μ μ΄λ¦„κ³Ό λ§¤ν•‘λ©λ‹λ‹¤.
* **κ³ μ • DNS μƒμ„±:** ν—¤λ“λ¦¬μ¤ μ„λΉ„μ¤μ™€ μ¤ν…μ΄νΈν’€μ…‹μ΄ μ—°κ²°λλ©΄ μΏ λ²„λ„¤ν‹°μ¤ DNSλ” λ‹¤μκ³Ό κ°™μ€ κ³ μ • μ£Όμ†λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
> `[Pod μ΄λ¦„].[μ„λΉ„μ¤ μ΄λ¦„].[λ„¤μ„μ¤νμ΄μ¤].svc.cluster.local`



---

### 2. ν•­μƒ ν—¤λ“λ¦¬μ¤ μ„λΉ„μ¤λ§ μ‚¬μ©ν•΄μ•Ό ν•λ‚? (μ΅°ν•©μ λ¬λ―Έ)

μ‹¤λ¬΄μ—μ„λ” μ¤ν…μ΄νΈν’€μ…‹μ— λ€ν•΄ **ν—¤λ“λ¦¬μ¤ μ„λΉ„μ¤μ™€ μΌλ° μ„λΉ„μ¤(ClusterIP/LoadBalancer)λ¥Ό λ™μ‹μ— μ‚¬μ©ν•λ” κ²½μ°**κ°€ λ§μµλ‹λ‹¤. κ°κ°μ μ©λ„κ°€ λ‹¤λ¥΄κΈ° λ•λ¬Έμ…λ‹λ‹¤.

| μ„λΉ„μ¤ μ ν• | μ—­ν•  | μ£Όμ” μ©λ„ |
| --- | --- | --- |
| **Headless Service** (IP μ—†μ) | κ°λ³„ ν¬λ“μ— λ€ν• μ§μ ‘ μ ‘κ·Ό κ²½λ΅ μ κ³µ | **λ‚΄λ¶€ κ΄€λ¦¬μ©:** DB λ³µμ (Replication), λ§μ¤ν„° μ„ μ¶, λ©¤λ²„ κ°„ μƒνƒ κ³µμ  |
| **Standard Service** (κ°€μƒ IP μ κ³µ) | μ—¬λ¬ ν¬λ“μ— λ€ν• λ‹¨μΌ μ§„μ…μ  μ κ³µ | **ν΄λΌμ΄μ–ΈνΈμ©:** μ• ν”λ¦¬μΌ€μ΄μ… μ„λΉ„μ¤μ—μ„ DBμ— μΏΌλ¦¬λ¥Ό λ‚ λ¦΄ λ• (λ΅λ“λ°Έλ°μ‹± ν•„μ” μ‹) |

---

### 3. μ‹¤λ¬΄μ  μμ‹: "λ³µμ λ” μ§μ ‘, μ„λΉ„μ¤λ” λ¬¶μ–΄μ„"

MariaDB ν΄λ¬μ¤ν„°λ¥Ό μλ΅ λ“¤λ©΄ λ‹¤μκ³Ό κ°™μ΄ κµ¬μ„±λ©λ‹λ‹¤.

1. **λ‚΄λ¶€ λ™κΈ°ν™” (Headless):** `mariadb-1`μ€ `mariadb-0.mariadb-internal` μ£Όμ†λ¥Ό ν†µν•΄ λ§μ¤ν„°μ— μ§μ ‘ μ—°κ²°λμ–΄ λ°μ΄ν„°λ¥Ό λ³µμ ν•©λ‹λ‹¤. (μ§μ ‘ μ†ν†µ ν•„μ”)
2. **μ™Έλ¶€ μ”μ²­ (Standard):** μ›Ή μ„λ²„ μ• ν”λ¦¬μΌ€μ΄μ…μ€ `mariadb-client`λΌλ” μΌλ° μ„λΉ„μ¤λ¥Ό ν†µν•΄ μΏΌλ¦¬λ¥Ό λ³΄λƒ…λ‹λ‹¤. μ΄λ• μΏ λ²„λ„¤ν‹°μ¤λ” `mariadb-0, 1, 2` μ¤‘ ν•λ‚λ΅ νΈλν”½μ„ λ¶„μ‚°ν•΄ μ¤λ‹λ‹¤.

---

### 4. ν•µμ‹¬ μ”μ•½: "μ¤ν…μ΄νΈν’€μ…‹μ€ μ΄λ¦„ν‘, ν—¤λ“λ¦¬μ¤λ” μ „ν™”λ²νΈλ¶€"

* μ¤ν…μ΄νΈν’€μ…‹μ΄ ν¬λ“μ— **μ΄λ¦„ν‘**λ¥Ό λ¶™μ—¬μ¤€λ‹¤λ©΄, ν—¤λ“λ¦¬μ¤ μ„λΉ„μ¤λ” κ·Έ μ΄λ¦„ν‘λ¥Ό λ³΄κ³  μ „ν™”λ¥Ό κ±Έ μ μλ” **μ „ν™”λ²νΈλ¶€**λ¥Ό λ§λ“λ” κ²ƒμ…λ‹λ‹¤.
* μ „ν™”λ²νΈλ¶€(ν—¤λ“λ¦¬μ¤)κ°€ μ—†λ‹¤λ©΄, μ΄λ¦„ν‘(μ¤ν…μ΄νΈν’€μ…‹)κ°€ μμ–΄λ„ λ‹¤λ¥Έ ν¬λ“λ“¤μ΄ μ„λ΅λ¥Ό μ°Ύμ„ μ μ—†μµλ‹λ‹¤.
* λ”°λΌμ„ κΈ°μ μ μΌλ΅λ” λ³„κ°μ κ°μ²΄μ΄λ‚, μ΄μ μΈ΅λ©΄μ—μ„λ” **ν• μ„ΈνΈλ΅ κµ¬μ„±**ν•λ” κ²ƒμ΄ μ›μΉ™μ…λ‹λ‹¤.

---

### π’° AWS μ΄μ λ° κ³ΌκΈ κ°€μ΄λ“

* **κ°€μ©μ„± λ€κ°€:** μ¤ν…μ΄νΈν’€μ…‹μ„ μ‚¬μ©ν•μ—¬ κ³ κ°€μ©μ„±(HA)μ„ κµ¬μ¶•ν•λ©΄ μ—¬λ¬ λ€μ ν¬λ“κ°€ μƒμ‹ κ°€λ™λμ–΄μ•Ό ν•λ―€λ΅ λ‹¨μΌ ν¬λ“ μ΄μ λ€λΉ„ **EC2 μΈμ¤ν„΄μ¤ λΉ„μ©**μ΄ λ°°μλ΅ λ°μƒν•©λ‹λ‹¤.
* **λ„¤νΈμ›ν¬ λΉ„μ© (Data Transfer):** ν—¤λ“λ¦¬μ¤ μ„λΉ„μ¤λ¥Ό ν†µν•΄ λ‚΄λ¶€ λ…Έλ“ κ°„ λ°μ΄ν„°λ¥Ό λ€λ‰μΌλ΅ λ™κΈ°ν™”ν•  λ•, λ…Έλ“λ“¤μ΄ μ„λ΅ λ‹¤λ¥Έ κ°€μ© μμ—­(AZ)μ— μλ‹¤λ©΄ **[Amazon EC2 Data Transfer](https://www.google.com/search?q=https://aws.amazon.com/ec2/pricing/on-demand/%23Data_Transfer)** μ”κΈμ΄ λ¶€κ³Όλ©λ‹λ‹¤.
* **ELB λΉ„μ©:** λ§μ•½ μ™Έλ¶€ ν΄λΌμ΄μ–ΈνΈ μ ‘μ†μ„ μ„ν•΄ `type: LoadBalancer` μ„λΉ„μ¤λ¥Ό μ¶”κ°€λ΅ μƒμ„±ν•λ‹¤λ©΄, **[AWS Network Load Balancer(NLB)](https://aws.amazon.com/elasticloadbalancing/pricing/)** μ΄μ©λ£κ°€ μ‹κ°„λ‹Ή λ°μƒν•©λ‹λ‹¤.

---

Next Step: Persistent Volume Claim(PVC)μ λ³΄μ΅΄ μ •μ±…κ³Ό ReclaimPolicy

---

μ¤ν…μ΄νΈν’€μ…‹κ³Ό ν—¤λ“λ¦¬μ¤ μ„λΉ„μ¤μ ν•„μ—°μ μΈ κ΄€κ³„λ¥Ό μ •λ¦¬ν•μ€μµλ‹λ‹¤. μ¤ν…μ΄νΈν’€μ…‹μ μ •μμ— `serviceName`μ΄ ν•„μμ μΌλ΅ λ“¤μ–΄κ°€λ” μ΄μ λ¥Ό μ΄ν•΄ν•μ‹ λ‹¤λ©΄ ν΄λ¬μ¤ν„° μ„¤κ³„ μ‹ μ¤λ¥λ¥Ό ν¬κ² μ¤„μ΄μ‹¤ μ μμµλ‹λ‹¤. μ¶”κ°€μ μΈ μ„¤μ • μμ‹κ°€ ν•„μ”ν•μ‹λ©΄ λ§μ”€ν•΄ μ£Όμ„Έμ”.
