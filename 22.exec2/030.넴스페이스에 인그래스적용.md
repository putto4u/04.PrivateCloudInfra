## 멀티 네임스페이스 환경에서의 Ingress 활용 및 격리 전략

쿠버네티스 운영 아키텍처에서 인그레스(Ingress)를 활용하여 여러 네임스페이스(`megaprod`, `megadev`)에 서비스를 노출하는 방법은 크게 두 가지로 나뉩니다. 하나의 컨트롤러로 통합 관리하는 **공유형 아키텍처**와 각 네임스페이스에 전용 컨트롤러를 두는 **격리형 아키텍처**입니다.

이 장에서는 실무에서 가장 선호되는 두 가지 방식을 단계별로 학습합니다.

---

### [Case 1] 공유형 인그레스 아키텍처 (통합 관리)

이미 설치된 하나의 인그레스 컨트롤러를 사용하여 여러 네임스페이스의 트래픽을 분기하는 효율적인 방식입니다.

#### 1. 아키텍처 구조

* **Ingress Controller**: `default` 또는 전용 네임스페이스에 1개 설치
* **Ingress Resource**: 각 네임스페이스(`megaprod`, `megadev`)에 각각 배포
* **특징**: 관리 포인트가 하나이며, 클라우드 로드밸런서 비용이 1개분만 발생하여 경제적입니다.

#### 2. 네임스페이스별 인그레스 규칙 설정 (YAML)

각 네임스페이스에 배포된 서비스들을 하나의 컨트롤러(`ingressClassName: nginx`)에 연결합니다.

```yaml
# 1. 운영 환경용 (megaprod)
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: prod-ingress
  namespace: megaprod
spec:
  ingressClassName: nginx
  rules:
  - host: prod.mega-it.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: prod-service
            port:
              number: 80
---
# 2. 개발 환경용 (megadev)
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: dev-ingress
  namespace: megadev
spec:
  ingressClassName: nginx
  rules:
  - host: dev.mega-it.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: dev-service
            port:
              number: 80

```

---

### [Case 2] 격리형 인그레스 아키텍처 (네임스페이스 전용)

보안이나 성능 격리가 극도로 중요한 경우, 각 네임스페이스마다 독립적인 컨트롤러 엔진을 설치하는 방식입니다.

#### 1. 아키텍처 구조

* **Ingress Controller**: 각 네임스페이스마다 별도로 설치 (Helm 사용)
* **Ingress Resource**: 자신이 속한 네임스페이스의 전용 컨트롤러만 바라봄
* **특징**: 환경 간 완벽한 격리가 가능하지만, 설치된 컨트롤러 수만큼 **AWS 로드밸런서 과금이 추가 발생**합니다.

#### 2. 네임스페이스 전용 컨트롤러 설치 (명령형)

각 컨트롤러가 자기 네임스페이스의 자원만 감시하도록 `scope` 옵션을 활성화하여 설치합니다.

* **운영용(megaprod) 전용 설치**
```bash
helm install prod-ingress ingress-nginx/ingress-nginx \
  --namespace megaprod \
  --set controller.ingressClassResource.name=prod-nginx \
  --set controller.scope.enabled=true \
  --set controller.scope.namespace=megaprod

```


* **개발용(megadev) 전용 설치**
```bash
helm install dev-ingress ingress-nginx/ingress-nginx \
  --namespace megadev \
  --set controller.ingressClassResource.name=dev-nginx \
  --set controller.scope.enabled=true \
  --set controller.scope.namespace=megadev

```



---

### 3. 구성 결과 검증

설치가 완료되면 각 인그레스 클래스가 독립적으로 존재하는지 확인합니다.

```bash
# 인그레스 클래스 목록 확인
kubectl get ingressclass

```

*출력 결과에 `nginx`(기본), `prod-nginx`, `dev-nginx`가 각각 존재해야 합니다.*

---

### 💡 실전 전문 팁 (Expert Tips)

* **비용 최적화**: AWS EKS 환경에서 실습 중이라면 Case 2 방식은 로드밸런서가 네임스페이스 개수만큼 생성되어 비용이 배로 발생합니다. 학습용으로는 Case 1(공유형)을 권장하며, 격리 실습이 필요할 때만 Case 2를 사용하십시오.
* **유료 서비스 주의**: 인그레스 컨트롤러 설치 시 생성되는 `LoadBalancer` 타입 서비스는 외부 IP를 할당받기 위해 **시간당 과금이 즉시 시작**됩니다. 실습 후에는 반드시 삭제하시기 바랍니다.
* **호스트 파일 설정**: 실습 환경에서 실제 도메인이 없다면, `prod.mega-it.com` 등의 호스트명을 로컬 PC의 `hosts` 파일에 로드밸런서 IP와 매핑하여 테스트할 수 있습니다.

---

**Next Step: Ingress TLS(HTTPS) 보안 설정 및 인증서 적용**

가장 중요한 설치 및 네임스페이스별 적용 단계를 마쳤습니다. 다음은 보안을 위한 HTTPS 적용 방법을 다뤄볼까요?

현재 시스템의 Helm 설치 상태와 네임스페이스 구조를 바탕으로 실무에서 가장 많이 쓰이는 두 가지 전략을 교재 형식으로 구성했습니다. 지시하신 대로 불필요한 서술은 제외하고 핵심 코드와 아키텍처 설명 중심으로 작성하였습니다.
