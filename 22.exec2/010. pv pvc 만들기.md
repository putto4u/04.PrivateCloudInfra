요청하신 대로 **PV(PersistentVolume)**와 **PVC(PersistentVolumeClaim)** 설정을 파일별로 분리하여 관리하고, 이를 순차적으로 실행하여 안정적으로 바인딩하는 절차를 정리해 드립니다.

---

## 1. PV 정의 (Storage Infra 설정)

인프라 관리자가 스토리지의 물리적 경로를 쿠버네티스 리소스로 등록하는 단계입니다.

```yaml
# pv.yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv-fweb
spec:
  capacity:
    storage: 1Gi
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  nfs:
    path: /srv/nfs_share/fweb
    server: 192.168.100.251
---
apiVersion: v1
kind: PersistentVolume
metadata:
  name: pv-bweb
spec:
  capacity:
    storage: 1Gi
  accessModes:
    - ReadWriteMany
  persistentVolumeReclaimPolicy: Retain
  nfs:
    path: /srv/nfs_share/bweb
    server: 192.168.100.251

```

---

## 2. PVC 정의 (Storage 요청 설정)

사용자(개발자)가 필요한 만큼의 용량을 PV로부터 할당받기 위해 요청하는 단계입니다.

nfs-volume-patch.yml

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: fweb # 원본 Deployment의 metadata.name과 동일해야 함
spec:
  template:
    spec:
      containers:
      - name: nginx # 원본 컨테이너 이름과 동일해야 함
        volumeMounts:
        - name: nfs-storage
          mountPath: /usr/share/nginx/html/api
      volumes:
      - name: nfs-storage
        persistentVolumeClaim:
          claimName: bweb-pvc
```
kustomization.yml
```
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - fweb.yml

patches:
  - path: nfs-volume-patch.yml
```
2. 운영 절차 가이드 (명령어 요약)
   후임자가 별도의 야믈 파일을 골라서 적용할 수 있도록 가이드라인을 제시합니다.
   상황실행 명령어설명

   순수 엔진엑스 실행   ```kubectl apply -f fweb.yml```  볼륨 없는 원본 상태로 배포

   NFS 마운트 버전 실행   ```kubectl apply -k Kustomization``` 을 통해 볼륨 설정 병합 배포

   NFS 해제 (원복)    ```kubectl apply -f fweb.yml```    원본 파일로 덮어씌워 볼륨 제거 및 초기화






---

## 3. bweb 패치 및 kustomization  정의 (Workload 설정)



---

## 4. 실행 및 확인 절차

### [1단계] NFS 서버 기초 작업 (Host OS)

반드시 NFS 서버(192.168.100.251)에서 실제 디렉터리가 존재해야 합니다.

```bash
sudo mkdir -p /srv/nfs_share/fweb /srv/nfs_share/bweb
sudo chmod 777 /srv/nfs_share/fweb /srv/nfs_share/bweb

```

### [2단계] PV 생성 및 확인

먼저 물리적 자원을 클러스터에 등록합니다.

```bash
kubectl apply -f nfs-pv-resources.yaml
# 확인: STATUS가 'Available'이어야 합니다.
kubectl get pv

```

### [3단계] PVC 생성 및 중간 확인

등록된 PV를 예약(Claim)합니다.

```bash
kubectl apply -f nfs-pvc-claims.yaml
# 확인: PV와 PVC 모두 STATUS가 'Bound'로 변해야 합니다.
kubectl get pv,pvc

```

### [4단계] Pod 생성 및 최종 확인

볼륨이 바인딩된 것을 확인한 후 애플리케이션을 배포합니다.

```bash
kubectl apply -f app-pods.yaml
# 최종 확인: 파드 내부 마운트 경로 체크
kubectl exec -it fweb-pod -- df -h | grep /var/www/html
kubectl exec -it bweb-pod -- df -h | grep /var/www/api

```

---

## 5. 장애 대응 (Pending/실패 시 가이드)

| 현상 | 원인 확인 및 해결 방법 |
| --- | --- |
| **PVC Pending** | `kubectl describe pvc [이름]` 실행. 용량 불일치 또는 `volumeName` 오타 확인. |
| **Pod ContainerCreating** | `kubectl describe pod [이름]` 실행. 노드에 `nfs-common` 패키지 설치 여부 및 NFS 서버 IP 접근성 확인. |
| **Mount 실패 (Timeout)** | 워커 노드에서 `showmount -e 192.168.100.251` 실행하여 서버의 공유 목록 노출 여부 확인. |
| **Permission Denied** | NFS 서버의 `/etc/exports` 옵션에 `no_root_squash` 추가 후 `sudo exportfs -ra` 실행. |

---

### IT 전문가의 핵심 요약

* **명시적 바인딩:** `volumeName` 필드를 사용하면 쿠버네티스 스케줄러가 임의의 PV를 선택하지 않고, 관리자가 지정한 특정 경로의 PV와 정확히 연결합니다.
* **정적 프로비저닝 관리:** 이 방식은 스토리지 경로가 고정된 환경에서 데이터의 정확한 위치를 보장할 때 가장 신뢰할 수 있는 방법입니다.

**Next Step:**
**NFS 정적 바인딩 완료 후 데이터 영속성 테스트(Pod 재시작)**

파드를 삭제했다가 다시 생성해도 `/var/www/html`에 저장된 데이터가 그대로 유지되는지 확인하는 테스트를 진행해 볼까요?

Would you like me to:
Next Step: 데이터 영속성 테스트 방법 정의
