트러블슈팅 과정까지 포함하여, 실무에서 실수하기 쉬운 레이블(Label) 개념을 명확히 짚어주는 완결판 교재로 다시 제작해 드립니다.

---

## [실습] 경로 기반 인그레스 배포 및 검증 (Namespace: megaprod)

이번 장에서는 리소스를 순차적으로 배포하고, 쿠버네티스의 핵심 연결 고리인 **레이블(Label)**을 이용해 상태를 정확하게 검증하는 방법을 학습합니다.

### 1. 사전 준비: 네임스페이스 생성

리소스 간의 간섭을 방지하기 위해 전용 작업 공간을 생성합니다.

```bash
kubectl create namespace megaprod

```

### 2. 단계별 설정 파일 (YAML) 작성

관리 편의성을 위해 배포 설정을 3개의 파일로 분리합니다.

#### [파일 1] 메인 웹 서비스 (`front-web.yaml`)

* **역할:** `/` 경로 요청 처리

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: front-web-deploy
  namespace: megaprod
spec:
  replicas: 2
  selector:
    matchLabels:
      app: front-web # 이 레이블로 Pod를 관리합니다.
  template:
    metadata:
      labels:
        app: front-web
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: front-web-svc
  namespace: megaprod
spec:
  selector:
    app: front-web
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80

```

#### [파일 2] 리스트 조회 서비스 (`view-web.yaml`)

* **역할:** `/viewlist` 경로 요청 처리

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: view-web-deploy
  namespace: megaprod
spec:
  replicas: 2
  selector:
    matchLabels:
      app: view-web
  template:
    metadata:
      labels:
        app: view-web
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: view-web-svc
  namespace: megaprod
spec:
  selector:
    app: view-web
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80

```

#### [파일 3] 공용 인그레스 설정 (`shared-ingress.yaml`)

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: shared-ingress
  namespace: megaprod
  annotations:
    kubernetes.io/ingress.class: "nginx"
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: front-web-svc
            port:
              number: 80
      - path: /viewlist
        pathType: Prefix
        backend:
          service:
            name: view-web-svc
            port:
              number: 80

```

---

### 3. 안정적인 순차 배포 및 검증 절차

에러 발생 시 즉각적인 원인 파악을 위해 순서대로 `apply` 하고 상태를 확인합니다.

#### **Step 1: Front-end 배포 및 레이블 검증**

```bash
kubectl apply -f front-web.yaml

# [주의] -l 옵션에는 YAML의 labels에 정의한 'key=value'를 넣습니다. (파일명 X)
kubectl get pod -n megaprod -l app=front-web

```

#### **Step 2: View-list 배포 및 상태 확인**

```bash
kubectl apply -f view-web.yaml

# 서비스와 엔드포인트가 잘 연결되었는지 확인합니다.
kubectl get svc,endpoints -n megaprod

```

#### **Step 3: Ingress 적용 및 주소 확인**

```bash
kubectl apply -f shared-ingress.yaml

# ADDRESS 항목에 IP나 DNS가 뜰 때까지 기다립니다.
kubectl get ingress -n megaprod

```

---

### ⚠️ 자주 실수하는 부분 (Troubleshooting)

* **No resources found 에러:** `kubectl get pod -l app=front-web.yaml` 처럼 파일명을 레이블 자리에 넣으면 리소스를 찾을 수 없습니다. 반드시 **YAML 내부 `labels` 섹션에 적은 이름**을 사용하세요.
* **404 Not Found:** Ingress의 `path` 설정과 실제 컨테이너 내부의 파일 경로가 맞지 않을 때 발생합니다. `rewrite-target` 어노테이션이 제대로 설정되었는지 확인하세요.

> [!CAUTION] **AWS 환경 유료 서비스 경고**
> * **ALB 비용 발생:** `shared-ingress.yaml`을 적용하면 AWS에 **L7 로드밸런서(ALB)가 생성**됩니다. 이는 생성 즉시 **시간당 비용**이 청구되는 유료 서비스입니다.
> * **자원 회수:** 실습이 끝나면 반드시 `kubectl delete namespace megaprod`를 실행하여 관련 유료 자원을 모두 삭제하시기 바랍니다.
> 
> 

---

Next Step: Ingress 로그 분석 및 실시간 트래픽 모니터링

배포 명령어와 확인 옵션을 더욱 명확하게 구분하여 교재를 완성했습니다. 추가로 보완할 내용이 있으면 말씀해 주세요.
