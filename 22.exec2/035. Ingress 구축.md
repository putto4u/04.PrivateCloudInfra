## Ingress êµ¬ì¶•

### 2. ì•„í‚¤í…ì²˜ ê²°ì •: NodePort vs ClusterIP

ë‚´ë¶€ í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ Ingressë¥¼ ì‚¬ìš©í•  ë•Œ, ë°±ì—”ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜(App)ì˜ ì„œë¹„ìŠ¤ íƒ€ì…ì€ ë¬´ì—‡ì´ ìœ ë¦¬í• ê¹Œìš”?

* **NodePort:** ëª¨ë“  ë…¸ë“œì˜ í¬íŠ¸ë¥¼ ê°œë°©í•©ë‹ˆë‹¤. Ingressê°€ ì—†ì–´ë„ ì ‘ì† ê°€ëŠ¥í•˜ì§€ë§Œ, í¬íŠ¸ ê´€ë¦¬ê°€ ì–´ë µê³  ë³´ì•ˆìƒ ì·¨ì•½í•©ë‹ˆë‹¤. Ingress ë’¤ì— ìˆ¨ì–´ ìˆëŠ” ì•±ìœ¼ë¡œì„œëŠ” ë¶€ì ì ˆí•©ë‹ˆë‹¤.
* **ClusterIP (ê¶Œì¥):** ì™¸ë¶€ ë…¸ì¶œì„ ì°¨ë‹¨í•˜ê³  ì˜¤ì§ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤. **Ingress Controllerê°€ 'ëŒ€ë¬¸' ì—­í• ì„ í•˜ê³ , ë°±ì—”ë“œ ì•±ì€ 'ë°©' ì•ˆì— ìˆ¨ì–´ ìˆëŠ” êµ¬ì¡°**ê°€ ë˜ë¯€ë¡œ ê°€ì¥ í‘œì¤€ì ì¸ íŒ¨í„´ì…ë‹ˆë‹¤.

> **ê²°ë¡ :** Ingress Controller(ì—”ì§„)ëŠ” ì™¸ë¶€ì—ì„œ ë“¤ì–´ì™€ì•¼ í•˜ë¯€ë¡œ `NodePort` ë˜ëŠ” `HostNetwork`ë¡œ ì—´ë ¤ ìˆì–´ì•¼ í•˜ì§€ë§Œ, ìš°ë¦¬ê°€ ë°°í¬í•  **`front-web`, `view-web` ì• í”Œë¦¬ì¼€ì´ì…˜ì€ `ClusterIP`ë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì´ O'Reilly ë° ê³µì‹ ë¬¸ì„œê°€ ê¶Œì¥í•˜ëŠ” Best Practice**ì…ë‹ˆë‹¤.

---

## [ì‹¤ìŠµ êµì¬] ë‚´ë¶€ë§ í™˜ê²½ì„ ìœ„í•œ Ingress í†µí•© ë°°í¬ ê°€ì´ë“œ

ë³¸ ì‹¤ìŠµì€ **"ì™¸ë¶€ IPë¥¼ ë°›ì„ ìˆ˜ ì—†ëŠ” ë‚´ë¶€ë§"**ì„ì„ ê°ì•ˆí•˜ì—¬, Ingress Controllerê°€ ì„¤ì¹˜ëœ ë…¸ë“œì˜ IPë¥¼ í†µí•´ `ClusterIP` ì„œë¹„ìŠ¤ë¡œ ë¼ìš°íŒ…í•˜ëŠ” ì™„ê²°ëœ êµ¬ì„±ì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.

### Step 1. í™˜ê²½ ì´ˆê¸°í™” (Clean-up)

ê¸°ì¡´ ì„¤ì •ì˜ ì”ì¬(ConfigMap, ì¤‘ë³µ Ingress ë“±)ë¥¼ ì™„ì „íˆ ì œê±°í•˜ì—¬ ìˆœìˆ˜í•œ ìƒíƒœì—ì„œ ì‹œì‘í•©ë‹ˆë‹¤.

```bash
# 1. ê¸°ì¡´ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë° ìì› ì‚­ì œ
kubectl delete namespace megaprod --ignore-not-found=true

# 2. ë¡œì»¬ì˜ êµ¬ë²„ì „ YAML íŒŒì¼ ì •ë¦¬
rm -f front-web.yaml view-web.yaml shared-ingress.yaml

# 3. ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì¬ìƒì„±
kubectl create namespace megaprod

```

### Step 2. ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ (ClusterIP + ìë™ í˜ì´ì§€ ìƒì„±)

`kubectl cp`ì˜ í•œê³„ë¥¼ ê·¹ë³µí•˜ê¸° ìœ„í•´, ë°°í¬ ì‹œì ì— íŒŒë“œ ìŠ¤ìŠ¤ë¡œ `index.html`ì„ ìƒì„±í•˜ë„ë¡ êµ¬ì„±í•©ë‹ˆë‹¤.

#### [íŒŒì¼ 1] ë©”ì¸ ì›¹ ì„œë¹„ìŠ¤ (`front-web.yaml`)

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: front-web-deploy
  namespace: megaprod
spec:
  replicas: 2
  selector:
    matchLabels:
      app: front-web
  template:
    metadata:
      labels:
        app: front-web
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
        # [í•µì‹¬] íŒŒë“œ ìƒì„± ì‹œì ì— ë©”ì¸ í˜ì´ì§€ ìë™ ìƒì„± (ë™ê¸°í™” ë¬¸ì œ í•´ê²°)
        command: ["/bin/sh", "-c"]
        args: 
          - echo "<h1 style='color:blue'>WELCOME TO FRONT-END (MAIN)</h1>" > /usr/share/nginx/html/index.html && nginx -g "daemon off;"
---
apiVersion: v1
kind: Service
metadata:
  name: front-web-svc
  namespace: megaprod
spec:
  type: ClusterIP  # Ingressê°€ Proxyí•˜ë¯€ë¡œ ë‚´ë¶€ IPë§Œ ìˆìœ¼ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤.
  selector:
    app: front-web
  ports:
  - protocol: TCP
    port: 80
    targetPort: 80

```

#### [íŒŒì¼ 2] ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ ì„œë¹„ìŠ¤ (`view-web.yaml`)

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: view-web-deploy
  namespace: megaprod
spec:
  replicas: 2
  selector:
    matchLabels:
      app: view-web
  template:
    metadata:
      labels:
        app: view-web
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
        # [í•µì‹¬] ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ ìë™ ìƒì„±
        command: ["/bin/sh", "-c"]
        args: 
          - echo "<h1 style='color:green'>THIS IS VIEW-LIST PAGE</h1>" > /usr/share/nginx/html/index.html && nginx -g "daemon off;"
---
apiVersion: v1
kind: Service
metadata:
  name: view-web-svc
  namespace: megaprod
spec:
  type: ClusterIP
  selector:
    app: view-web
  ports:
  - protocol: TCP
    port: 80
    targetPort: 80

```

### Step 3. í†µí•© Ingress ì„¤ì • (`shared-ingress.yaml`)

ë‚´ë¶€ë§ í™˜ê²½ì—ì„œëŠ” ë„ë©”ì¸ì´ ì—†ìœ¼ë¯€ë¡œ IP ì ‘ì†(`http://192.168.x.x/`)ì„ ìš°ì„ ì ìœ¼ë¡œ í—ˆìš©í•˜ë˜, `/etc/hosts` ì¡°ì‘ì„ í†µí•œ ë„ë©”ì¸ í…ŒìŠ¤íŠ¸ë„ ê°€ëŠ¥í•˜ë„ë¡ êµ¬ì„±í•©ë‹ˆë‹¤.

```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: shared-ingress
  namespace: megaprod
  annotations:
    kubernetes.io/ingress.class: "nginx"
    # [í•„ìˆ˜] í•˜ìœ„ ê²½ë¡œ(/viewlist)ë¥¼ íŒŒë“œ ë‚´ë¶€ ë£¨íŠ¸(/)ë¡œ ì—°ê²°
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  ingressClassName: nginx
  rules:
  # 1. ë„ë©”ì¸ ê¸°ë°˜ ë¼ìš°íŒ… (Host í—¤ë”ê°€ ì¼ì¹˜í•  ë•Œ)
  - host: prod.mega-it.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: front-web-svc
            port:
              number: 80
      - path: /viewlist
        pathType: Prefix
        backend:
          service:
            name: view-web-svc
            port:
              number: 80
  # 2. IP ê¸°ë°˜ ë¼ìš°íŒ… (Host í—¤ë” ì—†ì´ IPë¡œë§Œ ë“¤ì–´ì˜¬ ë•Œ)
  - http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: front-web-svc
            port:
              number: 80

```

---

### Step 4. ë°°í¬ ë° ê²€ì¦ (Verification)

#### 1. ë¦¬ì†ŒìŠ¤ ì¼ê´„ ì ìš©

```bash
kubectl apply -f front-web.yaml
kubectl apply -f view-web.yaml
kubectl apply -f shared-ingress.yaml

```

#### 2. Ingress ì ‘ì† ì£¼ì†Œ í™•ì¸

```bash
kubectl get ingress -n megaprod

```

* **ADDRESS í™•ì¸:**
* ë§Œì•½ `ADDRESS`ì— IP(`192.168.100.251` ë“±)ê°€ ëœ¬ë‹¤ë©´ í•´ë‹¹ IPë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
* **ì¤‘ìš”:** ë§Œì•½ ë‚´ë¶€ë§ì´ë¼ `ADDRESS`ê°€ ëê¹Œì§€ ë¹„ì–´ ìˆë‹¤ë©´, **Ingress Controllerê°€ ì‹¤í–‰ ì¤‘ì¸ ë…¸ë“œì˜ IP**ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.



#### 3. ìµœì¢… ì ‘ì† í…ŒìŠ¤íŠ¸ (ë¸Œë¼ìš°ì € ë˜ëŠ” curl)

ë¸Œë¼ìš°ì €ë¥¼ ì—´ê³  ì•„ë˜ ì£¼ì†Œë¡œ ì ‘ì†í•˜ì—¬ ìš°ë¦¬ê°€ ì„¤ì •í•œ ë¬¸êµ¬(íŒŒë€ìƒ‰/ë…¹ìƒ‰)ê°€ ë‚˜ì˜¤ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

* **Case A: ë©”ì¸ í˜ì´ì§€**
* URL: `http://<ë…¸ë“œIP>/`
* ê¸°ëŒ€ ê²°ê³¼: **WELCOME TO FRONT-END (MAIN)**


* **Case B: ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€**
* URL: `http://<ë…¸ë“œIP>/viewlist`
* ê¸°ëŒ€ ê²°ê³¼: **THIS IS VIEW-LIST PAGE**



---

### ğŸ’¡ ê°•ì‚¬ì˜ í•œë§ˆë””: "ë‚´ë¶€ë§ì—ì„œ Addressê°€ ì•ˆ ëœ° ë•Œ"

K8s ê³µì‹ ë¬¸ì„œì— ë”°ë¥´ë©´, Ingress Resourceì˜ `Address` í•„ë“œëŠ” Ingress Controllerê°€ ë¡œë“œë°¸ëŸ°ì„œë¡œë¶€í„° IPë¥¼ ë°›ì•„ì™€ì„œ ì—…ë°ì´íŠ¸í•´ì£¼ëŠ” í•„ë“œì…ë‹ˆë‹¤.
ì™¸ë¶€ ë¡œë“œë°¸ëŸ°ì„œê°€ ì—†ëŠ” ì˜¨í”„ë ˆë¯¸ìŠ¤(VM) í™˜ê²½ì—ì„œëŠ” ì´ í•„ë“œê°€ ë¹„ì–´ ìˆì–´ë„, **Nginx Controllerê°€ 80ë²ˆ í¬íŠ¸ë¥¼ ë¦¬ìŠ¤ë‹í•˜ê³  ìˆë‹¤ë©´ ë…¸ë“œ IPë¡œ ì ‘ì† ì‹œ ì •ìƒ ì‘ë™**í•©ë‹ˆë‹¤. ë‹¹í™©í•˜ì§€ ë§ê³  ë…¸ë“œ IPë¡œ ì ‘ì†í•˜ì„¸ìš”.

---

Next Step: `/etc/hosts` íŒŒì¼ì„ ìˆ˜ì •í•˜ì—¬ `prod.mega-it.com` ë„ë©”ì¸ìœ¼ë¡œ ì ‘ì†í•˜ëŠ” ë°©ë²•

ìœ„ ê°€ì´ë“œëŒ€ë¡œ ì§„í–‰í•˜ì‹œë©´ `ClusterIP` êµ¬ì„±ì˜ ë³´ì•ˆì„±ê³¼ Ingressì˜ ë¼ìš°íŒ… ê¸°ëŠ¥ì„ ëª¨ë‘ ì¡ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ˆê¸°í™” í›„ ë°°í¬ë¥¼ ì§„í–‰í•´ ë³´ì‹œê² ìŠµë‹ˆê¹Œ?
