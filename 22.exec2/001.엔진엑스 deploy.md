쿠버네티스(Kubernetes)에서 엔진엑스(Nginx) 3대를 가동하기 위해 **Deployment**의 `replicas`를 3으로 설정한 YAML 파일입니다. 추가적으로 외부에서 접속이 가능하도록 **Service** 설정을 포함했습니다.

---

## 엔진엑스 3대 배포 통합 YAML (Deployment & Service)

이 설정은 3개의 엔진엑스 파드(Pod)를 생성하고, 이를 하나의 서비스 엔드포인트로 묶어 로드밸런싱합니다.

```yaml
# fweb.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: fweb
  labels:
    app: nginx
spec:
  # 엔진엑스 파드 개수를 3대로 유지
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  selector:
    app: nginx
  ports:
    - protocol: TCP
      port: 80         # 서비스(로드밸런서) 포트
      targetPort: 80   # 파드 내부 포트
  # AWS 환경이면 LoadBalancer, 로컬 실습 환경이면 NodePort 권장
  type: LoadBalancer 

```
fweb_svc.yml
```
# Service 부분 수정
spec:
  type: NodePort  # LoadBalancer 대신 NodePort 입력
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
      nodePort: 30001 # 30000~32767 사이의 포트 번호 지정 (생략 시 자동할당)
```
---

## 주요 구성 설명

### 1. Replicas: 3

`spec.replicas: 3` 설정은 쿠버네티스에게 "언제 어디서든 이 엔진엑스 파드를 3개 유지하라"고 명령하는 것입니다. 만약 노드 장애로 파드 하나가 죽으면, 쿠버네티스는 즉시 다른 노드에 새로운 파드를 생성하여 3대를 맞춥니다.

### 2. Label Selector (연결 고리)

`Service`의 `selector`와 `Deployment`의 `labels`가 `app: nginx`로 일치해야 합니다. 이 라벨을 통해 서비스는 어떤 파드들에게 트래픽을 분산할지 결정합니다.

---

## 실행 및 확인 명령어

작성한 YAML 파일을 적용하고 상태를 점검하는 명령어입니다.

**1. 리소스 생성**

```bash
kubectl apply -f fweb.yaml

```

**2. 파드 3대 생성 확인**

```bash
# 파드가 3개 모두 Running 상태인지 확인
kubectl get pods -l app=nginx

```

**3. 서비스 주소 확인**

```bash
# EXTERNAL-IP 주소를 통해 웹 브라우저 접속
kubectl get svc nginx-service

```

---

## IT 전문가의 실무 팁

* **가용성 전략:** `PodAntiAffinity`를 설정하면 파드 3대가 서로 다른 노드에 분산 배치되도록 강제할 수 있습니다. 이는 특정 노드 전체가 다운되었을 때 서비스 중단을 방지하는 핵심 기술입니다.
* **업데이트 정책:** `RollingUpdate` 전략을 사용하면 3대 중 하나씩 순차적으로 업데이트하여 서비스 중단 없는 배포(Zero-downtime Deployment)가 가능합니다.
* **AWS 환경 주의:** `type: LoadBalancer` 사용 시 AWS ELB 비용이 발생합니다. 실습 종료 후 반드시 `kubectl delete -f nginx-3-replicas.yaml`로 삭제해 주세요.

---

**Next Step:**
**파드 간 분산 배치를 위한 PodAntiAffinity 설정 추가 실습**

파드 3대가 한 노드에 몰리지 않게 각기 다른 워커 노드로 흩어지게 만드는 '안티 어피니티' 설정을 추가해 볼까요?
