
## Ingress와 Ingress Controller의 관계

쿠버네티스를 처음 접할 때 가장 혼동하기 쉬운 지점입니다. 결론부터 말씀드리면, **Ingress는 '규칙(Rule)'일 뿐이며, 이를 실행할 '두뇌(Controller)'는 별도로 설치해야 합니다.**

### 1. Ingress와 Controller의 차이

쿠버네티스를 설치하면 기본적으로 Ingress라는 **리소스(API 객체)**는 사용할 수 있습니다. 하지만 이는 단순히 "A라는 주소로 오면 B 서비스로 보내라"는 내용이 적힌 **설계도**에 불과합니다. 이 설계도를 읽어서 실제 네트워크 트래픽을 제어할 **구현체(Ingress Controller)**가 없다면 아무런 동작도 하지 않습니다.

| 구분 | Ingress (Resource) | Ingress Controller (Implementation) |
| --- | --- | --- |
| **역할** | HTTP/HTTPS 경로 정의 (설계도) | 실제 트래픽 로드밸런싱 (실행 주체) |
| **상태** | K8s 기본 내장 (표준 API) | **별도 설치 필수** (외부 솔루션) |
| **비유** | 메뉴판 (주문서) | 요리사 (실제 요리 수행) |

---

### 2. 왜 컨트롤러를 직접 설치해야 하는가?

쿠버네티스는 다양한 환경(On-premise, AWS, Azure, GCP 등)에서 실행됩니다. 각 환경마다 트래픽을 처리하는 방식이 다르기 때문에, 쿠버네티스 프로젝트는 표준 인터페이스(Ingress)만 제공하고 실제 구현은 환경에 맞는 컨트롤러를 선택하도록 설계되었습니다.

* **Bare-metal/IDC**: 주로 [의심스러운 링크 삭제됨]를 직접 설치하여 사용합니다.
* **AWS**: `AWS Load Balancer Controller`를 설치하면 Ingress 생성 시 AWS의 **ALB(Application Load Balancer)가 자동으로 생성됩니다. (※ 주의: ALB 생성 시 시간당 과금 발생** )

---

### 3. NGINX Ingress Controller 설치 (Helm 활용)

가장 표준적으로 사용되는 NGINX 기반 컨트롤러를 Helm으로 설치하는 방법입니다.

```bash
# 1. 저장소 추가 및 업데이트
helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
helm repo update

# 2. 컨트롤러 설치
helm install quickstart ingress-nginx/ingress-nginx

```

설치가 완료되면 `kubectl get pods` 명령어로 트래픽을 수신 대기하는 컨트롤러 Pod이 생성된 것을 확인할 수 있습니다.

---

### 💡 실전 전문 팁 (Expert Tips)

* **의존성 확인**: Ingress Resource를 작성할 때 `ingressClassName: nginx`와 같은 설정이 컨트롤러의 설정과 일치해야 해당 컨트롤러가 규칙을 가져가서 적용합니다.
* **서비스 타입**: 클라우드 환경에서 컨트롤러를 설치하면 기본적으로 `Type: LoadBalancer` 서비스가 생성되며, 이는 클라우드 벤더의 유료 로드밸런서와 연결됩니다. 비용 최적화가 필요하다면 이 지점을 반드시 체크하십시오.
* **자주 하는 실수**: Ingress 규칙만 선언하고 "왜 접속이 안 되지?"라고 당황하는 경우가 많습니다. 항상 `kubectl get ingress` 명령어로 `ADDRESS` 부분에 IP나 도메인이 할당되었는지 확인하십시오. 컨트롤러가 없으면 이 부분이 계속 비어있게 됩니다.

---

**Next Step: Ingress 설정 파일(YAML) 작성 및 라우팅 실습**

---
퀵스타트 방식으로 설치된 인그레스 컨트롤러(Ingress Controller)는 보통 단일 매니페스트 파일이나 특정 네임스페이스에 모든 리소스가 묶여 있습니다. 이를 깨끗하게 제거하는 방법은 설치 시 사용했던 방식에 따라 결정됩니다.

---

## 1. 설치 파일(YAML)이 있는 경우

설치할 때 사용했던 `kubectl apply -f <파일명>.yaml` 명령어를 반대로 수행하는 것이 가장 확실하고 안전한 방법입니다.

```bash
# 설치 시 사용했던 URL이나 로컬 파일을 지정하여 삭제
kubectl delete -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.x.x/deploy/static/provider/cloud/deploy.yaml

```

이 명령어를 실행하면 해당 파일에 정의되었던 **Deployment, Service, ConfigMap, RBAC(Role, RoleBinding)** 등이 한꺼번에 삭제됩니다.

---

## 2. 특정 네임스페이스를 삭제하는 경우

대부분의 퀵스타트 설치는 `ingress-nginx`라는 독립된 네임스페이스를 생성하여 그 안에 모든 리소스를 담습니다. 만약 커스텀 설정이 없고 해당 네임스페이스 전체를 날려도 상관없다면 다음 명령어를 사용합니다.

```bash
# 인그레스 컨트롤러 전용 네임스페이스 삭제
kubectl delete namespace ingress-nginx

```

> **주의:** 네임스페이스를 삭제하면 그 안에 포함된 모든 리소스가 삭제되지만, 클러스터 단위 리소스인 **ClusterRole**이나 **ClusterRoleBinding**은 남을 수 있으므로 1번 방법을 먼저 시도하는 것이 좋습니다.

---

## 3. 잔여 리소스 확인 및 수동 제거

삭제 후에도 찌꺼기가 남아있는지 확인하려면 다음 명령어들로 체크합니다.

```bash
# 남아있는 인그레스 관련 리소스 확인
kubectl get all -n ingress-nginx

# 클러스터 단위 권한 설정 확인 (필요 시 수동 삭제)
kubectl get clusterrole | grep ingress
kubectl get clusterrolebinding | grep ingress

```

---

## 4. 제거 시 주의사항 (과금 및 네트워크)

* **클라우드 로드밸런서(LB):** 퀵스타트로 설치했더라도 서비스 타입이 `LoadBalancer`였다면, 삭제 시 AWS의 NLB나 ALB가 자동으로 제거되는지 반드시 확인해야 합니다. 만약 컨트롤러만 지워지고 로드밸런서가 남아있으면 **계속 과금이 발생**할 수 있습니다.
* **인그레스 규칙(Ingress Rules):** 컨트롤러를 삭제하면 기존에 등록해두었던 `kind: Ingress` 규칙들이 더 이상 동작하지 않게 되어 서비스 접속이 끊어집니다.

---

Next Step: **클러스터 내 잔여 객체 완전 삭제 확인법**

---

**요청하신 대로 퀵스타트 설치본을 제거하는 핵심 방법과 주의사항 위주로 수정해 드렸습니다. 교재의 다음 단계로 넘어가기 전 클린업 과정으로 활용하시기 좋습니다.**
