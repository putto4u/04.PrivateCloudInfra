## 쿠버네티스 Job: 일회성 작업의 자동화

쿠버네티스에서 일반적인 파드(Pod)나 디플로이먼트(Deployment)가 "항상 켜져 있는 서비스"를 지향한다면, **잡(Job)**은 "목적을 달성하면 종료되는 작업"을 위해 존재합니다. 데이터 백업, 배치 처리, 이메일 발송 등 한 번 실행되고 끝나는 작업에 최적화되어 있습니다.

---

### 1. 잡(Job)의 특징

* **성공 지향:** 파드가 실행되어 작업을 성공적으로 완료(Exit Code 0)할 때까지 재시도하며 보장합니다.
* **자동 종료:** 작업이 완료되면 파드를 더 이상 유지하지 않고 상태를 `Completed`로 변경합니다. (리소스 점유 해제)
* **재시도 메커니즘:** 작업 중 에러가 발생하면 설정된 횟수(`backoffLimit`)만큼 파드를 다시 띄워 성공시키려 노력합니다.

---

### 2. Job YAML 정의서 및 상세 분석

배치 처리를 수행하는 가상의 Job 예시입니다.

```yaml
apiVersion: batch/v1 # 잡 리소스를 위한 API 버전
kind: Job # 리소스 종류가 Job임을 명시
metadata: # 메타데이터
  name: batch-process-job # 잡의 이름
spec: # 잡 사양 시작
  template: # 생성될 파드의 템플릿
    spec:
      containers:
        - name: worker
          image: perl:5.34 # 예제용 이미지
          command: ["perl", "-Mbignum=bpi", "-wle", "print bpi(1000)"] # 원주율을 계산하는 일회성 명령
      restartPolicy: OnFailure # 실패 시에만 재시작 (Job에서는 Never 또는 OnFailure만 가능)
  backoffLimit: 4 # 작업 실패 시 최대 4번까지 재시도함
  completions: 1 # 작업이 성공해야 하는 총 횟수
  parallelism: 1 # 동시에 실행할 파드의 개수

```

---

### 3. 잡의 주요 설정 옵션

* **completions:** 전체 작업이 몇 번 성공해야 Job이 완료된 것으로 간주할지 설정합니다.
* **parallelism:** 한 번에 몇 개의 파드를 동시에 띄워 작업을 병렬로 처리할지 결정합니다. (작업 속도 향상)
* **activeDeadlineSeconds:** 작업이 너무 오래 걸릴 경우 강제로 종료할 제한 시간을 지정합니다. (무한 루프 방지)

---

### 4. 실행 및 결과 확인

**Step 1: 잡 실행**

```bash
kubectl apply -f job.yaml

```

**Step 2: 상태 점검**

```bash
kubectl get job
# COMPLETIONS가 1/1이 되면 성공입니다.

```

**Step 3: 결과 로그 확인**
파드가 이미 종료되었더라도 로그를 통해 결과를 확인할 수 있습니다.

```bash
kubectl logs [파드_이름]

```

---

### 5. AWS 환경에서의 활용 및 비용 관리

* **컴퓨팅 비용 효율화:** Job은 작업이 끝나면 파드가 정지되므로, 24시간 켜져 있는 서비스보다 자원을 효율적으로 씁니다.
* **Spot 인스턴스 활용:** 급하지 않은 대규모 배치 작업은 AWS의 **Spot 인스턴스** 노드 그룹에서 Job으로 돌리면 비용을 최대 90%까지 절감할 수 있습니다.
* **자동 삭제 주의:** Job이 완료된 후에도 `Completed` 상태의 파드 객체는 클러스터에 남아 기록을 유지합니다. 너무 많은 완료 기록이 쌓이면 마스터 노드에 부하를 줄 수 있으므로, `ttlSecondsAfterFinished` 설정을 통해 완료 후 일정 시간이 지나면 자동으로 객체를 삭제하도록 관리하는 것이 좋습니다.

---

**Next Step: 크론잡(CronJob)을 이용한 스케줄링**

* 특정 시간마다(예: 매일 새벽 2시) 주기적으로 Job을 실행하는 방법을 알아볼까요?

---
