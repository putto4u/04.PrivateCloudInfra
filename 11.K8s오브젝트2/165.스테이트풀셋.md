## μ¤ν…μ΄νΈν’€μ…‹(StatefulSet)μ μ΄ν•΄μ™€ ν™μ©

**μ¤ν…μ΄νΈν’€μ…‹(StatefulSet)**μ€ λ°μ΄ν„°λ² μ΄μ¤λ‚ λ¶„μ‚° νμΌ μ‹μ¤ν…κ³Ό κ°™μ΄ **μƒνƒλ¥Ό μ μ§€ν•΄μ•Ό ν•λ”(Stateful) μ• ν”λ¦¬μΌ€μ΄μ…**μ„ κ΄€λ¦¬ν•κΈ° μ„ν• μ»¨νΈλ΅¤λ¬μ…λ‹λ‹¤. ν¬λ“(Pod)μ μμ„μ™€ κ³ μ μ„±μ„ λ³΄μ¥ν•λ©°, ν¬λ“κ°€ μ¬μ‹μ‘λλ”λΌλ„ λ°μ΄ν„°μ™€ λ„¤νΈμ›ν¬ μ‹λ³„μκ°€ μ μ§€λλ„λ΅ μ„¤κ³„λμ—μµλ‹λ‹¤.

---

### 1. μ¤ν…μ΄νΈν’€μ…‹μ ν•µμ‹¬ νΉμ§•

λ””ν”λ΅μ΄λ¨ΌνΈκ°€ "μ–Έμ λ“  κµμ²΄ κ°€λ¥ν• λ³µμ λ³Έ"μ„ λ§λ“ λ‹¤λ©΄, μ¤ν…μ΄νΈν’€μ…‹μ€ **"μ΄λ¦„κ³Ό λ°μ΄ν„°κ°€ κ³ μ •λ κ°λ³„ κ°μ²΄"**λ¥Ό λ§λ“­λ‹λ‹¤.

* **κ³ μ ν• λ„¤νΈμ›ν¬ μ‹λ³„μ**: ν¬λ“ μ΄λ¦„ λ’¤μ— `0, 1, 2`μ™€ κ°™μ΄ μΈλ±μ¤κ°€ λ¶™μΌλ©°, μ¬μ‹μ‘λμ–΄λ„ μ΄ μ΄λ¦„μ΄ μ μ§€λ©λ‹λ‹¤. (μ: `db-0`, `db-1`)
* **μμ°¨μ μΈ μƒμ„± λ° μ‚­μ **: ν¬λ“λ¥Ό 0λ²λ¶€ν„° μμ„λ€λ΅ ν•λ‚μ”© μƒμ„±ν•λ©°, μ‚­μ ν•  λ•λ” μ—­μ(κ°€μ¥ λ†’μ€ λ²νΈλ¶€ν„°)μΌλ΅ μ κ±°ν•©λ‹λ‹¤. μ΄λ” λ¶„μ‚° μ‹μ¤ν…μ λ°μ΄ν„° μ •ν•©μ„±μ„ μ„ν•΄ ν•„μμ μ…λ‹λ‹¤.
* **μ•μ •μ μΈ μ¤ν† λ¦¬μ§€(PVC)**: ν¬λ“λ§λ‹¤ λ³„λ„μ **PersistentVolume(PV)**μ΄ ν• λ‹Ήλ©λ‹λ‹¤. ν¬λ“κ°€ μ‚­μ  ν›„ μ¬μƒμ„±λμ–΄λ„ κΈ°μ΅΄μ— μ—°κ²°λμ—λ λ°μ΄ν„°λ¥Ό κ·Έλ€λ΅ λ‹¤μ‹ μ—°κ²°ν•©λ‹λ‹¤.

---

### 2. μ¤ν…μ΄νΈν’€μ…‹ vs λ””ν”λ΅μ΄λ¨ΌνΈ λΉ„κµ

| κµ¬λ¶„ | λ””ν”λ΅μ΄λ¨ΌνΈ (Deployment) | μ¤ν…μ΄νΈν’€μ…‹ (StatefulSet) |
| --- | --- | --- |
| **λ€μƒ μ•±** | μ›Ή μ„λ²„, API λ“± (Stateless) | DB, λ©”μ‹μ§€ ν, λ¶„μ‚° μ €μ¥μ† |
| **ν¬λ“ λ…μΉ­** | `web-abcd12` (λλ¤ ν•΄μ‹) | `db-0`, `db-1` (κ³ μ • μΈλ±μ¤) |
| **μ¤ν† λ¦¬μ§€** | λ¨λ“  ν¬λ“κ°€ κ°™μ€ λ³Όλ¥¨ κ³µμ  κ°€λ¥ | κ° ν¬λ“κ°€ λ…λ¦½λ μ „μ© λ³Όλ¥¨ μ‚¬μ© |
| **μ—…λ°μ΄νΈ** | ν•κΊΌλ²μ— λλ” λ΅¤λ§ μ—…λ°μ΄νΈ | μμ°¨μ  μ—…λ°μ΄νΈ (RollingUpdate) |

---

### 3. μ¤ν…μ΄νΈν’€μ…‹ YAML μμ‹ (MariaDB/MySQL κµ¬μ΅°)

μ¤ν…μ΄νΈν’€μ…‹μ€ κ°λ³„ ν¬λ“μ— μ ‘κ·Όν•κΈ° μ„ν•΄ λ³΄ν†µ **ν—¤λ“λ¦¬μ¤ μ„λΉ„μ¤(Headless Service)**μ™€ ν•¨κ» μ‚¬μ©λ©λ‹λ‹¤.

```yaml
apiVersion: v1
kind: Service
metadata:
  name: mariadb-service
spec:
  clusterIP: None            # ν—¤λ“λ¦¬μ¤ μ„λΉ„μ¤ μ„¤μ • (IP λ€μ‹  DNSλ΅ κ° ν¬λ“ μ‹λ³„)
  selector:
    app: mariadb
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mariadb
spec:
  serviceName: "mariadb-service" # μ—°κ²°λ ν—¤λ“λ¦¬μ¤ μ„λΉ„μ¤ μ΄λ¦„
  replicas: 3
  selector:
    matchLabels:
      app: mariadb
  template:
    metadata:
      labels:
        app: mariadb
    spec:
      containers:
      - name: mariadb
        image: mariadb:10.5
  volumeClaimTemplates:      # 4. κ° ν¬λ“λ§λ‹¤ κ°λ³„ λ³Όλ¥¨μ„ μƒμ„±ν•λ” μ„¤κ³„λ„
  - metadata:
      name: data
    spec:
      accessModes: [ "ReadWriteOnce" ]
      resources:
        requests:
          storage: 10Gi      # ν¬λ“λ‹Ή 10GB ν• λ‹Ή

```

---

### 4. ν—¤λ“λ¦¬μ¤ μ„λΉ„μ¤(Headless Service)μ μ—­ν• 

μ¤ν…μ΄νΈν’€μ…‹μ€ κ°λ³„ ν¬λ“μ μ£Όμ†κ°€ μ¤‘μ”ν•©λ‹λ‹¤. `clusterIP: None`μΌλ΅ μ„¤μ •λ ν—¤λ“λ¦¬μ¤ μ„λΉ„μ¤λ” λ΅λ“ λ°Έλ°μ‹±μ„ ν•μ§€ μ•κ³ , DNS μ΅°νλ¥Ό ν†µν•΄ κ° ν¬λ“μ κ°λ³„ IP(μ: `mariadb-0.mariadb-service`)λ¥Ό μ§μ ‘ λ°ν™ν•©λ‹λ‹¤. ν΄λ¬μ¤ν„° λ‚΄λ¶€μ—μ„ λ§μ¤ν„° DBμ™€ μ¬λ μ΄λΈ DBλ¥Ό κµ¬λ¶„ν•μ—¬ μ ‘μ†ν•  λ• ν•„μμ μ…λ‹λ‹¤.

---

### π’΅ μ‹¤λ¬΄ μ „λ¬Έκ°€μ ν: μ‚­μ  μ‹ μ£Όμμ‚¬ν•­

κ°•μ‚¬λ‹μ€ μκ°•μƒλ“¤μ—κ² **"μ¤ν…μ΄νΈν’€μ…‹μ„ μ‚­μ ν•΄λ„ λ³Όλ¥¨(PVC)μ€ μλ™μΌλ΅ μ‚­μ λμ§€ μ•λ”λ‹¤"**λ” μ μ„ λ°λ“μ‹ κ°•μ΅°ν•μ…”μ•Ό ν•©λ‹λ‹¤. μ΄λ” μ‹¤μλ΅ μ¤ν…μ΄νΈν’€μ…‹μ΄ μ‚­μ λμ—μ„ λ• μ¤‘μ”ν• λ°μ΄ν„°λ¥Ό λ³΄νΈν•κΈ° μ„ν• μ•μ „μ¥μΉμ…λ‹λ‹¤. λ°μ΄ν„°λ¥Ό μ™„μ „ν μ§€μ°λ ¤λ©΄ PVCλ¥Ό μλ™μΌλ΅ ν•λ‚μ”© μ‚­μ ν•΄μ•Ό ν•©λ‹λ‹¤.

---

### β οΈ λΉ„μ© λ° μ λ£ μ „ν™ μ£Όμμ‚¬ν•­

* **μ¤ν† λ¦¬μ§€ λ„μ  κ³ΌκΈ**: `volumeClaimTemplates`λ¥Ό μ‚¬μ©ν•λ©΄ `replicas` μλ§νΌ λ…λ¦½μ μΈ **AWS EBS λ³Όλ¥¨**μ΄ μƒμ„±λ©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄ 3κ°μ λ³µμ λ³Έμ— κ°κ° 100GBλ¥Ό ν• λ‹Ήν•λ©΄ μ΄ 300GBμ EBS λΉ„μ©μ΄ λ°μƒν•λ©°, **ν¬λ“λ¥Ό μ¤‘μ§€ν•΄λ„ λ³Όλ¥¨ λΉ„μ©μ€ κ³„μ† μ²­κµ¬**λ©λ‹λ‹¤.
* **ν”„λ΅λΉ„μ €λ‹ μ§€μ—°**: ν΄λΌμ°λ“ ν™κ²½μ—μ„ μ¤ν…μ΄νΈν’€μ…‹ μ¤μΌ€μΌ μ•„μ›ƒ μ‹, κ° ν¬λ“λ§λ‹¤ μƒλ΅μ΄ EBS λ³Όλ¥¨μ„ μƒμ„±ν•κ³  μ—°κ²°ν•λ” κ³Όμ •μ—μ„ λ””ν”λ΅μ΄λ¨ΌνΈλ³΄λ‹¤ λ” κΈ΄ μ‹κ°„μ΄ μ†μ”λ  μ μμµλ‹λ‹¤.

---

**Next Step: μ¤ν…μ΄νΈν’€μ…‹μ μμ°¨μ  μ—…λ°μ΄νΈμ™€ νν‹°μ…(Partition) μ „λµ**

Next Step: **Headless Service DNS μ΅°ν μ‹¤μµ** | **OnDelete vs RollingUpdate μ „λµ** | **PVC μλ™ κ΄€λ¦¬ λ° λ°μ΄ν„° λ³µκµ¬**
