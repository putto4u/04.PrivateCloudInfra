## Kubernetes 실습 문제 30문항 (Part 1: 기초 및 워크로드 객체)

본 실습 예제는 지금까지 학습한 **PV/PVC, StorageClass, DaemonSet, Job, CronJob**을 중심으로 구성되었습니다. 각 문항을 직접 해결해 보며 실무 역량을 키워보시기 바랍니다.

---

### [ 실습 문제 리스트 ]

#### **Section 1: 영구 저장소 (PV & PVC)**

1. `1Gi` 용량의 로컬 스토리지 PV를 생성하세요. (이름: `task1-pv`, StorageClass: `manual`)
2. 위에서 생성한 `task1-pv`를 사용하는 `500Mi` 용량의 PVC를 생성하세요.
3. PVC의 `accessModes`를 `ReadWriteMany`로 설정했을 때, AWS EBS 기반 PV와 바인딩이 가능한지 이유와 함께 설명하세요.
4. `persistentVolumeReclaimPolicy`를 `Delete`로 설정한 PV를 생성하고, PVC 삭제 시 실제 현상을 확인하세요.
5. 파드에서 PVC를 마운트할 때 `volumeMounts`의 `mountPath`를 `/data`로 설정하여 배포하세요.
6. PV의 상태가 `Released`일 때, 새로운 PVC가 이 PV를 바로 사용할 수 없는 이유를 설명하세요.
7. `hostPath`를 사용하는 PV를 생성하여 노드의 `/tmp/data` 경로와 동기화하세요.
8. 하나의 PVC를 두 개의 파드에 동시에 마운트하는 YAML을 작성하세요.
9. PVC의 용량을 `10Gi`에서 `20Gi`로 확장하는 방법을 단계별로 제시하세요. (EBS 기준)
10. PV 없이 PVC만 생성했을 때 발생하는 이벤트를 `kubectl describe`로 확인하고 원인을 분석하세요.

#### **Section 2: 자동 프로비저닝 (StorageClass)**

11. `gp3` 타입을 사용하는 StorageClass를 생성하세요. (이름: `fast-storage`)
12. `fast-storage` 클래스를 사용하여 `2Gi` 용량의 볼륨을 동적으로 할당받는 PVC를 작성하세요.
13. `volumeBindingMode`를 `WaitForFirstConsumer`로 설정하는 이유를 설명하세요.
14. StorageClass를 통해 생성된 EBS 볼륨의 태그(Tag)를 지정하는 방법을 조사하여 설명하세요.
15. 기존에 정의된 `default` StorageClass를 해제하고 새로운 클래스를 기본값으로 설정하세요.

#### **Section 3: 데몬셋 (DaemonSet)**

16. 모든 노드에 `nginx` 파드를 하나씩 배포하는 데몬셋을 생성하세요.
17. 특정 라벨(`disk=ssd`)이 있는 노드에만 데몬셋이 배포되도록 `nodeSelector`를 설정하세요.
18. 데몬셋으로 배포된 파드를 `kubectl delete pod`으로 삭제했을 때 어떤 일이 발생하는지 확인하세요.
19. 데몬셋 파드에 `resources.limits`를 설정하여 노드 자원 고갈을 방지하세요.
20. `RollingUpdate` 전략을 사용하여 데몬셋의 이미지를 업데이트하는 절차를 수행하세요.

#### **Section 4: 일회성 및 예약 작업 (Job & CronJob)**

21. `hello-world`를 출력하고 종료되는 단순 잡(Job)을 생성하세요.
22. 잡이 실패했을 때 최대 5번까지 재시도하도록 `backoffLimit`을 설정하세요.
23. 총 5번의 성공을 위해 2개의 파드가 병렬로 실행되는 잡을 작성하세요.
24. 잡이 완료된 후 60초 뒤에 파드가 자동으로 삭제되도록 `ttlSecondsAfterFinished`를 설정하세요.
25. 1분마다 현재 시간을 로그로 남기는 크론잡을 생성하세요.
26. 크론잡의 `concurrencyPolicy`를 `Forbid`로 설정하여 작업 중복 실행을 차단하세요.
27. 성공한 크론잡 기록을 1개만 남기도록 `successfulJobsHistoryLimit`을 수정하세요.
28. 수동으로 크론잡을 즉시 실행(Ad-hoc)하는 명령행 도구 사용법을 제시하세요.
29. 잡 실행 중 특정 시간이 지나면 강제 종료되도록 `activeDeadlineSeconds`를 설정하세요.
30. 크론잡 스케줄을 "매주 월요일 새벽 3시"로 설정하는 크론 표현식을 작성하세요.

---

### [ 모범 답안 및 해설 ]

> **안내:** 모든 실습 후에는 `kubectl delete` 명령어로 자원을 정리하고, 특히 AWS EBS 볼륨이 삭제되었는지 반드시 확인하세요.

---

#### **핵심 예제 답안 1: PV & PVC (Q1, Q2)**

**파일명: `task1-storage.yaml**`

```yaml
apiVersion: v1 # API 버전
kind: PersistentVolume # 리소스: PV
metadata:
  name: task1-pv # PV 이름
spec:
  capacity:
    storage: 1Gi # 용량 1GiB
  accessModes:
    - ReadWriteOnce # 한 노드에서만 접속 가능
  persistentVolumeReclaimPolicy: Retain # 삭제 시 데이터 보존
  storageClassName: manual # 매칭할 클래스 이름
  hostPath: # 로컬 경로 사용 (실습용)
    path: "/mnt/data"
---
apiVersion: v1 # API 버전
kind: PersistentVolumeClaim # 리소스: PVC
metadata:
  name: task1-pvc # PVC 이름
spec:
  accessModes:
    - ReadWriteOnce # PV와 일치해야 함
  resources:
    requests:
      storage: 500Mi # 500MiB 요청 (1GiB PV에 바인딩 가능)
  storageClassName: manual # PV와 일치해야 함

```

* **실행 방법:** `kubectl apply -f task1-storage.yaml`
* **명령행 확인:** `kubectl get pv,pvc`
* **설명:** PVC는 자신보다 크거나 같은 용량의 PV를 찾아 바인딩됩니다. `storageClassName`이 일치하는 것이 가장 중요합니다.

#### **핵심 예제 답안 2: StorageClass (Q11, Q12)**

**파일명: `fast-sc.yaml**`

```yaml
apiVersion: storage.k8s.io/v1 # SC용 API 버전
kind: StorageClass # 리소스: StorageClass
metadata:
  name: fast-storage # 클래스 이름
provisioner: ebs.csi.aws.com # AWS EBS 드라이버 사용
parameters:
  type: gp3 # 볼륨 타입 gp3 (유료 서비스, GiB당 과금)
reclaimPolicy: Delete # PVC 삭제 시 EBS도 자동 삭제 (비용 절감)
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: fast-pvc
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: fast-storage # 위 SC 호출
  resources:
    requests:
      storage: 2Gi # 2GiB EBS 자동 생성 요청

```

* **실행 방법:** `kubectl apply -f fast-sc.yaml`
* **설명:** `provisioner`가 AWS EBS를 생성해 줍니다. `Delete` 정책으로 실습 종료 시 비용 발생을 최소화합니다.

#### **핵심 예제 답안 3: DaemonSet (Q16, Q17)**

**파일명: `ssd-daemonset.yaml**`

```yaml
apiVersion: apps/v1
kind: DaemonSet # 리소스: 데몬셋
metadata:
  name: nginx-daemon
spec:
  selector:
    matchLabels:
      app: monitoring
  template:
    metadata:
      labels:
        app: monitoring
    spec:
      nodeSelector: # 노드 선택기 (Q17 대응)
        disk: ssd # 'disk=ssd' 라벨이 있는 노드에만 배포
      containers:
        - name: nginx
          image: nginx:stable
          resources: # 자원 제한 (Q19 대응)
            limits:
              cpu: "100m"
              memory: "128Mi"

```

* **명령행 라벨링:** `kubectl label nodes [노드이름] disk=ssd` (라벨이 있어야 파드가 뜹니다.)
* **설명:** 데몬셋은 노드별 관리에 필수적이며, `nodeSelector`를 통해 배포 범위를 제어합니다.

#### **핵심 예제 답안 4: CronJob (Q25, Q26, Q30)**

**파일명: `time-cronjob.yaml**`

```yaml
apiVersion: batch/v1
kind: CronJob # 리소스: 크론잡
metadata:
  name: time-logger
spec:
  schedule: "0 3 * * 1" # 매주 월요일 03:00 (Q30 대응)
  concurrencyPolicy: Forbid # 중복 실행 금지 (Q26 대응)
  successfulJobsHistoryLimit: 1 # 성공 기록 1개 보존 (Q27 대응)
  jobTemplate:
    spec:
      template:
        spec:
          containers:
            - name: logger
              image: busybox
              command: ["/bin/sh", "-c", "date; echo 'Weekly Check'"]
          restartPolicy: OnFailure

```

* **수동 실행:** `kubectl create job --from=cronjob/time-logger manual-run-001` (Q28 대응)
* **설명:** `0 3 * * 1`은 월요일 새벽 3시를 의미합니다. 중복 실행 방지를 위해 `Forbid`를 권장합니다.

---

**Next Step: 배포 전략(Rolling Update, Blue/Green)**

* 운영 중인 서비스의 가동 중단 없이 새로운 버전을 배포하고 문제가 생겼을 때 되돌리는(Rollback) 실전 기법을 알아볼까요?

---
