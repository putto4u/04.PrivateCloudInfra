쿠버네티스 스토리지 설계의 핵심은 **"데이터가 어디까지 살아남고, 누구와 공유될 수 있는가"**를 결정하는 것입니다. 요청하신 공유 범위의 확장 단계에 따른 스토리지 솔루션 분류 표입니다.

---

## 스토리지 공유 범위 및 확장 계층 분류

| 공유 범위 | 해당 기술/리소스 | 데이터 영속성 | 주요 특징 및 용도 |
| --- | --- | --- | --- |
| **컨테이너 간**<br>

<br>(Single Pod) | **emptyDir** | 파드 삭제 시 삭제 | 동일 파드 내 사이드카 컨테이너 간 임시 데이터 교환 |
| **파드 간**<br>

<br>(Single Node) | **hostPath** | 노드에 유지 | 동일 노드에 위치한 서로 다른 파드들이 로컬 경로 공유 |
| **노드 간**<br>

<br>(Single Cluster) | **PV / PVC**<br>

<br>(NFS, AWS EFS 등) | 영구 보존 | 노드가 달라도 네트워크를 통해 데이터 접근 가능 (RWX 모드) |
| **외부 스토리지**<br>

<br>(External) | **NAS, SAN, Cloud Storage** | 클러스터 외부에 존재 | 클러스터 장애와 무관하게 데이터 보호, 독립적 인프라 관리 |
| **클러스터 간**<br>

<br>(Multi-Cluster) | Object Storage (S3),<br>

<br>Global File System | 전역적 보존 | 리전(Region)이나 클러스터 경계를 넘어 전 세계 어디서든 접근 |

---

## 공유 계층별 상세 분석

### 1. 로컬 계층 (Local Scope)

* **emptyDir:** 파드 내부의 '공유 폴더' 역할을 합니다. 메모리(`Memory`)를 매체로 설정하면 고속 연산용 임시 저장소로 활용 가능합니다.
* **hostPath:** 노드의 특정 디렉터리를 여러 파드가 동시에 바라보게 합니다. 주로 `/var/log`나 `/var/run/docker.sock` 처럼 노드 자원을 직접 공유할 때 쓰입니다.

### 2. 네트워크 계층 (Cluster Scope)

* **PersistentVolume (PV):** 노드에 종속되지 않는 네트워크 기반 저장소입니다. 파드가 노드 A에서 노드 B로 이사 가도 네트워크 주소를 통해 자신의 데이터를 찾아갑니다.
* **RWX (ReadWriteMany):** 여러 노드의 파드들이 동시에 읽고 쓰기 위해서는 반드시 네트워크 스토리지(NFS, EFS 등)가 뒷받침되어야 합니다.

### 3. 글로벌 계층 (Global Scope)

* **외부 저장소 (External):** 쿠버네티스 제어권 밖의 전문 스토리지 장비나 클라우드 서비스를 의미합니다. 클러스터를 새로 구축하더라도 기존 외부 저장소에 연결만 하면 데이터를 즉시 복구할 수 있습니다.
* **클러스터 간 공유:** 멀티 클러스터 환경에서는 **AWS S3**와 같은 객체 스토리지가 표준입니다. HTTP API를 통해 접근하므로 클러스터의 네트워크 구성과 관계없이 데이터를 공유할 수 있습니다.

---

## 실무 아키텍트의 구성 전략

| 상황 | 최적의 선택 | 이유 |
| --- | --- | --- |
| **단순 캐시 데이터 공유** | `emptyDir` | 속도가 빠르고 관리가 필요 없음 |
| **로그 수집 및 노드 모니터링** | `hostPath` | 호스트 시스템의 원천 데이터에 접근 필요 |
| **일반적인 웹 서비스 DB** | `PV (Block Storage)` | 안정적인 성능과 데이터 영속성 보장 |
| **콘텐츠 관리 (CMS) / 정적 파일** | `PV (NFS / EFS)` | 여러 파드가 동일한 콘텐츠를 동시에 서빙 |
| **전역 데이터 / 백업 / 이미지** | **Object Storage** | 위치에 구애받지 않는 무한한 확장성 |

---

## Next Step:

**AWS EFS(네트워크 공유)와 EBS(단일 노드 전용)의 성능 및 비용 비교**

---
쿠버네티스 스토리지 체계에서 '공유'의 반대 개념인 **'독점(Exclusive)'** 또는 **'격리된(Isolated)'** 스토리지의 명칭을 범위별로 정리해 드립니다.

각 계층은 상위 계층으로 갈수록 생명주기가 길어지며, 하위 계층의 데이터는 상위 객체가 삭제될 때 함께 소멸하는 특징을 가집니다.

---

## 스토리지 독점성(Exclusivity) 계층 분류

| 독점 범위 | 명칭 | 특성 및 설명 |
| --- | --- | --- |
| **컨테이너 독점** | **Container Writable Layer** | 컨테이너 자체의 저장 공간. 컨테이너가 재시작(Restart)되면 모든 데이터가 초기화됨 |
| **파드 독점** | **emptyDir** | 파드 내 컨테이너들은 공유하지만, **다른 파드는 접근 불가**. 파드 삭제 시 데이터 소멸 |
| **노드 독점** | **Local Persistent Volume (LPV)** | 특정 노드의 물리 디스크를 점유. **다른 노드에서는 접근 불가**. 노드 장애 시 가용성 상실 |
| **클러스터 독점** | **Cluster-Scoped PV** | 해당 클러스터 내부에서만 유효한 스토리지. **다른 클러스터에서는 접근 불가** |

---

## 계층별 독점 스토리지 상세 분석

### 1. 컨테이너 독점: Writable Layer (Rootfs)

컨테이너 이미지는 읽기 전용(Read-only) 레이어들로 구성되며, 실행 시 그 위에 하나의 **쓰기 가능한 레이어(Writable Layer)**가 생성됩니다.

* **독점성:** 이 레이어는 해당 컨테이너만 사용하며, 컨테이너가 죽고 새로 살아나면(Crash 등) 이전 데이터는 모두 사라집니다.

### 2. 파드 독점: emptyDir

파드가 생성될 때 함께 생성되는 임시 볼륨입니다.

* **독점성:** 동일 파드 내의 사이드카 컨테이너끼리는 공유할 수 있지만, 클러스터 내의 **다른 파드들은 이 경로를 절대 볼 수 없습니다.** 파드가 노드에서 제거되는 순간 이 공간도 함께 삭제됩니다.

### 3. 노드 독점: Local PV / hostPath (특정 경로)

노드에 직접 장착된 SSD나 HDD를 사용하는 경우입니다.

* **독점성:** 성능(I/O)은 가장 뛰어나지만, 데이터가 특정 노드에 물리적으로 묶여 있습니다. 파드가 다른 노드로 이사 가면 데이터를 따라갈 수 없으므로 **해당 노드만의 독점적 자원**이 됩니다.

### 4. 클러스터 독점: 일반적인 PV (EBS 등)

네트워크 스토리지이지만 특정 클러스터에 마운트되어 관리되는 경우입니다.

* **독점성:** 클러스터 내부의 노드들끼리는 공유할 수 있지만, VPC가 다르거나 다른 지역에 있는 **외부 클러스터에서는 이 스토리지를 직접 제어하거나 읽을 수 없습니다.**

---

## 요약: 범위에 따른 독점 리소스 명칭

| 범위 | 독점 리소스 명칭 (Keyword) |
| --- | --- |
| **Container** | **Writable Layer / Ephemeral Storage** |
| **Pod** | **emptyDir** |
| **Node** | **Local Volume / hostPath** |
| **Cluster** | **Intra-cluster PV** |

---

## Next Step:

**컨테이너 Writable Layer의 성능 한계와 로그 관리 전략 분석**

가장 좁은 범위인 '컨테이너 독점 스토리지'는 쓰기 속도가 느리고 휘발성이 강하다는 단점이 있습니다. 이를 해결하기 위해 실무에서 로그를 외부로 빼내는 `Sidecar logging` 패턴을 어떻게 구현하는지 확인해 볼까요?
*참고: AWS 환경에서 EBS(Elastic Block Store)는 기본적으로 **노드 독점(RWO)** 성격을 띠며, 비용은 사용량에 따라 과금됩니다.*
