## 쿠버네티스 서비스 (Service)의 이해

쿠버네티스에서 **서비스(Service)**는 동적으로 생성되고 삭제되는 포드(Pod) 집합에 대해 **고정된 IP(Virtual IP)**와 **DNS 이름**을 제공하여 안정적인 네트워크 접속을 보장하는 추상화된 오브젝트입니다.

---

### 1. 서비스가 필요한 이유 (필연성)

쿠버네티스의 포드는 자가 치유 과정에서 언제든 죽고 다시 살아날 수 있으며, 그때마다 **IP 주소가 변경**됩니다. 클라이언트가 변경되는 IP를 일일이 추적하는 것은 불가능하기 때문에, 서비스라는 '단일 진입점'을 두고 트래픽을 배분하는 것입니다.

---

### 2. 서비스의 주요 타입 (Service Types)

수강생들이 가장 혼동하기 쉬운 부분으로, 사용 목적에 따라 4가지 타입으로 나뉩니다.

| 서비스 타입 | 주요 특징 및 용도 | 외부 노출 여부 |
| --- | --- | --- |
| **ClusterIP** | 클러스터 **내부** 포드 간 통신을 위한 기본값 (가상 IP 할당) | 불가 |
| **NodePort** | 모든 노드의 특정 포트(30000-32767)를 개방하여 접속 | 가능 (IP:Port) |
| **LoadBalancer** | 클라우드 공급자(AWS, GCP 등)의 **외부 로드 밸런서** 생성 | 가능 (Domain/IP) |
| **ExternalName** | 외부 서비스(예: RDS)를 클러스터 내부 DNS 이름으로 매핑 | 외부 연결용 |

---

### 3. 서비스 YAML 상세 분석 (ClusterIP 예시)

서비스는 **Selector**를 통해 어떤 포드들에 트래픽을 보낼지 결정합니다.

```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-web-service          # 서비스의 고정 이름 (내부 DNS로 사용됨)
spec:
  type: ClusterIP               # 서비스 타입 지정
  selector:
    app: my-web                 # 포드의 labels와 일치해야 트래픽 전달
  ports:
    - protocol: TCP
      port: 80                  # 서비스 자체가 노출하는 포트
      targetPort: 8080          # 실제 포드(컨테이너) 내부에서 듣고 있는 포트

```

---

### 4. 서비스의 핵심 작동 원리

1. **Endpoint**: 서비스가 생성되면 Selector와 일치하는 포드들의 IP 리스트를 담은 `Endpoints` 오브젝트가 자동으로 생성됩니다.
2. **kube-proxy**: 모든 노드에서 실행되는 이 컴포넌트가 서비스의 가상 IP로 들어오는 패킷을 가로채서 실제 포드 IP로 전달(NAT)합니다.
3. **CoreDNS**: 클러스터 내부에서 서비스 이름을 IP로 변환해주는 역할을 수행합니다.

---

### 💡 실무 전문가의 팁: 서비스 vs 인그레스(Ingress)

강사님은 수강생들에게 **"서비스는 L4 계층(IP/Port)의 전달자"**라고 강조해 주세요. 여러 서비스를 하나의 도메인 아래서 경로별(URL Path)로 나누어 관리하고 싶다면, 서비스 상위에 **인그레스(Ingress)**라는 L7 계층의 규칙이 추가로 필요함을 인지시키는 것이 중요합니다.

---

### ⚠️ 비용 및 유료 전환 주의사항

* **AWS ELB 비용**: `type: LoadBalancer`를 생성하면 AWS 상에서 즉시 **CLB/NLB/ALB**가 프로비저닝됩니다. 이는 인스턴스 사용 여부와 관계없이 **시간당 기본료**가 청구되며, 데이터 처리량에 따른 추가 과금이 발생합니다.
* **데이터 전송 비용 (Data Transfer)**: 서로 다른 가용 영역(AZ)에 있는 노드 간에 서비스 트래픽이 이동할 경우, AWS 내부 네트워크 전송 비용이 발생할 수 있으므로 가급적 동일 AZ 배치를 고려해야 합니다.

---

**Next Step: L7 부하 분산을 위한 인그레스(Ingress) 설정 및 실습**

Next Step: **Ingress Controller 설치** | **경로 기반 라우팅(Path-based) 실습** | **LoadBalancer 타입 상세 분석**
