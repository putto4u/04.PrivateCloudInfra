## 로드밸런서(LoadBalancer) 서비스의 이해

쿠버네티스의 **로드밸런서(LoadBalancer)** 타입 서비스는 AWS, Azure, GCP와 같은 클라우드 공급자의 인프라와 연동하여 **외부 전용 부하 분산 장치**를 자동으로 프로비저닝하고 서비스에 연결하는 방식입니다. 실무에서 공용 인터넷을 통해 서비스를 노출할 때 가장 표준적으로 사용되는 방법입니다.

---

### 1. 작동 원리 (Cloud Integration)

사용자가 `type: LoadBalancer` 서비스를 생성하면, 쿠버네티스 제어 평면은 클라우드 공급자의 API를 호출하여 다음과 같은 작업을 수행합니다.

1. **외부 로드밸런서 생성**: AWS의 경우 CLB(Classic) 또는 NLB(Network)가 즉시 생성됩니다.
2. **노드포트 자동 할당**: 클라우드 로드밸런서가 내부 노드로 접근할 수 있도록 모든 워커 노드에 임의의 **NodePort**를 자동으로 예약합니다.
3. **대상 그룹(Target Group) 설정**: 생성된 로드밸런서의 대상으로 워커 노드들을 등록하고, 예약된 NodePort를 통해 트래픽을 전달하도록 구성합니다.

---

### 2. 로드밸런서 YAML 구조

클라우드 환경에서는 보통 주석(Annotations)을 통해 로드밸런서의 세부 속성(종류, 서브넷 등)을 제어합니다.

```yaml
apiVersion: v1
kind: Service
metadata:
  name: my-aws-lb
  annotations:
    # AWS에서 NLB(Network Load Balancer)를 생성하도록 지정
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
spec:
  type: LoadBalancer         # 서비스 타입을 LoadBalancer로 설정
  selector:
    app: web-app
  ports:
    - protocol: TCP
      port: 80               # 외부 사용자가 로드밸런서 IP로 접속할 포트
      targetPort: 8080       # 파드 내부에서 실행 중인 컨테이너 포트

```

---

### 3. LoadBalancer vs NodePort 비교

| 구분 | 노드포트 (NodePort) | 로드밸런서 (LoadBalancer) |
| --- | --- | --- |
| **접속 주소** | `<노드-IP>:<노드포트>` | `<로드밸런서-DNS/IP>:80` |
| **관리 주체** | 쿠버네티스 내부 설정 | 클라우드 공급자 인프라 |
| **사용 편의성** | 노드 IP 변경 시 대응 어려움 | 단일 진입점(VIP) 제공으로 관리가 매우 쉬움 |
| **비용** | 무료 | 클라우드 서비스 이용료 발생 |

---

### 💡 실무 전문가의 팁: 비용 최적화와 인그레스

강사님은 수강생들에게 **"서비스 하나당 로드밸런서 하나를 만드는 것은 낭비다"**라고 강조해 주세요. AWS에서 로드밸런서는 개당 고정 비용이 발생하므로, 실무에서는 하나의 로드밸런서를 생성하고 그 뒤에 **인그레스(Ingress)**를 배치하여 도메인이나 경로 기반으로 여러 서비스를 통합 관리하는 것이 비용 효율적입니다.

---

### ⚠️ 비용 및 유료 전환 주의사항 (필독)

* **시간당 고정 비용**: AWS에서 로드밸런서(NLB/ALB)를 생성하는 즉시 **시간당 약 $0.0225 이상의 기본 이용료**가 발생합니다. (리전별 상이)
* **LcU(Load Balancer Capacity Units)**: 트래픽 처리량, 신규 연결 수 등에 따라 추가 과금이 발생하므로, 대규모 트래픽 테스트 시 주의가 필요합니다.
* **미삭제 리소스**: `kubectl delete service` 명령어로 서비스를 삭제하지 않고 클러스터만 삭제할 경우, 클라우드 로드밸런서가 **'좀비 리소스'**로 남아 계속 비용이 청구될 수 있으니 반드시 서비스부터 삭제해야 합니다.

---

**Next Step: L7 부하 분산을 위한 인그레스(Ingress)와 로드밸런서 연동**

Next Step: **AWS Load Balancer Controller 설치** | **인그레스를 통한 비용 절감 전략** | **외부 트래픽 정책(Local vs Cluster) 심화** 강사님, 요청하신 대로 박스 형태를 제거하고 실무 지침과 비용 주의사항을 포함하여 구성했습니다. 다음 단계에서는 본격적인 L7 제어 기법으로 넘어가시면 좋습니다.
