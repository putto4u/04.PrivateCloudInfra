이번 실습에서는 동일한 구성의 3-Tier 웹 서비스를 **`prod`(운영)**와 **`dev`(개발)**라는 두 개의 독립된 **네임스페이스(Namespace)**로 분리하여 구축합니다. 이를 통해 하나의 물리적인 클러스터 안에서 환경을 완벽하게 격리하고 관리하는 실무적인 환경 구축 기법을 학습합니다.

---

## 챕터: 네임스페이스를 활용한 운영(Prod) 및 개발(Dev) 환경 격리

동일한 이름의 서비스를 서로 다른 네임스페이스에 배포함으로써, 개발 작업이 운영 환경에 영향을 미치지 않도록 논리적으로 분리합니다.

### 1. 실습 목표 아키텍처

* **prod 네임스페이스**: 실제 서비스가 돌아가는 안정적인 환경
* **dev 네임스페이스**: 새로운 기능을 테스트하고 수시로 업데이트하는 환경
* 두 환경은 동일한 YAML 구조를 가지지만, 네임스페이스 지정을 통해 독립된 자원으로 관리됩니다.

---

### 2. 네임스페이스 생성 및 환경 설정

가장 먼저 두 개의 가상 클러스터 공간을 생성하고, 각 환경에서 사용할 설정값(ConfigMap)을 배포합니다.

#### **01-namespaces.yaml**

```yaml
# 01-namespaces.yaml
# 설명: 운영(prod)과 개발(dev)을 위한 논리적 공간을 생성합니다.
apiVersion: v1
kind: Namespace
metadata:
  name: prod
---
apiVersion: v1
kind: Namespace
metadata:
  name: dev

```

#### **02-configs-by-ns.yaml**

```yaml
# 02-configs-by-ns.yaml
# 설명: 각 네임스페이스별로 서로 다른 환경 변수를 정의합니다.
apiVersion: v1
kind: ConfigMap
metadata:
  name: env-config
  namespace: prod # 운영 환경용 설정
data:
  ENV_NAME: "PRODUCTION"
  DB_HOST: "mariadb-prod-service"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: env-config
  namespace: dev # 개발 환경용 설정
data:
  ENV_NAME: "DEVELOPMENT"
  DB_HOST: "mariadb-dev-service"

```

---

### 3. 웹 서비스 2세트 배포 (Frontend & Backend)

동일한 Deployment 정의를 사용하되, `metadata.namespace` 필드만 다르게 지정하여 배포합니다.

#### **03-web-services-prod.yaml (운영계)**

```yaml
# 03-web-services-prod.yaml
# 설명: prod 네임스페이스에 웹 서비스 세트를 구축합니다.
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-deployment
  namespace: prod # 운영계 지정
spec:
  replicas: 2
  selector:
    matchLabels:
      app: web
  template:
    metadata:
      labels:
        app: web
    spec:
      containers:
      - name: nginx
        image: nginx:alpine
        env:
        - name: CURRENT_ENV
          valueFrom: { configMapKeyRef: { name: env-config, key: ENV_NAME } }
---
apiVersion: v1
kind: Service
metadata:
  name: web-service
  namespace: prod
spec:
  type: NodePort
  ports:
    - port: 80
      nodePort: 30001 # 운영 접속 포트
  selector:
    app: web

```

#### **04-web-services-dev.yaml (개발계)**

```yaml
# 04-web-services-dev.yaml
# 설명: dev 네임스페이스에 웹 서비스 세트를 구축합니다.
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web-deployment
  namespace: dev # 개발계 지정
spec:
  replicas: 2
  selector:
    matchLabels:
      app: web
  template:
    metadata:
      labels:
        app: web
    spec:
      containers:
      - name: nginx
        image: nginx:alpine
        env:
        - name: CURRENT_ENV
          valueFrom: { configMapKeyRef: { name: env-config, key: ENV_NAME } }
---
apiVersion: v1
kind: Service
metadata:
  name: web-service
  namespace: dev
spec:
  type: NodePort
  ports:
    - port: 80
      nodePort: 30002 # 개발 접속 포트 (포트 충돌 방지를 위해 다르게 설정)
  selector:
    app: web

```

---

### 4. 작업 절차 및 확인 가이드

1. **네임스페이스 및 설정 배포**:
* `kubectl apply -f 01-namespaces.yaml`
* `kubectl apply -f 02-configs-by-ns.yaml`


2. **서비스 세트 배포**:
* `kubectl apply -f 03-web-services-prod.yaml`
* `kubectl apply -f 04-web-services-dev.yaml`


3. **격리 상태 확인**: 각 네임스페이스에 독립적으로 Pod가 생성되었는지 확인합니다.
* `kubectl get pods -n prod`
* `kubectl get pods -n dev`


4. **환경 변수 주입 확인**: 각 환경의 Pod가 서로 다른 ConfigMap 값을 참조하는지 확인합니다.
* `kubectl exec -it <prod-pod-name> -n prod -- env | grep CURRENT_ENV` (결과: PRODUCTION)
* `kubectl exec -it <dev-pod-name> -n dev -- env | grep CURRENT_ENV` (결과: DEVELOPMENT)



---

### 5. 실무 전문가 팁

* **DNS 형식**: 네임스페이스 간 통신 시에는 `서비스명.네임스페이스명` 형식을 사용합니다. 예를 들어 `dev`에서 `prod`의 DB에 접근하려면 `mariadb-service.prod` 주소를 사용해야 합니다.
* **자원 관리**: 실무에서는 `ResourceQuota`를 사용하여 `dev` 네임스페이스가 클러스터 전체 자원을 과도하게 소모하여 `prod` 서비스에 영향을 주는 것을 방지합니다.
* **AWS 과금 주의**:
* **NodePort 관리**: NodePort를 여러 개 사용할 경우 AWS 보안 그룹(Security Group)에서 해당 포트 대역(30000-32767)을 모두 열어야 할 수도 있습니다.
* **리소스 비용**: 동일 세트를 2세트(Pod 총 4대 이상) 돌리게 되므로, 인스턴스 메모리 부족에 주의하십시오.



Next Step: 네임스페이스별 접근 권한 제한(RBAC) 및 자원 할당량(Quota) 설정 실습

---

Next Step: 네임스페이스 권한 및 자원 제한 설정 방법
