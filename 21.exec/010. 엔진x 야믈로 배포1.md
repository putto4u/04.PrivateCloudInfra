## YAML을 이용한 NGINX 배포 및 웹 브라우저 확인

Kubernetes(K8s) 환경에서 NGINX를 배포하고 외부 브라우저에서 접속하기 위해서는 **Deployment**(애플리케이션 배포)와 **Service**(네트워크 노출) 설정이 필요합니다.

---

### 1. NGINX Deployment 및 Service 작성

하나의 YAML 파일에 Deployment와 Service를 함께 정의할 수 있습니다. 각 리소스는 `---`로 구분합니다.

`nginx-web.yaml`

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
spec:
  replicas: 2
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
---
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  type: NodePort  # 외부 접속을 위해 NodePort 설정
  selector:
    app: nginx
  ports:
    - protocol: TCP
      port: 80        # 서비스가 사용하는 포트
      targetPort: 80  # 파드(컨테이너) 내부 포트
      nodePort: 30080 # 노드에서 열릴 포트 (30000-32767 범위 내 선택 가능)

```

---

### 2. 리소스 배포 및 상태 확인

작성한 YAML 파일을 클러스터에 적용합니다.

```bash
# 리소스 생성
kubectl apply -f nginx-web.yaml

# 상태 확인
kubectl get deployments
kubectl get pods
kubectl get services

```

---

### 3. 웹 브라우저에서 확인하기

환경에 따라 접속 방법이 다릅니다.

* **Minikube 환경:**
```bash
minikube service nginx-service --url

```


출력된 URL을 브라우저에 입력합니다.
* **일반 서버(On-premise) 환경:**
브라우저 주소창에 `http://<Node-IP>:30080`을 입력합니다. (Node IP는 `kubectl get nodes -o wide` 명령으로 확인 가능합니다.)
* **클라우드(AWS EKS 등) 환경:**
YAML에서 `type: NodePort` 대신 `type: LoadBalancer`를 사용하면 AWS ELB가 생성됩니다.
> **주의:** `LoadBalancer` 타입 사용 시 클라우드 제공업체(AWS, GCP 등)의 **과금이 발생**하므로 실습 후 반드시 리소스를 삭제해야 합니다.



---

### 실전 팁 & 주의사항

* **Selector 일치:** Deployment의 `template.metadata.labels`와 Service의 `selector` 값이 반드시 일치해야 트래픽이 정상적으로 전달됩니다.
* **방화벽 설정:** 클라우드 환경이나 온프레미스 서버에서 `NodePort`를 사용할 경우, 해당 노드의 보안 그룹이나 OS 방화벽에서 `30080` 포트가 열려 있는지 확인해야 합니다.

Next Step: **Ingress 설정**

---


