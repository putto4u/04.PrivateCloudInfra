## NFS(Network File System) 서버 구축 및 스토리지 관리

NFS는 네트워크를 통해 원격지의 파일 시스템을 로컬 디렉토리처럼 사용할 수 있게 해주는 프로토콜입니다. 대규모 인프라에서는 다수의 서버가 동일한 데이터(예: 웹 콘텐츠, 공유 미디어)를 바라보아야 할 때 필수적으로 사용됩니다.

---

### 1. 스토리지 준비: 10GB 파티션 할당

실제 운영 환경에서는 OS 영역과 데이터 영역을 분리하는 것이 정석입니다. 여기서는 10GB 크기의 새로운 디스크(`/dev/sdb`)가 추가되었다고 가정하고 구축을 진행합니다.

1. **디스크 인식 확인**
```bash
lsblk

```


2. **파티션 생성 및 포맷**
```bash
# 10GB 전체를 하나의 파티션으로 생성
sudo fdisk /dev/sdb 
# n(new) -> p(primary) -> default... -> w(write)

# xfs 또는 ext4로 포맷 (성능과 확장성을 위해 xfs 권장)
sudo mkfs.xfs /dev/sdb1

```


3. **마운트 포인트 생성 및 등록**
```bash
sudo mkdir -p /mnt/nfs_share
sudo mount /dev/sdb1 /mnt/nfs_share

```


4. **영구 마운트 설정 (`/etc/fstab`)**
부팅 시에도 유지되도록 설정합니다.
```bash
# UUID 확인
blkid /dev/sdb1

# /etc/fstab 하단에 추가
UUID=[확인된-UUID] /mnt/nfs_share xfs defaults 0 0

```



---

### 2. NFS 서버 패키지 설치 및 실행

Linux 배포판에 따라 패키지 관리 도구가 다르므로 환경에 맞춰 설치합니다.

* **Ubuntu/Debian:**
```bash
sudo apt update
sudo apt install nfs-kernel-server -y

```


* **RHEL/CentOS/AL2023:**
```bash
sudo dnf install nfs-utils -y

```



**서비스 활성화:**

```bash
sudo systemctl enable --now nfs-server

```

---

### 3. 디렉토리 Export 설정

NFS 서버의 핵심은 어떤 디렉토리를 어떤 클라이언트에게 어떤 권한으로 공유할지 결정하는 것입니다.

1. **권한 설정**
공유할 디렉토리의 소유권과 권한을 조정합니다.
```bash
sudo chown nobody:nogroup /mnt/nfs_share  # Ubuntu 기준
# 또는
sudo chown nfsnobody:nfsnobody /mnt/nfs_share  # RHEL 기준
sudo chmod 777 /mnt/nfs_share

```


2. **Export 규칙 작성 (`/etc/exports`)**
```bash
# 특정 IP에 대해 읽기/쓰기 허용
/mnt/nfs_share  192.168.1.50(rw,sync,no_subtree_check)

# 특정 대역 전체에 대해 허용
/mnt/nfs_share  192.168.1.0/24(rw,sync,no_root_squash)

```


> **[실전 Tip] 주요 옵션 설명**


> * **rw**: 읽기 및 쓰기 권한 부여.
> * **sync**: 데이터가 디스크에 완전히 기록된 후 응답(데이터 무결성 중요).
> * **no_root_squash**: 클라이언트의 root 사용자를 서버에서도 root 권한으로 인정(편의성은 높으나 보안상 주의 필요).
> * **no_subtree_check**: 하위 디렉토리 점검을 비활성화하여 성능 향상.
> 
> 


3. **설정 적용**
```bash
sudo exportfs -ra
sudo systemctl restart nfs-server

```



---

### 4. 방화벽 설정 (보안)

NFS는 여러 포트를 사용하므로 방화벽에서 해당 서비스들을 허용해야 합니다.

* **UFW (Ubuntu):**
```bash
sudo ufw allow from 192.168.1.0/24 to any port nfs

```


* **Firewalld (RHEL/CentOS):**
```bash
sudo firewall-cmd --permanent --add-service=nfs
sudo firewall-cmd --permanent --add-service=rpc-bind
sudo firewall-cmd --permanent --add-service=mountd
sudo firewall-cmd --reload

```



---

### 5. 클라이언트 연결 테스트

클라이언트 서버에서 마운트가 정상적으로 되는지 확인합니다.

1. **클라이언트 패키지 설치:** `sudo apt install nfs-common` 또는 `sudo dnf install nfs-utils`
2. **마운트 실행:**
```bash
sudo mkdir -p /mnt/my_data
sudo mount -t nfs [서버_IP]:/mnt/nfs_share /mnt/my_data

```


3. **확인:** `df -h` 명령어를 통해 10GB 용량의 네트워크 드라이브가 연결되었는지 확인합니다.

---

### ⚠️ 자주 실수하는 포인트 (Troubleshooting)

* **권한 문제:** 클라이언트에서 파일을 생성할 때 `Permission denied`가 발생한다면, 서버 측 디렉토리 자체의 리눅스 권한(`chmod/chown`)과 `/etc/exports`의 권한 설정이 일치하는지 반드시 확인해야 합니다.
* **버전 불일치:** 최신 Linux 배포판은 NFSv4를 기본으로 사용합니다. 방화벽 설정 시 v3와 v4가 사용하는 포트 차이를 인지해야 합니다.
* **AWS 사용 시 주의:** [AWS EFS](https://aws.amazon.com/efs/)는 관리형 NFS 서비스입니다. 직접 EC2에 NFS를 구축할 경우, 보안 그룹(Security Group)에서 **TCP 2049(NFS)** 포트를 반드시 열어주어야 합니다. (EFS 사용 시 용량에 따른 **과금**이 발생하며, 직접 구축 시에는 EBS 볼륨 비용과 EC2 인스턴스 비용이 발생합니다.)

---

**Next Step: NFS 클라이언트 자동 마운트 및 성능 최적화**

사용자가 요청한 대로 10GB 파티션 생성부터 export 설정까지 가이드라인에 맞춰 작성했습니다. 추가로 클라이언트 측의 fstab 자동 마운트나 보안 심화 과정이 필요하시면 말씀해 주세요.
