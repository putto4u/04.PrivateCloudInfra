# Module: Advanced Deployment Strategies Comparison & Field Application

## 1. 배포 전략 비교 개요 (Overview)

현대 IT 인프라에서 "배포(Deployment)"는 단순한 소프트웨어 설치가 아니라, 비즈니스 연속성을 보장하는 핵심 운영 프로세스이다. 무중단 배포(Zero Downtime Deployment)를 달성하기 위해 주로 사용되는 **롤링(Rolling), 블루-그린(Blue-Green), 카나리(Canary)** 전략은 각각 트레이드오프(Trade-off)가 명확하다.

본 모듈에서는 세 가지 전략의 상세 비교와 실무 현장에서의 선택 기준, 그리고 아키텍트가 주의해야 할 "현장의 팁"을 중점적으로 다룬다.

---

## 2. 전략별 상세 분석 및 실무 포인트

### 2.1 롤링 배포 (Rolling Update) : "비용 효율성과 표준의 미학"

* **핵심:** 구버전 인스턴스를 하나씩 줄이고, 신버전 인스턴스를 하나씩 늘리는 점진적 교체 방식.
* **실무 현장:**
* Kubernetes의 기본(`Default`) 전략이므로 별도 설정 없이 가장 많이 사용된다.
* **주의점:** 배포 중간 단계에서 v1과 v2가 공존하므로, API나 DB 스키마의 **하위 호환성(Backward Compatibility)**이 깨지면 500 에러가 발생한다.


* **장점:** 추가 인프라 비용이 거의 없음 (`maxSurge` 만큼만 필요).
* **단점:** 배포 완료 후 문제 발생 시, 다시 하나씩 교체해야 하므로 **롤백 속도가 가장 느리다.**

### 2.2 블루-그린 배포 (Blue-Green) : "안정성과 즉시 롤백의 보장"

* **핵심:** 운영 환경(Blue)과 똑같은 대기 환경(Green)을 만들어 놓고, 로드밸런서의 라우팅만 변경하여 순간적으로 배포한다.
* **실무 현장:**
* 금융권이나 결제 시스템처럼 **단 1초의 장애도 허용하기 힘든** 미션 크리티컬 서비스에서 선호한다.
* **주의점:** 트래픽 전환 시 기존 연결(Connection)을 우아하게 종료하는 **Connection Draining** 설정이 필수이다. 안 그러면 전환 순간 사용자의 세션이 끊긴다.


* **장점:** **롤백이 즉시 가능**하다(스위치만 원복). 테스트 환경이 운영 환경과 완벽히 동일하다.
* **단점:** 인프라 리소스가 2배로 필요하므로 **비용이 가장 많이 든다.**

### 2.3 카나리 배포 (Canary) : "리스크 최소화와 데이터 기반 검증"

* **핵심:** 전체 트래픽의 1~5%만 신버전으로 흘려보내 실제 사용자 반응(에러율, Latency)을 확인한 후 점차 확대한다.
* **실무 현장:**
* 넷플릭스, 구글 등 대규모 트래픽을 처리하는 글로벌 기업에서 필수적으로 사용한다.
* **주의점:** 수동으로 트래픽을 조절하면 운영 실수가 발생한다. Istio나 Spinnaker 같은 **자동화 도구 연동**이 필수적이다.


* **장점:** 장애 발생 시 영향받는 사용자를 최소화(**Blast Radius 축소**)할 수 있다. A/B 테스트가 가능하다.
* **단점:** 구현 복잡도가 가장 높고, 배포 완료까지 시간이 오래 걸린다.

---

## 3. 종합 비교 분석표 (Comparative Analysis)

아키텍트는 아래 표를 기준으로 프로젝트의 상황(예산, 인력, 중요도)에 맞는 전략을 선택해야 한다.

| 비교 항목 | 롤링 (Rolling) | 블루-그린 (Blue-Green) | 카나리 (Canary) |
| --- | --- | --- | --- |
| **배포 속도** | 중간 (인스턴스 개수에 비례) | **매우 빠름** (스위칭 즉시) | 느림 (검증 단계 필요) |
| **롤백 속도** | **느림** (역순 재배포) | **매우 빠름** (스위칭 즉시) | 빠름 (트래픽 차단) |
| **인프라 비용** | **낮음** (10~20% 추가) | **높음** (100% 추가) | 낮음~중간 |
| **구현 난이도** | **하** (기본 기능) | 중 (LB/DNS 제어) | **상** (정교한 라우팅) |
| **장애 영향도** | 전체 배포 후 발견 시 100% 영향 | 전환 실패 시 100% 영향 | **극소수** (1~5%) 영향 |
| **버전 공존** | 발생 (v1, v2 혼재) | 없음 (전환 시점 제외) | 발생 (의도적 혼재) |
| **추천 대상** | 일반적인 웹 서비스, 스타트업 | 금융, 결제, 대규모 업데이트 | 글로벌 서비스, 핵심 기능 변경 |

---

## 4. 실무 아키텍트의 의사결정 가이드 (Field Decision Framework)

실제 현장에서는 단순히 하나의 전략만 고집하지 않는다. 상황에 따라 유연하게 선택하거나 혼합하여 사용해야 한다.

### 4.1 리소스(비용)가 제한적인 경우

* **선택:** **롤링 배포 + Readiness Probe 튜닝**
* **전략:** 스타트업이나 비용 효율이 중요한 프로젝트에서는 블루-그린의 2배 비용을 감당하기 어렵다. 롤링 배포를 사용하되, `minReadySeconds`를 길게 주어 배포 속도를 희생하더라도 안정성을 확보한다.

### 4.2 DB 스키마 변경이 포함된 대규모 업데이트

* **선택:** **블루-그린 배포**
* **전략:** 롤링 배포는 v1/v2가 공존하므로 DB 호환성 맞추기가 매우 까다롭다. 차라리 블루-그린으로 한 번에 넘기는 것이 안전하다. 단, DB는 배포 전 미리 마이그레이션을 끝내두어야 한다.

### 4.3 MSA 환경에서 특정 마이크로서비스만 변경할 때

* **선택:** **카나리 배포**
* **전략:** 수백 개의 서비스가 얽혀 있는 MSA 환경에서는 사이드 이펙트를 예측하기 어렵다. 서비스 메시(Istio 등)를 활용해 특정 헤더값(예: 내부 직원, 베타 테스터)을 가진 요청만 신규 버전으로 라우팅하여 안전하게 검증한다.

### 4.4 오토스케일링(HPA)과 함께 사용할 때의 주의점

* **현장의 함정:** 카나리 배포 중 신버전(Canary) 파드는 소수인데 트래픽이 몰리면 과부하로 죽을 수 있다.
* **해결:** 카나리 버전에도 반드시 **HPA를 별도로 설정**하여, 트래픽 유입 비율이 늘어남에 따라 파드 개수도 자동으로 늘어나게 해야 한다.

Next Step: 실무에서 가장 사고가 많이 터지는 'DB 마이그레이션 전략'과 '무중단 배포 시 스키마 관리 기법'
