도커 이미지를 직접 설계하고 빌드하기 위한 설계도인 **Dockerfile(도커파일)**의 기본 작성법과 주요 지시어들을 정리했습니다.

---

### Dockerfile의 핵심 구조

도커파일은 텍스트 파일로 작성되며, 일반적으로 프로젝트의 루트 디렉토리에 위치합니다. 각 줄은 하나의 **레이어(Layer)**를 생성하며, 레이어 수가 적을수록 이미지 크기가 효율적으로 관리됩니다.

### 주요 지시어(Instructions) 설명 및 예시

```dockerfile
# 1. FROM: 베이스 이미지를 지정 (필수)
# 운영체제나 런타임 환경을 선택합니다.
FROM ubuntu:22.04

# 2. LABEL: 이미지의 메타데이터 설정 (작성자, 버전 등)
LABEL maintainer="instructor@example.com"

# 3. RUN: 이미지를 빌드하는 동안 실행할 명령어
# 여러 개의 명령어는 &&로 묶어 레이어 수를 줄이는 것이 좋습니다.
RUN apt-get update && apt-get install -y \
    python3 \
    python3-pip \
    && rm -rf /var/lib/apt/lists/*

# 4. WORKDIR: 컨테이너 내부의 작업 디렉토리 설정 (cd 명령과 유사)
# 이후 명령인 COPY, RUN, CMD 등은 이 경로를 기준으로 실행됩니다.
WORKDIR /app

# 5. COPY / ADD: 호스트의 파일을 컨테이너 내부로 복사
# COPY를 권장하며, ADD는 압축 해제나 URL 다운로드 기능이 추가로 포함됩니다.
COPY . /app

# 6. ENV: 컨테이너 내부에서 사용할 환경 변수 설정
ENV APP_ENV=production

# 7. EXPOSE: 컨테이너가 사용할 포트 명시 (문서화 용도)
EXPOSE 8080

# 8. CMD / ENTRYPOINT: 컨테이너가 시작될 때 실행할 기본 명령
# CMD는 실행 시 인자를 덮어쓸 수 있지만, ENTRYPOINT는 고정된 실행 명령으로 사용됩니다.
CMD ["python3", "app.py"]

```

---

### 실전 예시: 간단한 웹 서버 이미지 만들기

아래는 파이썬(Flask) 애플리케이션을 배포하기 위한 실제 도커파일 예시입니다.

```dockerfile
# 파이썬 3.9 슬림 버전 사용 (용량 최적화)
FROM python:3.9-slim

# 작업 디렉토리 생성
WORKDIR /usr/src/app

# 의존성 파일 복사 및 설치
COPY requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt

# 소스 코드 복사
COPY . .

# 5000번 포트 개방
EXPOSE 5000

# 앱 실행
CMD ["python", "app.py"]

```

---

### 이미지 빌드 및 실행 명령어

작성한 Dockerfile을 바탕으로 이미지를 생성하고 실행하는 과정입니다.

1. **이미지 빌드**:
```bash
# -t: 이미지 이름과 태그 설정, 맨 마지막의 점(.)은 현재 디렉토리를 의미
docker build -t my-web-app:1.0 .

```


2. **컨테이너 실행**:
```bash
# -d: 백그라운드 실행, -p: 호스트 80번과 컨테이너 5000번 포트 연결
docker run -d -p 80:5000 --name my-running-app my-web-app:1.0

```



> [!IMPORTANT]
> **자원 및 과금 주의**: 빌드 과정에서 대용량 베이스 이미지를 사용하거나 많은 패키지를 설치하면 **EBS(디스크) 용량**을 많이 차지하게 됩니다. 특히 AWS 환경에서는 사용하지 않는 이미지와 컨테이너를 주기적으로 정리(`docker system prune`)하여 스토리지 비용을 관리해야 합니다.

Next Step: **Docker 이미지 레이어 최적화 및 .dockerignore 활용법**
