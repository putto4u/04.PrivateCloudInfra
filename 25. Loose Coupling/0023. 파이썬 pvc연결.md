## Kubernetes 리소스 연결 및 환경 업데이트

기존에 생성된 `back-pvc`를 `py-web` Deployment에 연결하고, 컨테이너 내부의 특정 경로에 마운트하여 데이터의 영속성을 보장하도록 설정합니다. 또한 실무 환경에서 관리 효율을 높이기 위해 환경 변수 설정을 추가한 업데이트 버전입니다.

---

### 수정된 py-web.yaml (PVC 연결 및 환경 설정)

이 파일은 기존 Deployment 구조를 유지하면서 **Volume** 설정과 **VolumeMounts**를 추가하여 `back-pvc`를 사용하도록 구성되었습니다.

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: py-web
  namespace: wb_prod
  labels:
    app: py-server
spec:
  replicas: 2
  selector:
    matchLabels:
      app: py-server
  template:
    metadata:
      labels:
        app: py-server
    spec:
      containers:
      - name: python-server
        image: python:3.9-slim
        # 작업 디렉토리를 마운트 경로로 설정하여 서버 실행
        workingDir: /data
        command: ["python3", "-m", "http.server", "8000"]
        ports:
        - containerPort: 8000
        # 1. 컨테이너 내부 마운트 설정
        volumeMounts:
        - name: backend-storage
          mountPath: /data
        # 환경 변수 추가 (필요 시 활용)
        env:
        - name: APP_ENV
          value: "production"
      # 2. 사용할 PVC 선언
      volumes:
      - name: backend-storage
        persistentVolumeClaim:
          claimName: back-pvc
---
apiVersion: v1
kind: Service
metadata:
  name: py-service
  namespace: wb_prod
spec:
  type: NodePort
  selector:
    app: py-server
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8000
      nodePort: 38080

```

---

### 주요 변경 사항 및 기술 포인트

* **volumes 섹션**: Pod 스펙 하위에 `volumes`를 정의하고, 사전에 생성한 `back-pvc`를 호출합니다. `local-path` 스토리지 클래스를 사용하므로 해당 노드의 로컬 디렉토리에 데이터가 바인딩됩니다.
* **volumeMounts**: 정의한 볼륨을 컨테이너 내부의 `/data` 경로에 연결했습니다. Python HTTP 서버가 해당 경로의 파일을 서비스할 수 있도록 `workingDir`를 함께 조정했습니다.
* **데이터 영속성**: 이제 Pod가 삭제되거나 재시작되어도 `/data` 경로에 저장된 파일은 `back-pvc`를 통해 유지됩니다.

> [!CAUTION]
> **AWS 환경 주의 사항**
> 현재 설정된 `storageClassName: local-path`는 단일 노드 테스트 환경용입니다. 만약 **AWS EKS** 환경에서 가용성을 확보하려면 **Amazon EBS(EBS CSI Driver)**를 사용해야 하며, 이 경우 `gp2` 또는 `gp3`와 같은 StorageClass로 변경이 필요합니다. EBS 사용 시 노드 간 볼륨 이동에 따른 추가 비용이 발생할 수 있습니다.

---

### 실행 및 확인 절차

1. **설정 적용**
```bash
kubectl apply -f py-web.yaml

```


2. **마운트 상태 확인**
```bash
kubectl describe pod py-web -n wb_prod
# Containers -> python-server -> Mounts 섹션 확인

```


3. **데이터 쓰기 테스트**
```bash
# Pod 내부에서 파일 생성 테스트
kubectl exec -it <pod-name> -n wb_prod -- sh -c "echo 'Hello PVC' > /data/index.html"

```



---

Next Step: **Kubernetes 데이터 백업 및 스냅샷 전략**

작성된 내용 중 특정 볼륨 경로(`mountPath`)나 복제본 수(`replicas`) 등 수정이 필요한 부분이 있다면 말씀해 주세요. 해당 부분만 즉시 반영해 드리겠습니다.
