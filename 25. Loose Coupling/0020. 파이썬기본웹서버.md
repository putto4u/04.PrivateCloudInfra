## Python 3 기본 웹서버(Base Origin) 배포 및 관리

쿠버네티스 환경에서 별도의 외부 이미지 없이 파이썬 공식 이미지를 활용하여 정적 컨텐츠를 제공하는 웹서버를 구축합니다. 이 과정은 애플리케이션의 배포(Deployment)와 네트워크 노출(Service)의 기본 원리를 이해하는 데 중점을 둡니다.

---

### 1. Python 3 웹서버 정의 (`py-web.yaml`)

파이썬 내부 모듈인 `http.server`를 실행하여 8000번 포트로 통신하는 웹서버입니다. 2개의 복제본(Replicas)을 생성하여 고가용성을 유지합니다.

```yaml
# py-web.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: py-web
  namespace: wb_prod
  labels:
    app: py-server
spec:
  replicas: 2
  selector:
    matchLabels:
      app: py-server
  template:
    metadata:
      labels:
        app: py-server
    spec:
      containers:
      - name: python-server
        image: python:3.9-slim
        command: ["python3", "-m", "http.server", "8000"]
        ports:
        - containerPort: 8000
---
apiVersion: v1
kind: Service
metadata:
  name: py-service
  namespace: wb_prod
spec:
  type: NodePort
  selector:
    app: py-server
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8000
      nodePort: 38080

```

---

### 2. 설치 및 실행 방법

작성된 YAML 파일을 클러스터에 적용하고 리소스가 정상적으로 생성되었는지 확인합니다.

**단계 1: 리소스 적용**

```bash
kubectl apply -f py-web.yaml

```

**단계 2: 배포 상태 확인**

```bash
# 포드 실행 여부 확인 (2/2 상태 확인)
kubectl get pods -n wb_prod -l app=py-server

# 서비스 포트 확인
kubectl get svc py-service -n wb_prod

```

---

### 3. 브라우저 접속 및 확인 방법

배포된 파이썬 웹서버가 정상적으로 동작하는지 외부에서 접속하여 테스트합니다.

**방법 1: NodePort를 이용한 직접 접속**
워커 노드의 IP 주소와 지정한 `nodePort`(38080)를 사용하여 접속합니다.

* **주소:** `http://<Worker-Node-IP>:38080`

**방법 2: Port-Forwarding을 이용한 임시 접속**
로컬 환경(PC/맥북)에서 즉시 확인이 필요한 경우 사용합니다.

```bash
kubectl port-forward svc/py-service -n wb_prod 8888:80

```

* **주소:** 브라우저에서 `http://localhost:8888` 접속

**확인 결과:**
정상적으로 접속되면 파이썬 컨테이너 내부의 루트 디렉토리 파일 목록(Directory listing for /)이 브라우저에 표시됩니다.

---

### 4. 핵심 관리 포인트

* **Slim 이미지 사용**: `python:3.9-slim` 이미지를 사용하여 컨테이너 크기를 줄이고 보안성을 높였습니다.
* **TargetPort 매핑**: 파이썬 기본 웹서버는 8000번 포트를 사용하지만, 서비스(`py-service`)를 통해 외부에는 80(내부) 및 38080(외부) 포트로 노출되도록 설계되었습니다.
* **무상태성(Stateless)**: 현재 볼륨이 연결되지 않은 상태이므로, 포드가 재시작되면 내부에서 생성한 임시 파일은 모두 삭제됩니다.

> [!IMPORTANT]
> **과금 관련 안내**:
> `NodePort` 서비스를 사용하는 방식은 클라우드 제공업체의 로드밸런서(AWS ELB 등)를 별도로 생성하지 않으므로 **추가 과금이 발생하지 않습니다.** 단, `NodePort`로 열린 포트(38080)에 접근하기 위해 클라우드 보안 그룹(Security Group) 설정이 필요할 수 있습니다.

---

Next Step: **파이썬 웹서버에 index.html을 제공하기 위한 ConfigMap 또는 PVC 연결**

---
