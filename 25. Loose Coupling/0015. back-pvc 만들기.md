## 백엔드 영구 저장소 구축을 위한 Local Path PVC 정의

애플리케이션의 데이터를 영구적으로 보관하기 위해 **Local Path Provisioner**를 사용하는 **back-pvc**를 생성합니다. 이 설정은 워커 노드의 물리적 디스크 공간을 동적으로 할당받아 사용합니다.

---

### 1. PersistentVolumeClaim(PVC) 정의 (`back-pvc.yaml`)

애플리케이션(Deployment 등)이 사용할 스토리지 자원을 요청하는 명세서입니다. `storageClassName`을 `local-path`로 지정하여 자동 프로비저닝을 활성화합니다.

```yaml
# back-pvc.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: back-pvc
  namespace: wb_prod
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: local-path
  resources:
    requests:
      storage: 2Gi # 백엔드 데이터 저장용 2GB 할당

```

---

### 2. 물리적 연결 구조 이해

`back-pvc`를 생성하면 쿠버네티스 클러스터 내부에서는 다음과 같은 경로 매핑이 자동으로 이루어집니다.

* **논리적 자원(PVC)**: `back-pvc` (사용자가 참조하는 이름)
* **물리적 경로(Node)**: `/opt/local-path-provisioner/pvc-[ID]_wb_prod_back-pvc/`
* **연결 방식**: 포드가 생성될 때 해당 노드의 위 디렉토리가 컨테이너 내부 지정 경로로 마운트됩니다.

---

### 3. 실습 및 상태 확인

**단계 1: PVC 생성 및 바인딩 확인**
YAML 파일을 적용한 후, 시스템이 자동으로 PV(PersistentVolume)를 생성하고 바인딩했는지 확인합니다.

```bash
# 설정 적용
kubectl apply -f back-pvc.yaml

# 상태 확인 (STATUS가 Bound인지 확인)
kubectl get pvc back-pvc -n wb_prod

```

**단계 2: 생성된 물리 디렉토리 추적**
실제 어느 노드의 디렉토리가 할당되었는지 확인하는 방법입니다.

```bash
# 할당된 PV 이름 확인
kubectl get pvc back-pvc -n wb_prod -o jsonpath='{.spec.volumeName}'

# 해당 PV가 생성된 노드 위치 확인
kubectl get pv [PV_이름] -o yaml | grep nodeAffinity -A 5

```

---

### 4. 특징 및 관리 가이드

* **동적 할당**: 사용자가 별도로 PV를 만들지 않아도 `local-path` 프로비저너가 노드 내 유효한 공간을 찾아 디렉토리를 자동 생성합니다.
* **데이터 보존**: 포드가 재시작되거나 삭제되어도 `back-pvc`가 유지되는 한 노드 내 물리 데이터는 삭제되지 않습니다.
* **노드 고정**: 데이터가 특정 노드에 물리적으로 저장되므로, 이 PVC를 사용하는 포드는 반드시 해당 노드에서만 실행되도록 쿠버네티스 스케줄러가 제어합니다.

> [!IMPORTANT]
> **과금 관련 안내**:
> 본 설정은 AWS EBS나 별도의 유료 스토리지를 사용하지 않고 **인스턴스(EC2 등)의 로컬 디스크를 사용하므로 추가 비용이 발생하지 않습니다.** 단, 인스턴스 전체 디스크 용량을 초과하지 않도록 할당량(storage: 2Gi)을 적절히 관리하십시오.

---

Next Step: **백엔드 Deployment에 back-pvc 연결 설정**

---
